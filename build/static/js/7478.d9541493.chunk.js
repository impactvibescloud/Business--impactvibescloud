"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[7478],{27478:function(e,t,a){a.r(t);var n=a(9950),i=a(10226),l=a(28429),o=a(42074),s=a(6536),r=a.n(s),c=a(26910),d=a(11031),m=(a(49911),a(72348)),h=a.n(m),p=(a(4434),a(44414));t.default=()=>{const e=(0,d.g)(),t=(0,l.Zp)(),[a,s]=(0,n.useState)([]),[m,u]=(0,n.useState)({doctorId:"",doctorName:"",date:"",time:"",patientName:"",patientPhone:""}),[g,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{c.A.get("/api/specialist/getall").then(e=>{s(e.data.specialist)}).catch(e=>{r()("Error","Could not get data","error")})},[]);const x=[...a.map(e=>({label:e.specialistName,value:e._id}))],f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],[v,b]=(0,n.useState)([]),[j,y]=(0,n.useState)([]),[S,w]=(0,n.useState)(),[P,T]=(0,n.useState)({}),{id:_}=(0,l.g)();(0,n.useEffect)(()=>{N(!0),c.A.get("/api/appointment/get/".concat(_)).then(e=>{const t=e.data.appointment;t.date=new Date(t.date).toISOString("en-IN"),t.time=new Date(t.time).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}),T(t),N(!1)}).catch(e=>{r()("Error","Could not get data","error"),N(!1)})},[]),(0,n.useEffect)(()=>{u(e=>({...e,patientName:P.patientName,patientPhone:P.patientPhone}))},[P]);const C=e=>{const t=e.target.value,n=a.find(e=>e._id===t),i=n.daysAvailable.filter(e=>!0===e.available),l=i.map(e=>(e=>f.indexOf(e))(e.label));y(l),w(n.perPatientTime),b(i),u(e=>({...e,doctorId:t,doctorName:n.specialistName,date:"",time:""}))},[D,F]=(0,n.useState)([]),A=async e=>{var t;const a=(e=>v.filter(t=>t.label===e))((t=e.getDay(),f[t])),n=await((e,t)=>{const a=[];return e.forEach(e=>{const n=new Date("January 1, 2022 ".concat(e.startTime)),i=new Date("January 1, 2022 ".concat(e.endTime));let l=n;for(;l<i;){const e=new Date(l.getTime()+6e4*t),n="".concat(l.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," - ").concat(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),i=l.toISOString();a.push({label:n,value:i}),l=e}}),a})(a[0].timeSlots,S);await F(n),u(t=>({...t,date:e,time:""}))},E=e=>{u(t=>({...t,[e.target.id]:e.target.value}))};return(0,p.jsxs)("div",{className:"container",children:[(0,p.jsx)("div",{className:"row",children:(0,p.jsx)("div",{className:"col-12",children:(0,p.jsxs)("div",{className:" page-title-box d-flex align-items-center justify-content-between ",children:[(0,p.jsx)("div",{style:{fontSize:"22px"},className:"fw-bold",children:"Edit Appointment"}),(0,p.jsx)("div",{style:{display:"flex",gap:"1rem"},children:(0,p.jsx)("h4",{className:"mb-0"})}),(0,p.jsxs)("div",{className:"page-title-right",children:[(0,p.jsx)(i.A,{variant:"contained",color:"primary",style:{fontWeight:"bold",marginBottom:"1rem",textTransform:"capitalize",marginRight:"5px"},onClick:()=>(()=>{if(""===m.doctorName.trim()||""===m.date||""===m.time||""===m.patientName.trim()||""===m.patientPhone.trim())return void r()({title:"Warning",text:"Fill all mandatory fields",icon:"error",button:"Close",dangerMode:!0});N(!0);const a=new FormData;a.set("doctorId",m.doctorId),a.set("doctorName",m.doctorName),a.set("date",m.date),a.set("time",m.time),a.set("patientName",m.patientName),a.set("patientPhone",m.patientPhone),c.A.patch("/api/appointment/update/".concat(_),a,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/formdata","Access-Control-Allow-Origin":"*"}}).then(e=>{r()({title:"Updated",text:"appointment updated successfully!",icon:"success",button:"ok"}),N(!1),t("/appointments",{replace:!0})}).catch(e=>{var t,a;N(!1);const n=(null===(t=e.response)||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||"Something went wrong!";r()({title:"Warning",text:n,icon:"error",button:"Retry",dangerMode:!0})})})(),disabled:g,children:g?"Loading":"Save"}),(0,p.jsx)(o.N_,{to:"/appointments",children:(0,p.jsx)(i.A,{variant:"contained",color:"secondary",style:{fontWeight:"bold",marginBottom:"1rem",textTransform:"capitalize"},children:"Cancel"})})]})]})})}),(0,p.jsx)("div",{className:"row",children:(0,p.jsx)("div",{className:"col-lg-12 col-md-12  col-sm-12 my-1",children:(0,p.jsx)("div",{className:"card h-100",children:(0,p.jsxs)("div",{className:"card-body px-5",children:[(0,p.jsxs)("div",{className:"mb-3",children:[(0,p.jsx)("label",{htmlFor:"doctorName",className:"form-label",children:"Doctor Name *"}),(0,p.jsxs)("select",{type:"select",className:"form-control",id:"doctorName",name:"doctorName",onChange:e=>C(e),options:x,children:[(0,p.jsx)("option",{hidden:!0,children:"Select Doctor"}),x.map(e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.label))]})]}),m.doctorId&&(0,p.jsxs)("div",{className:"mb-3",children:[(0,p.jsx)("label",{htmlFor:"date",className:"form-label",children:"Date *"}),(0,p.jsx)(h(),{type:"date",className:"form-control",id:"date",name:"date",selected:m.date,onChange:e=>A(e),dateFormat:"dd/MM/yyyy",minDate:new Date,placeholderText:"Select a date",filterDate:e=>j.includes(e.getDay())})]}),m.date&&(0,p.jsxs)("div",{className:"mb-3",children:[(0,p.jsx)("label",{htmlFor:"time",className:"form-label",children:"Time *"}),(0,p.jsxs)("select",{type:"select",className:"form-control",id:"time",name:"time",value:m.time,options:D,onChange:e=>E(e),children:[(0,p.jsx)("option",{hidden:!0,children:"Select Time"}),D.map(e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.label))]})]}),(0,p.jsxs)("div",{className:"mb-3",children:[(0,p.jsx)("label",{htmlFor:"patientName",className:"form-label",children:"Patient Name *"}),(0,p.jsx)("input",{type:"text",className:"form-control",id:"patientName",value:m.patientName,placeholder:"Enter Patient Name",maxLength:"100",onChange:e=>E(e)}),m.patientName?(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("small",{className:"charLeft mt-4 fst-italic",children:[100-m.patientName.length," characters left"]})}):(0,p.jsx)(p.Fragment,{})]}),(0,p.jsxs)("div",{className:"mb-3",children:[(0,p.jsx)("label",{htmlFor:"patientPhone",className:"form-label",children:"Patient Phone *"}),(0,p.jsx)("input",{type:"tel",className:"form-control",id:"patientPhone",value:m.patientPhone,placeholder:"Enter Patient Phone",maxLength:"10",onChange:e=>E(e)})]})]})})})})]})}}}]);