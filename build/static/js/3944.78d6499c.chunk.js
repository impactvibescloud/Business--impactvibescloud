"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[3944],{73834:function(){},93944:function(e,t,n){n.r(t);var i=n(9950),s=n(49911),a=n(2720),o=(n(73834),n(44414));t.default=()=>{var e,t;const[n,r]=(0,i.useState)([]),[d,l]=(0,i.useState)(!1),[c,m]=(0,i.useState)(1),[u]=(0,i.useState)(50),[p,g]=(0,i.useState)(localStorage.getItem("businessId")||""),[h,y]=(0,i.useState)(new Set),[v,x]=(0,i.useState)(null),[b,f]=(0,i.useState)(!1),[j,N]=(0,i.useState)(!1),[I,_]=(0,i.useState)({node:"",voice:"",active:!0,options:[{key:"1",type:"node",target:"",agentId:"",voice:""}],menu:""}),[S,A]=(0,i.useState)([]),[k,w]=(0,i.useState)(!1),[C,E]=(0,i.useState)(null),[R,T]=(0,i.useState)([]),[L,V]=(0,i.useState)({}),[O,F]=(0,i.useState)(null),[U,D]=(0,i.useState)(null),[$,H]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{if(!p)try{const t=await(0,a.H2)("/v1/user/details","GET"),n=t.user||t.data||t;if(n&&n.businessId){g(n.businessId);try{localStorage.setItem("businessId",n.businessId)}catch(e){}}}catch(t){}})()},[]),(0,i.useEffect)(()=>{p&&(async()=>{const e=p||localStorage.getItem("businessId")||"";if(e)try{const t=await(0,a.H2)("/departments/business/".concat(e),"GET");let n=[];Array.isArray(t)?n=t:null!==t&&void 0!==t&&t.data&&Array.isArray(t.data)?n=t.data:null!==t&&void 0!==t&&t.departments&&Array.isArray(t.departments)?n=t.departments:t&&"object"===typeof t&&t.name&&(n=[t]),A(n)}catch(t){console.error("Failed to fetch departments",t),A([])}})()},[p]);const P=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=p||localStorage.getItem("businessId")||"";if(!t)return r([]),void l(!1);l(!0);try{const s="/ivrs/business/".concat(t,"?page=").concat(e,"&limit=").concat(u),o=await(0,a.H2)(s,"GET");if(o&&o.success){var n;let e=[];e=Array.isArray(o.files)?o.files:Array.isArray(o.data)?o.data:Array.isArray(null===(n=o.data)||void 0===n?void 0:n.files)?o.data.files:Array.isArray(o)?o:[];const t=e.map(e=>{var t,n,i;return{...e,name:e.name||e.title||e._id||"",voice:(null===(t=e.menu)||void 0===t?void 0:t.voice)||(null===(n=e.menu)||void 0===n?void 0:n.welcome)||e.voice||e.welcome||e.generatedText||"",options:Array.isArray(e.options)?e.options:(null===(i=e.menu)||void 0===i?void 0:i.options)||[],createdAt:e.createdAt||e.uploadedAt||e.updatedAt||e.created||null,status:e.status||e.ivrStatus||e.state||"unknown",raw:e}});if(r(t),o.pagination&&o.pagination.page)try{m(o.pagination.page)}catch(i){}}else r([])}catch(s){console.error("Failed to fetch IVRs",s),r([])}finally{l(!1)}};(0,i.useEffect)(()=>{P(c)},[c]);const B=i.useMemo(()=>{try{return Array.from(new Set(n.map(e=>(e.node||e.name||e.title||"").toString()).filter(Boolean)))}catch(e){return[]}},[n]),M=async e=>{if(e)try{var t;const n=await(0,a.H2)("/departments/".concat(e,"/members"),"GET");let i=[];i=Array.isArray(n)?n:Array.isArray(n.data)?n.data:Array.isArray(null===(t=n.data)||void 0===t?void 0:t.data)?n.data.data:null!==n&&void 0!==n&&n.members&&Array.isArray(n.members)?n.members:[];const s=i.map(e=>{var t;const n=e.user||{},i=e.userId||(null===(t=e.user)||void 0===t?void 0:t._id)||e._id||e.id;return{_id:i,id:i,name:n.name||[n.firstName,n.lastName].filter(Boolean).join(" ")||n.email||n.fullName||i,email:n.email,phone:e.phone||n.phone||n.mobile||"",didNumber:e.didNumber||"",didExtension:e.didExtension||e.did_extension||"",role:e.role||n.role||"",raw:e}});return V(t=>({...t,[e]:s})),s}catch(n){return console.error("Failed to fetch department members",n),V(t=>({...t,[e]:[]})),[]}},J=()=>{f(!1),x(null)},z=e=>{if(!e)return"-";try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}};return(0,o.jsxs)(s.E$,{className:"mb-4",children:[(0,o.jsxs)(s.V0,{className:"d-flex justify-content-between align-items-center",children:[(0,o.jsx)("span",{children:"IVR Management"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("button",{className:"btn btn-sm btn-success me-2",onClick:()=>{E(null),_({node:"",voice:"",active:!0,options:[{key:"1",type:"node",target:"",agentId:"",voice:""}],menu:""}),N(!0)},children:"Add"}),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-danger me-2",onClick:async()=>{const e=p||localStorage.getItem("businessId")||"";if(e&&window.confirm("Delete ALL IVRs for this business? This cannot be undone."))try{w(!0);const t="/ivrs/business/".concat(e),n=await(0,a.H2)(t,"DELETE");n&&n.success?(console.log("Deleted all IVRs",n),P(1)):console.error("Failed to delete IVRs",n)}catch(t){console.error("Error deleting IVRs",t)}finally{w(!1)}},disabled:k||d,children:"Delete all"}),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>P(1),disabled:d,children:"Refresh"}),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-secondary me-2",onClick:()=>m(e=>Math.max(1,e-1)),disabled:1===c||d,children:"Prev"}),(0,o.jsxs)("span",{className:"mx-2",children:["Page ",c]}),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>m(e=>e+1),disabled:d,children:"Next"})]})]}),(0,o.jsxs)(s.W6,{children:[!p&&(0,o.jsx)("div",{className:"mb-3",children:(0,o.jsxs)("div",{className:"alert alert-warning",children:["Missing ",(0,o.jsx)("code",{children:"businessId"})," in localStorage. Set it to view IVRs."]})}),(0,o.jsxs)(s.zS,{visible:b,onClose:J,alignment:"center",children:[(0,o.jsx)(s.E4,{children:(0,o.jsx)(s.lb,{children:"IVR Details"})}),(0,o.jsx)(s.Tc,{children:v?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Name:"})," ",v.name||v.title||"-"]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Virtual Number:"})," ",v.virtualNumber||v.number||"-"]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Created By:"})," ",(null===(e=v.createdBy)||void 0===e?void 0:e.email)||(null===(t=v.createdBy)||void 0===t?void 0:t.name)||"-"]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Created At:"})," ",z(v.createdAt||v.created)]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Status:"})," ",(0,o.jsx)(s.$X,{color:v.active?"success":"secondary",children:v.active?"Active":"Inactive"})]}),(0,o.jsx)("hr",{}),(0,o.jsx)("h6",{children:"Routing / Menu"}),(0,o.jsx)("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(v.menu||v.routing||v,null,2)})]}):(0,o.jsx)("div",{children:"No item selected"})}),(0,o.jsx)(s.If,{children:(0,o.jsx)(s.Q_,{color:"secondary",onClick:J,children:"Close"})})]}),(0,o.jsxs)(s.zS,{visible:j,onClose:()=>{N(!1),E(null)},alignment:"center",size:"xl",children:[(0,o.jsx)(s.E4,{children:(0,o.jsx)(s.lb,{children:C?"Edit IVR (".concat(C,")"):"Add IVR"})}),(0,o.jsxs)(s.Tc,{children:[(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("label",{className:"form-label",children:"Node (identifier)"}),(0,o.jsx)("input",{className:"form-control",value:I.node,placeholder:"e.g. menu, sales_menu",onChange:e=>_({...I,node:e.target.value})})]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("label",{className:"form-label",children:"Voice Text"}),(0,o.jsx)("input",{className:"form-control",value:I.voice,placeholder:"e.g. Welcome to Acme.",onChange:e=>_({...I,voice:e.target.value})})]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsxs)("label",{className:"form-label",children:["Options (press ",">"," target)"]}),I.options.map((e,t)=>(0,o.jsxs)("div",{className:"d-flex mb-2",children:[(0,o.jsx)("input",{style:{width:80},className:"form-control me-2",value:e.key,onChange:e=>{const n=[...I.options];n[t]={...n[t],key:e.target.value},_({...I,options:n})}}),(0,o.jsxs)("select",{className:"form-select me-2",style:{width:140},value:e.type||"node",onChange:e=>{const n=[...I.options];n[t]={...n[t],type:e.target.value,target:""},_({...I,options:n})},children:[(0,o.jsx)("option",{value:"node",children:"node"}),(0,o.jsx)("option",{value:"dept",children:"dept"})]}),"dept"===e.type?(0,o.jsxs)("div",{className:"me-2 d-flex",style:{gap:8},children:[(0,o.jsxs)("select",{className:"form-select",value:e.target||"",onChange:e=>{const n=e.target.value,i=[...I.options];i[t]={...i[t],target:n,agentId:""},_({...I,options:i}),M(n)},children:[(0,o.jsx)("option",{value:"",children:"Select department"}),S.map(e=>(0,o.jsx)("option",{value:e._id||e.id,children:e.name||e.departmentName||e.title||e.slug||e._id},e._id||e.id))]}),(0,o.jsxs)("select",{className:"form-select",value:e.agentId||"",onChange:e=>{const n=[...I.options];n[t]={...n[t],agentId:e.target.value},_({...I,options:n})},children:[(0,o.jsx)("option",{value:"",children:"Select agent (optional)"}),(()=>{const t=S.find(t=>t._id===e.target||t.id===e.target);if(!t)return null;const n=L[t._id]||L[t.id]||[],i=t.departmentHead||t.head||t.userId||t.departmentHeadId||t.department_head,s=n.find(e=>e._id===i||e.id===i);return(s?[s,...n.filter(e=>e._id!==s._id)]:n).map(e=>(0,o.jsx)("option",{value:e._id||e.id,children:e.name||e.email||e._id},e._id||e.id))})()]})]}):B.length>0?(0,o.jsxs)("select",{className:"form-select me-2",value:e.target||"",onChange:e=>{const n=[...I.options];n[t]={...n[t],target:e.target.value},_({...I,options:n})},children:[(0,o.jsx)("option",{value:"",children:"Select node"}),B.map(e=>(0,o.jsx)("option",{value:e,children:e},e))]}):(0,o.jsx)("input",{className:"form-control me-2",value:e.target,onChange:e=>{const n=[...I.options];n[t]={...n[t],target:e.target.value},_({...I,options:n})},placeholder:"e.g. sales_menu"}),(0,o.jsx)("input",{style:{width:200},className:"form-control me-2",value:e.voice||"",onChange:e=>{const n=[...I.options];n[t]={...n[t],voice:e.target.value},_({...I,options:n})},placeholder:"Option voice text (e.g. For sales)"}),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>{const e=[...I.options];e.splice(t,1),_({...I,options:e})},children:"Remove"})]},t)),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>_({...I,options:[...I.options,{key:"",type:"node",target:"",agentId:"",voice:""}]}),children:"Add option"})]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("label",{className:"form-label",children:"Advanced JSON (optional)"}),(0,o.jsx)("textarea",{className:"form-control",rows:6,value:I.menu,onChange:e=>_({...I,menu:e.target.value}),placeholder:'{"options": {"1":"node:sales_menu"}}'})]}),(0,o.jsxs)("div",{className:"form-check form-switch mb-2",children:[(0,o.jsx)("input",{className:"form-check-input",type:"checkbox",id:"ivrActive",checked:!!I.active,onChange:e=>_({...I,active:e.target.checked})}),(0,o.jsx)("label",{className:"form-check-label",htmlFor:"ivrActive",children:"Active"})]})]}),(0,o.jsxs)(s.If,{children:[(0,o.jsx)(s.Q_,{color:"secondary",onClick:()=>{N(!1),E(null)},children:"Cancel"}),(0,o.jsx)(s.Q_,{color:"primary",onClick:async()=>{const e=p||localStorage.getItem("businessId")||"";if(e)try{const i=Array.isArray(I.options)&&I.options.some(e=>e.key&&(e.target||e.voice));if(C){let n=[];if(i)I.options.forEach(e=>{if(e.key)if("dept"===e.type)if(e.agentId){let t=S.find(t=>t._id===e.target||t.id===e.target);t||(t=S.find(t=>Array.isArray(t.members)&&t.members.find(t=>t._id===e.agentId||t.userId===e.agentId||t.id===e.agentId)));const i=t?t.name||t.departmentName||t.slug||t._id:e.target||"";let s="";if(t&&Array.isArray(t.members)&&t.members.length){const n=t.members.find(t=>t._id===e.agentId||t.userId===e.agentId||t.id===e.agentId);n&&(s=n.didExtension||n.did_extension||n.didNumber||"")}if(!s){const n=(t&&(L[t._id]||L[t.id])||[]).find(t=>t._id===e.agentId||t.id===e.agentId);n&&(s=n.didExtension||n.did_extension||n.didNumber||"")}if(!s){const t=Object.keys(L);for(let n=0;n<t.length&&!s;n++){const i=(L[t[n]]||[]).find(t=>t._id===e.agentId||t.id===e.agentId);i&&(s=i.didExtension||i.did_extension||i.didNumber||"")}}const a="dept:".concat(String(i||"").toLowerCase()).concat(s?":"+String(s):"");n.push({key:e.key,voice:e.voice||"",destination:a})}else{const t=S.find(t=>t._id===e.target||t.id===e.target||t.slug&&t.slug===e.target||t.name&&t.name.toString().toLowerCase()===(e.target||"").toString().toLowerCase()),i=t?t.name||t.departmentName||t.slug||t._id:e.target,s="dept:".concat(String(i||"").toLowerCase());n.push({key:e.key,voice:e.voice||"",destination:s})}else n.push({key:e.key,voice:e.voice||"",destination:"node:".concat(e.target||"")})});else if(I.menu)try{const e=JSON.parse(I.menu);e&&"object"===typeof e&&(Array.isArray(e.options)?n=e.options:e.options&&"object"===typeof e.options&&(n=Object.keys(e.options).map(t=>({key:t,voice:e.options[t].voice||"",destination:e.options[t].destination||e.options[t]}))))}catch(t){I.menu.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).forEach(e=>{const t=e.match(/^(\d+)\s*[:=]\s*(.+)$/);t&&n.push({key:t[1],voice:"",destination:t[2].trim()})})}const s={businessId:e,menu:{voice:I.voice||"",options:n}},o=await(0,a.H2)("/ivr/update/full/".concat(encodeURIComponent(C)),"PUT",s);o&&(o.success||o.updated||o.data)?(N(!1),E(null),_({node:"",prompt:"",active:!0,options:[{key:"1",type:"node",target:"",agentId:""}],menu:""}),P(1)):console.error("Failed to update IVR",o)}else{let s={};if(i)I.options.forEach(e=>{if(e.key)if("dept"===e.type)if(e.agentId){let t=S.find(t=>t._id===e.target||t.id===e.target);t||(t=S.find(t=>Array.isArray(t.members)&&t.members.find(t=>t._id===e.agentId||t.userId===e.agentId||t.id===e.agentId)));const n=t?t.name||t.departmentName||t.slug||t._id:e.target||"";let i="";if(t&&Array.isArray(t.members)&&t.members.length){const n=t.members.find(t=>t._id===e.agentId||t.userId===e.agentId||t.id===e.agentId);n&&(i=n.didExtension||n.did_extension||n.didNumber||"")}if(!i){const n=(t&&(L[t._id]||L[t.id])||[]).find(t=>t._id===e.agentId||t.id===e.agentId);n&&(i=n.didExtension||n.did_extension||n.didNumber||"")}if(!i){const t=Object.keys(L);for(let n=0;n<t.length&&!i;n++){const s=(L[t[n]]||[]).find(t=>t._id===e.agentId||t.id===e.agentId);s&&(i=s.didExtension||s.did_extension||s.didNumber||"")}}const a="dept:".concat(String(n||"").toLowerCase()).concat(i?":"+String(i):"");s[e.key]={destination:a,voice:e.voice||""}}else{const t=S.find(t=>t._id===e.target||t.id===e.target||t.slug&&t.slug===e.target||t.name&&t.name.toString().toLowerCase()===(e.target||"").toString().toLowerCase()),n=t?t.name||t.departmentName||t.slug||t._id:e.target,i="dept:".concat(String(n||"").toLowerCase());s[e.key]={destination:i,voice:e.voice||""}}else s[e.key]={destination:"node:".concat(e.target||""),voice:e.voice||""}});else if(I.menu)try{const e=JSON.parse(I.menu);e&&"object"===typeof e&&(s=e.options&&"object"===typeof e.options?e.options:e)}catch(t){I.menu.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).forEach(e=>{const t=e.match(/^(\d+)\s*[:=]\s*(.+)$/);t&&(s[t[1]]=t[2].trim())})}const o=I.node||"menu_".concat(Date.now());let r=[];Array.isArray(s)?r=s:s&&"object"===typeof s&&(r=Object.keys(s).map(e=>{const t=s[e];return"string"===typeof t?{key:e,voice:"",destination:t}:{key:e,voice:(null===t||void 0===t?void 0:t.voice)||"",destination:(null===t||void 0===t?void 0:t.destination)||t}}));const d={businessId:e,node:o,menu:{voice:I.voice||"",options:r}};try{const e=await(0,a.H2)("/ivr/create","POST",d);e&&(e.success||e.created||e.data)?(N(!1),_({node:"",prompt:"",active:!0,options:[{key:"1",type:"node",target:"",agentId:""}],menu:""}),P(1)):console.error("Failed to create IVR",e)}catch(n){console.error("Error creating IVR",n)}}}catch(n){console.error("Error saving IVR",n)}},children:C?"Save":"Create"})]})]}),d?(0,o.jsx)("div",{className:"text-center py-4",children:(0,o.jsx)(s.JT,{})}):0===n.length?(0,o.jsx)("div",{className:"text-center py-3",children:"No IVRs found"}):(0,o.jsxs)(s._v,{hover:!0,responsive:!0,className:"table-sm compact-table branches-table",style:{tableLayout:"auto"},children:[(0,o.jsx)(s.wV,{children:(0,o.jsxs)(s.YI,{children:[(0,o.jsx)(s.$s,{style:{width:"25%"},children:"NAME"}),(0,o.jsx)(s.$s,{style:{width:"30%"},children:"VOICE"}),(0,o.jsx)(s.$s,{style:{width:"10%"},children:"OPTIONS"}),(0,o.jsx)(s.$s,{style:{width:"15%"},children:"CREATED AT"}),(0,o.jsx)(s.$s,{style:{width:"10%"},children:"ACTION"}),(0,o.jsx)(s.$s,{className:"text-center",style:{width:"10%"},children:"STATUS"})]})}),(0,o.jsx)(s.jS,{children:n.map(e=>(0,o.jsxs)(i.Fragment,{children:[(0,o.jsxs)(s.YI,{onClick:()=>(e=>{const t=new Set(h);t.has(e)?t.delete(e):t.add(e),y(t)})(e._id||e.id||e.name),style:{cursor:"pointer",backgroundColor:h.has(e._id||e.id||e.name)?"#f8f9fa":"transparent"},role:"button",tabIndex:0,children:[(0,o.jsx)(s.cC,{className:"align-middle",children:(0,o.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,o.jsx)("div",{style:{fontSize:"1.1rem",marginRight:10},children:h.has(e._id||e.id||e.name)?"\u25bc":"\u25b6"}),(0,o.jsx)("div",{className:"agent-name",children:e.name||"-"})]})}),(0,o.jsx)(s.cC,{className:"align-middle",children:(0,o.jsx)("div",{className:"manager-email",children:e.voice||"-"})}),(0,o.jsx)(s.cC,{className:"align-middle",children:(0,o.jsx)("div",{className:"agent-number",children:Array.isArray(e.options)?e.options.length:e.totalMenuOptions||"-"})}),(0,o.jsx)(s.cC,{className:"align-middle",children:(0,o.jsx)("div",{className:"department-name",children:z(e.createdAt)})}),(0,o.jsx)(s.cC,{className:"align-middle",children:(0,o.jsx)("div",{children:(0,o.jsx)("button",{className:"btn btn-sm btn-warning",onClick:t=>{t.stopPropagation(),(async e=>{var t,n;const i=e.name||e.node||e._id,s=e.voice||(null===(t=e.menu)||void 0===t?void 0:t.voice)||"",a=(Array.isArray(e.options)?e.options:(null===(n=e.menu)||void 0===n?void 0:n.options)||[]).map(e=>{const t=(e.destination||e.destinationType||"").toString().split(":"),n=t[0]||"node",i=t.slice(1);if("agent"===n){const t=i.join(":")||"";return{key:e.key||e._id||"",type:"dept",target:"",agentId:t||"",voice:e.voice||e.text||""}}if("dept"===n){const t=i[0]||"",n=i[1]||"",s=S.find(e=>e._id===t||e.id===t||e.name&&e.name.toString().toLowerCase()===t.toString().toLowerCase()||e.slug&&e.slug===t),a=s?s._id||s.id:t;let o="";if(n&&s){const e=Array.isArray(s.members)?s.members.find(e=>String(e.didExtension||e.did_extension||e.didNumber||"").toString()===String(n)):null;if(e&&(o=e._id||e.id||e.userId||""),!o){const e=(L[s._id]||L[s.id]||[]).find(e=>String(e.didExtension||e.did_extension||e.didNumber||"").toString()===String(n));e&&(o=e._id||e.id||"")}}return{key:e.key||e._id||"",type:"dept",target:a||"",agentId:o||"",voice:e.voice||e.text||"",ext:n||""}}return{key:e.key||e._id||"",type:"node",target:i.join(":")||"",agentId:"",voice:e.voice||e.text||""}});_({node:i,voice:s,active:"active"===e.status||"on"===e.ivrStatus||"on"===e.status,options:a.length?a:[{key:"1",type:"node",target:"",agentId:"",voice:""}],menu:""}),E(i),N(!0),a.forEach(async(e,t)=>{if("dept"===e.type&&e.target){const n=await M(e.target);if(e.ext){const i=(Array.isArray(n)?n:[]).find(t=>String(t.didExtension||t.did_extension||t.didNumber||"").toString()===String(e.ext));i&&_(e=>{const n=Array.isArray(e.options)?[...e.options]:[];return n[t]?(n[t]={...n[t],agentId:i._id||i.id||i.userId||""},{...e,options:n}):e})}}})})(e)},children:"Edit"})})}),(0,o.jsx)(s.cC,{className:"text-center align-middle",children:(0,o.jsx)(s.$X,{color:"active"===e.status||"on"===e.status?"success":"secondary",children:e.status||"-"})})]}),h.has(e._id||e.id||e.name)&&(0,o.jsx)(s.YI,{children:(0,o.jsx)(s.cC,{colSpan:6,style:{padding:"1rem",backgroundColor:"#f8f9fa"},children:(0,o.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,o.jsxs)("div",{style:{flex:1},children:[(0,o.jsx)("h6",{className:"mb-2",children:"IVR Details"}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"File:"})," ",e.fileName||e.audioFile||e._id||"-",(e.fileName||e.audioFile||e._id)&&(0,o.jsx)(o.Fragment,{children:$===(e._id||e.id||e.fileName||e.audioFile)?(0,o.jsx)("button",{className:"btn btn-sm btn-outline-danger ms-2",onClick:e=>{e.stopPropagation(),(()=>{if(U){try{U.pause()}catch(e){}try{window.URL.revokeObjectURL(O)}catch(e){}}D(null),F(null),H(null)})()},children:"Stop"}):(0,o.jsx)("button",{className:"btn btn-sm btn-outline-primary ms-2",onClick:t=>{t.stopPropagation(),(async e=>{try{const n=p||localStorage.getItem("businessId")||"",i=e._id||e.id;let s="";if(i)s="/ivrs/download/".concat(encodeURIComponent(i),"?businessId=").concat(encodeURIComponent(n));else{const t=e.fileName||e.audioFile;if(!t)return;s="/ivr/download/".concat(encodeURIComponent(t),"?businessId=").concat(encodeURIComponent(n))}const o=await(0,a.H2)(s,"GET",null,{responseType:"arraybuffer"});if(!o)return;const r=e.mimeType||"audio/wav",d=new Blob([o],{type:r}),l=window.URL.createObjectURL(d);if(U){try{U.pause()}catch(t){}try{window.URL.revokeObjectURL(O)}catch(t){}}const c=new Audio(l);F(l),D(c),H(e._id||e.id||name),c.play().catch(e=>{console.error("Audio play failed",e)}),c.onended=()=>{try{window.URL.revokeObjectURL(l)}catch(t){}F(null),D(null),H(null)}}catch(n){console.error("Failed to play IVR file",n)}})(e)},children:"Play"})})]}),(0,o.jsx)("div",{className:"mb-2",children:(0,o.jsx)("strong",{children:"Menu Options:"})}),(0,o.jsx)("div",{children:Array.isArray(e.options)&&e.options.length>0?e.options.map(e=>(0,o.jsxs)("div",{className:"mb-1 p-2",style:{backgroundColor:"#fff",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Key:"})," ",e.key]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Voice:"})," ",e.voice||e.text||"-"]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Destination:"})," ",e.destination||e.destinationType||e.destination||"-"]})]},e._id||e.key)):(0,o.jsx)("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(e.menu||e.raw||{},null,2)})})]}),(0,o.jsx)("div",{className:"ms-3",children:(0,o.jsx)("div",{children:(0,o.jsx)(s.Q_,{size:"sm",color:"primary",onClick:t=>{t.stopPropagation(),x(e),f(!0)},children:"Details"})})})]})})})]},e._id||e.id||e.name))})]})]})]})}}}]);