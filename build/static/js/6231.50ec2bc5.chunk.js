"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[6231],{10185:function(e,s,t){t.d(s,{B:function(){return a}});const a=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"]},50323:function(e,s,t){t.d(s,{Z:function(){return a}});const a=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M96,472a23.82,23.82,0,0,0,23.579,24H392.421A23.82,23.82,0,0,0,416,472V152H96Zm32-288H384V464H128Z' class='ci-primary'/><rect width='32' height='200' x='168' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='240' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='312' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M328,88V40c0-13.458-9.488-24-21.6-24H205.6C193.488,16,184,26.542,184,40V88H64v32H448V88ZM216,48h80V88H216Z' class='ci-primary'/>"]},66231:function(e,s,t){t.r(s),t.d(s,{default:function(){return p}});var a=t(9950),n=t(55271),c=t(49911),o=t(81949),l=t(82754),i=t(71293),r=t(10185),d=t(27760),m=t(50323),h=t(2720),u=t(44414);var p=()=>{const[e,s]=(0,a.useState)(""),[t,p]=(0,a.useState)(1),[x]=(0,a.useState)(10),[j,g]=(0,a.useState)(!1),[y,f]=(0,a.useState)(!1),[v,C]=(0,a.useState)(null),[w,b]=(0,a.useState)(!1),[N,S]=(0,a.useState)(""),[A,I]=(0,a.useState)(!1),[_,k]=(0,a.useState)({name:""}),[E,T]=(0,a.useState)(null),[L,P]=(0,a.useState)([]),[B,U]=(0,a.useState)(""),[D,F]=(0,a.useState)([]),[H,O]=(0,a.useState)(""),[z,M]=(0,a.useState)([]),[Q,J]=(0,a.useState)(!1),[Z,G]=(0,a.useState)(null),[V,W]=(0,a.useState)({show:!1,message:""}),[Y,$]=(0,a.useState)(""),[K,X]=(0,a.useState)([]),[q,R]=(0,a.useState)(!0),[ee,se]=(0,a.useState)(!1),[te,ae]=(0,a.useState)(null),[ne,ce]=(0,a.useState)(0),oe=()=>{ce(e=>e+1)};(0,a.useEffect)(()=>{(async()=>{R(!0),ae(null);try{let s="";const a=localStorage.getItem("authToken");if(a){var e;const t=await fetch("/api/v1/user/details",{headers:{Authorization:"Bearer ".concat(a)}}),n=await t.json();s=(null===n||void 0===n||null===(e=n.user)||void 0===e?void 0:e.businessId)||localStorage.getItem("businessId")}else s=localStorage.getItem("businessId");if(!s)throw new Error("Business ID not found. Please login again.");const n=await(0,h.H2)("contact-list/business/".concat(s),"GET",null,{params:{page:t,limit:x,sortBy:"createdAt",order:"desc"}});if(console.log("API Response:",n),!n)throw new Error("No response received from API");let c=n.data||n,o=[];if(c&&c.success&&Array.isArray(c.data))o=c.data;else if(c&&Array.isArray(c.data))o=c.data;else if(Array.isArray(c))o=c;else{if(c&&!1===c.success)throw new Error(c.message||"API returned error");console.log("Unexpected API response format:",c),o=[]}X(o.map(e=>({id:e._id||e.id,name:e.name||"Unnamed List",contacts:Array.isArray(e.contacts)?e.contacts.length:0,lastUpdated:e.lastUpdated||e.updatedAt||e.createdAt||(new Date).toISOString().split("T")[0],status:e.status||"Active",businessName:e.businessName||"Business"})))}catch(s){console.error("Failed to fetch contact lists:",s),ae("Failed to fetch contact lists. Please try again later.")}finally{R(!1)}})()},[ne]),(0,a.useEffect)(()=>{j&&!Z&&(async()=>{se(!0);try{const{data:e}=await(0,h.H2)("contacts","GET");let s=[];e&&e.success&&Array.isArray(e.data)?s=e.data:Array.isArray(e)?s=e:e&&Array.isArray(e.contacts)?s=e.contacts:e&&Array.isArray(e.result)&&(s=e.result);const t=s.map(e=>({id:e._id||e.id||"contact-".concat(Date.now(),"-").concat(Math.random()),name:e.fullName||e.name||e.firstName||"Unnamed Contact",phone:e.phone||e.phoneNumber||"",email:e.email||"",company:e.company||e.organization||""}));F(t),0===t.length&&F([{id:"mock-contact-1",name:"John Doe",phone:"+1234567890",email:"john.doe@example.com",company:"Example Corp"},{id:"mock-contact-2",name:"Jane Smith",phone:"+0987654321",email:"jane.smith@example.com",company:"Tech Solutions"},{id:"mock-contact-3",name:"Bob Wilson",phone:"+1122334455",email:"bob.wilson@example.com",company:"Business Inc"}])}catch(e){console.error("Failed to fetch contacts:",e),F([{id:"mock-contact-1",name:"John Doe",phone:"+1234567890",email:"john.doe@example.com",company:"Example Corp"},{id:"mock-contact-2",name:"Jane Smith",phone:"+0987654321",email:"jane.smith@example.com",company:"Tech Solutions"},{id:"mock-contact-3",name:"Bob Wilson",phone:"+1122334455",email:"bob.wilson@example.com",company:"Business Inc"}])}finally{se(!1)}})()},[j,Z]);const le=K.filter(s=>s.name.toLowerCase().includes(e.toLowerCase())),ie=t*x,re=ie-x,de=le.slice(re,ie),me=Math.ceil(le.length/x),he=e=>{p(e)},ue=()=>{g(!0)},pe=()=>{g(!1),k({name:""}),O(""),M([]),G(null),$(""),T(null),P([]),U("")},xe=e=>{const s=new FileReader;s.onload=s=>{try{const t=s.target.result;let a=[];if(e.name.toLowerCase().endsWith(".csv")){const e=t.split("\n");for(let s=e[0]&&(e[0].toLowerCase().includes("name")||e[0].toLowerCase().includes("phone"))?1:0;s<e.length;s++){const t=e[s].trim();if(t){const e=t.split(",").map(e=>e.trim().replace(/["']/g,""));e.length>=2&&e[0]&&e[1]&&a.push({id:"upload-".concat(Date.now(),"-").concat(s),name:e[0]||"Contact ".concat(s+1),phone:e[1]||"",email:e[2]||"",company:e[3]||""})}}}else if(e.name.toLowerCase().endsWith(".xlsx")||e.name.toLowerCase().endsWith(".xls")){const e=n.read(t,{type:"array"}),s=e.SheetNames[0],c=e.Sheets[s],o=n.utils.sheet_to_json(c,{header:1});for(let t=o[0]&&(String(o[0][0]).toLowerCase().includes("name")||String(o[0][1]).toLowerCase().includes("phone"))?1:0;t<o.length;t++){const e=o[t];e&&e.length>=2&&e[0]&&e[1]&&a.push({id:"upload-".concat(Date.now(),"-").concat(t),name:String(e[0]||"Contact ".concat(t+1)),phone:String(e[1]||""),email:String(e[2]||""),company:String(e[3]||"")})}}P(a),0===a.length&&U("No valid contacts found in the file. Please ensure your file has Name and Phone columns.")}catch(te){U("Error processing file. Please check the file format and try again."),console.error("File processing error:",te)}},e.name.toLowerCase().endsWith(".csv")?s.readAsText(e):s.readAsArrayBuffer(e)},je=()=>{f(!1),C(null)};return(0,u.jsxs)("div",{className:"contact-lists-container",children:[V.show&&(0,u.jsx)(c.kj,{color:"success",dismissible:!0,onClose:()=>W({show:!1,message:""}),children:V.message}),(0,u.jsx)(c.E$,{className:"mb-4",children:(0,u.jsxs)(c.W6,{children:[(0,u.jsxs)(c.sK,{className:"mb-4 align-items-center",children:[(0,u.jsx)(c.UF,{md:6,children:(0,u.jsx)("h1",{className:"contact-list-title",children:"Contact Lists"})}),(0,u.jsxs)(c.UF,{md:6,className:"d-flex justify-content-end gap-2",children:[(0,u.jsxs)(c.Q_,{color:"info",onClick:()=>{const e=n.utils.aoa_to_sheet([["Name*","Email*","Phone*","Company","Position","Location","Tags (comma-separated)","Notes"]]);n.utils.sheet_add_aoa(e,[["John Doe","john.doe@example.com","+91 9876543210","ABC Company","Manager","Mumbai","client,vip","Key decision maker"]],{origin:"A2"});const s=n.utils.book_new();n.utils.book_append_sheet(s,e,"Contact Template"),n.writeFile(s,"contact_upload_template.xlsx")},children:[(0,u.jsx)(o.Ay,{icon:l.o,className:"me-2"}),"Download Template"]}),(0,u.jsxs)(c.Q_,{color:"primary",className:"add-contact-btn",onClick:ue,children:[(0,u.jsx)(o.Ay,{icon:i.x,className:"me-2"}),"New List"]})]})]}),(0,u.jsx)(c.sK,{className:"mb-4",children:(0,u.jsx)(c.UF,{md:6,children:(0,u.jsxs)(c.BG,{children:[(0,u.jsx)(c.OG,{placeholder:"Search contact lists...",value:e,onChange:e=>s(e.target.value)}),(0,u.jsx)(c.Q_,{type:"button",color:"primary",variant:"outline",children:(0,u.jsx)(o.Ay,{icon:r.B})})]})})}),(0,u.jsxs)(c._v,{hover:!0,responsive:!0,className:"contact-list-table",children:[(0,u.jsx)(c.wV,{children:(0,u.jsxs)(c.YI,{children:[(0,u.jsx)(c.$s,{children:"S.NO"}),(0,u.jsx)(c.$s,{children:"CONTACT LIST NAME"}),(0,u.jsx)(c.$s,{children:"NO OF CONTACTS"}),(0,u.jsx)(c.$s,{className:"text-center",children:"ACTIONS"})]})}),(0,u.jsx)(c.jS,{children:q?(0,u.jsx)(c.YI,{children:(0,u.jsxs)(c.cC,{colSpan:"4",className:"text-center py-5",children:[(0,u.jsx)(c.JT,{color:"primary"}),(0,u.jsx)("div",{className:"mt-3",children:"Loading contact lists..."})]})}):te?(0,u.jsx)(c.YI,{children:(0,u.jsx)(c.cC,{colSpan:"4",className:"text-center py-5",children:(0,u.jsx)(c.kj,{color:"danger",className:"mb-0",children:te})})}):0===de.length?(0,u.jsx)(c.YI,{children:(0,u.jsx)(c.cC,{colSpan:"4",className:"text-center py-5",children:(0,u.jsxs)("div",{className:"empty-state",children:[(0,u.jsx)("div",{className:"empty-state-icon",children:(0,u.jsx)(o.Ay,{icon:i.x,size:"xl"})}),(0,u.jsx)("h4",{children:"No contact lists found"}),(0,u.jsx)("p",{children:"Create your first contact list to get started."}),(0,u.jsx)(c.Q_,{color:"primary",className:"mt-3",onClick:ue,children:"Create Contact List"})]})})}):de.map((e,s)=>(0,u.jsxs)(c.YI,{children:[(0,u.jsx)(c.cC,{children:(0,u.jsx)("div",{className:"list-number",children:re+s+1})}),(0,u.jsx)(c.cC,{children:(0,u.jsx)("div",{className:"list-name",children:e.name})}),(0,u.jsx)(c.cC,{children:(0,u.jsx)("div",{className:"list-contacts",children:e.contacts})}),(0,u.jsxs)(c.cC,{className:"text-center",children:[(0,u.jsx)(c.Q_,{color:"light",onClick:()=>(async e=>{G(e),k({name:e.name}),se(!0);try{const{data:s}=await(0,h.H2)("contacts","GET");if(s&&s.success&&Array.isArray(s.data)){const t=s.data.map(e=>({id:e._id||e.id,name:e.fullName||e.name||"Unnamed Contact",phone:e.phone||"",email:e.email||"",company:e.company||""}));F(t);const{data:a}=await(0,h.H2)("contact-list/".concat(e.id),"GET");if(a&&a.success&&a.data&&Array.isArray(a.data.contacts)){const e=a.data.contacts.map(e=>"object"===typeof e?e._id||e.id:e),s=t.filter(s=>e.includes(s.id));M(s)}}}catch(s){console.error("Failed to fetch list contacts:",s)}finally{se(!1)}g(!0)})(e),className:"me-2",children:(0,u.jsx)(o.Ay,{icon:d.K})}),(0,u.jsx)(c.Q_,{color:"danger",onClick:()=>{return s=e.id,C(s),f(!0),S(""),void I(!1);var s},disabled:w&&v===e.id,children:w&&v===e.id?(0,u.jsx)(c.JT,{size:"sm"}):(0,u.jsx)(o.Ay,{icon:m.Z})})]})]},e.id))})]}),(0,u.jsxs)(c._l,{"aria-label":"Page navigation example",className:"justify-content-center",style:{display:me>1?"flex":"none"},children:[(0,u.jsx)(c.Xp,{disabled:1===t,onClick:()=>he(t-1),children:"Previous"}),[...Array(me)].map((e,s)=>(0,u.jsx)(c.Xp,{active:s+1===t,onClick:()=>he(s+1),children:s+1},s)),(0,u.jsx)(c.Xp,{disabled:t===me,onClick:()=>he(t+1),children:"Next"})]})]})}),(0,u.jsxs)(c.zS,{visible:j,onClose:pe,size:"lg",children:[(0,u.jsx)(c.E4,{children:(0,u.jsx)(c.lb,{children:Z?"Edit Contact List":"New Contact List"})}),(0,u.jsxs)(c.Tc,{children:[Y&&(0,u.jsx)(c.kj,{color:"danger",dismissible:!0,onClose:()=>$(""),children:Y}),(0,u.jsxs)(c.qI,{children:[(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)(c.A6,{htmlFor:"listName",children:"List Name"}),(0,u.jsx)(c.OG,{type:"text",id:"listName",name:"name",value:_.name,onChange:e=>{const{name:s,value:t}=e.target;k(e=>({...e,[s]:t}))},placeholder:"Enter list name",required:!0})]}),(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)(c.A6,{htmlFor:"fileUpload",children:"Upload Contacts File"}),(0,u.jsx)(c.OG,{type:"file",id:"fileUpload",accept:".xlsx,.csv",onChange:e=>{const s=e.target.files[0];if(!s)return;U(""),P([]);const t=s.name.toLowerCase().split(".").pop();["xlsx","csv","xls"].includes(t)?(T(s),xe(s)):U("Please upload only .xlsx or .csv files")},className:"mb-2"}),(0,u.jsxs)("div",{className:"text-muted small",children:[(0,u.jsx)("i",{className:"bi bi-info-circle me-1"}),"Please upload a .xlsx or .csv file containing contact information (Name, Phone, Email, Company)"]}),B&&(0,u.jsx)(c.kj,{color:"danger",className:"mt-2 mb-0",children:B}),E&&!B&&(0,u.jsxs)("div",{className:"mt-2",children:[(0,u.jsxs)(c.$X,{color:"success",className:"me-2",children:[(0,u.jsx)("i",{className:"bi bi-check-circle me-1"}),"File uploaded: ",E.name]}),(0,u.jsxs)("span",{className:"text-muted small",children:["(",L.length," contacts found)"]})]})]}),L.length>0&&(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsxs)("h5",{children:["Uploaded Contacts (",L.length,")"]}),(0,u.jsxs)("div",{className:"uploaded-contacts-container",style:{maxHeight:"200px",overflowY:"auto"},children:[L.slice(0,5).map(e=>(0,u.jsx)("div",{className:"uploaded-contact d-flex justify-content-between align-items-center p-2 mb-2 border rounded bg-light",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{className:"fw-bold",children:e.name}),(0,u.jsxs)("div",{className:"small text-muted",children:[e.phone,e.email&&" | ".concat(e.email),e.company&&" | ".concat(e.company)]})]})},e.id)),L.length>5&&(0,u.jsxs)("div",{className:"text-center text-muted small",children:["... and ",L.length-5," more contacts"]})]})]})]})]}),(0,u.jsxs)(c.If,{children:[(0,u.jsx)(c.Q_,{color:"secondary",onClick:pe,children:"Cancel"}),(0,u.jsxs)(c.Q_,{color:"primary",onClick:async()=>{if(_.name.trim())if(0!==L.length){$(""),J(!0);try{if(Z){let t="",a="";const n=localStorage.getItem("authToken");if(n){var e,s;const c=await fetch("/api/v1/user/details",{headers:{Authorization:"Bearer ".concat(n)}}),o=await c.json();t=(null===o||void 0===o||null===(e=o.user)||void 0===e?void 0:e.businessId)||localStorage.getItem("businessId"),a=(null===o||void 0===o||null===(s=o.user)||void 0===s?void 0:s.branchId)||localStorage.getItem("branchId")}else t=localStorage.getItem("businessId"),a=localStorage.getItem("branchId");if(!t)throw new Error("Business ID not found. Please login again.");const c=L.map(e=>e.id),o=await(0,h.H2)("contact-list/".concat(Z.id),"PUT",{name:_.name,businessId:t,branchId:a,contacts:c});if(!o||!o.success)throw new Error("Error updating contact list");o&&o.success&&(X(e=>e.map(e=>e.id===Z.id?{...e,name:_.name,contacts:c.length,lastUpdated:(new Date).toISOString().split("T")[0]}:e)),W({show:!0,message:'Contact list "'.concat(_.name,'" has been updated successfully with ').concat(c.length," contacts.")}),oe())}else{let e="",s="";const n=localStorage.getItem("authToken");if(n){var t,a;const c=await fetch("/api/v1/user/details",{headers:{Authorization:"Bearer ".concat(n)}}),o=await c.json();e=(null===o||void 0===o||null===(t=o.user)||void 0===t?void 0:t.businessId)||localStorage.getItem("businessId"),s=(null===o||void 0===o||null===(a=o.user)||void 0===a?void 0:a.branchId)||localStorage.getItem("branchId")}else e=localStorage.getItem("businessId"),s=localStorage.getItem("branchId");if(!e)throw new Error("Business ID not found. Please login again.");const c=L.map(e=>e.id),o=await(0,h.H2)("contact-list","POST",{name:_.name,businessId:e,branchId:s,contacts:c});if(!o||!o.success)throw new Error("Error creating contact list");const l=o;if(l&&l.success&&l.data){const e=l.data,s={id:e._id||e.id,name:e.name,contacts:c.length,lastUpdated:e.updatedAt||e.createdAt||(new Date).toISOString().split("T")[0],status:e.status||"Active",businessName:e.businessName||"Business"};X(e=>[...e,s]),W({show:!0,message:'New contact list "'.concat(e.name,'" has been created successfully with ').concat(c.length," contacts.")}),oe()}}}catch(te){return console.error("Error saving contact list:",te),void $("Failed to ".concat(Z?"update":"create"," contact list: ").concat(te.message))}finally{J(!1)}pe(),setTimeout(()=>{W({show:!1,message:""})},5e3)}else $("Please upload a file with contacts for the list.");else $("List name is required.")},disabled:Q,children:[Q?(0,u.jsx)(c.JT,{size:"sm",className:"me-2"}):null,Z?"Update":"Create"," List"]})]})]}),(0,u.jsxs)(c.zS,{visible:y,onClose:je,children:[(0,u.jsx)(c.E4,{closeButton:!0,children:(0,u.jsx)(c.lb,{children:"Confirm Deletion"})}),(0,u.jsxs)(c.Tc,{children:[N&&(0,u.jsx)(c.kj,{color:"danger",children:N}),A&&(0,u.jsx)(c.kj,{color:"success",children:"Contact list has been deleted successfully."}),(0,u.jsx)("p",{children:"Are you sure you want to delete this contact list?"})]}),(0,u.jsxs)(c.If,{children:[(0,u.jsx)(c.Q_,{color:"secondary",onClick:je,children:"Cancel"}),(0,u.jsx)(c.Q_,{color:"danger",onClick:async()=>{if(v){b(!0),S("");try{const e=await(0,h.H2)("contact-list/".concat(v),"DELETE");if(!e||!e.success)throw new Error("Error deleting contact list");X(e=>e.filter(e=>e.id!==v)),I(!0),oe(),setTimeout(()=>{f(!1),C(null),I(!1)},1500)}catch(te){console.error("Error deleting contact list:",te),S("An error occurred while deleting the contact list. Please try again.")}finally{b(!1)}}},disabled:w,children:w?(0,u.jsx)(c.JT,{size:"sm"}):"Delete"})]})]})]})}},71293:function(e,s,t){t.d(s,{x:function(){return a}});const a=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"]}}]);