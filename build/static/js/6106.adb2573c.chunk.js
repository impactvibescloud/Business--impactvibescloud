"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[6106],{36106:function(e,l,s){s.r(l);var i=s(9950),n=s(49911),t=s(26910),a=s(2720),o=s(44414);l.default=()=>{var e,l,s,d,c,r,v,u,m,h,x,p,j;const[g,b]=(0,i.useState)([]),[N,f]=(0,i.useState)(!1),[y,w]=(0,i.useState)(1),[C]=(0,i.useState)(50),[S,L]=(0,i.useState)(localStorage.getItem("businessId")||""),[D,k]=(0,i.useState)(""),[_,A]=(0,i.useState)(""),[I,$]=(0,i.useState)({level1:!1,level2:!1,level3:!1}),[R,E]=(0,i.useState)(new Set),[T,X]=(0,i.useState)(null),[U,F]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{if(!S)try{const l=await(0,a.H2)("/v1/user/details","GET"),s=l.user||l.data||l;if(s&&s.businessId){L(s.businessId);try{localStorage.setItem("businessId",s.businessId)}catch(e){}}}catch(l){}})()},[]);const P=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const l=S||localStorage.getItem("businessId")||"";if(!l)return console.warn("CallDispositions: missing businessId \u2014 attempting to prefill from user details or skip"),b([]),void f(!1);f(!0);try{const i=["page=".concat(e),"limit=".concat(C),"includeDispositions=true"];D&&i.push("startDate=".concat(encodeURIComponent(D))),_&&i.push("endDate=".concat(encodeURIComponent(_)));const n="/call-logs/business/".concat(l,"?").concat(i.join("&"));try{console.debug("CallDispositions -> Request",{endpoint:n,businessId:l,startDateFilter:D,endDateFilter:_,hasAuth:!!localStorage.getItem("authToken"),axiosBaseURL:t.A.defaults.baseURL,fullUrlPreview:"".concat(t.A.defaults.baseURL||"").concat(n)})}catch(s){}const o=await(0,a.H2)(n,"GET");if(o&&o.success){let e=[];const l=o.data||[];Array.isArray(l)&&l.forEach(l=>{var s,i;if(!l)return;let n=null;l.dispositions&&(Array.isArray(l.dispositions.level3)&&l.dispositions.level3.length>0?n=l.dispositions.level3[0]:Array.isArray(l.dispositions.level2)&&l.dispositions.level2.length>0?n=l.dispositions.level2[0]:Array.isArray(l.dispositions.level1)&&l.dispositions.level1.length>0&&(n=l.dispositions.level1[0])),!n&&l.dispositionSnapshot&&(n={level1:l.dispositionSnapshot.level1,level2:l.dispositionSnapshot.level2,level3:l.dispositionSnapshot.level3}),e.push({...l,...n,callLog:{callDate:l.callDate,contact:l.contact,virtualNumber:l.virtualNumber,duration:l.duration,status:l.status},agent:l.agent||n&&n.agent,code:(null===(s=n)||void 0===s?void 0:s.code)||null,note:(null===(i=n)||void 0===i?void 0:i.note)||l.notes||null,raw:l})});const i=e,n={level1:!1,level2:!1,level3:!1};i.forEach(e=>{e.level1&&(n.level1=!0),e.level2&&(n.level2=!0),e.level3&&(n.level3=!0)});const t=i;if($(n),b(t),o.pagination&&o.pagination.page)try{w(o.pagination.page)}catch(s){}}else b([])}catch(i){console.error("Failed to fetch dispositions",i),b([])}finally{f(!1)}};(0,i.useEffect)(()=>{P(y)},[y]);const V=e=>{if(!e)return"-";try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(l){return e}},M=()=>{F(!1),X(null)};return(0,o.jsxs)(n.E$,{className:"mb-4",children:[(0,o.jsx)("style",{children:"\n        /* Compact table tweaks scoped to this component */\n        .compact-table th, .compact-table td {\n          padding: 0.25rem 0.4rem !important;\n          vertical-align: middle !important;\n          line-height: 1.15 !important;\n        }\n        .compact-table td { overflow: hidden; text-overflow: ellipsis; }\n        .compact-table .note-col { white-space: normal !important; }\n        .compact-table .nowrap { white-space: nowrap !important; }\n      "}),(0,o.jsxs)(n.V0,{className:"d-flex justify-content-between align-items-center",children:[(0,o.jsx)("span",{children:"Call Dispositions"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>P(1),disabled:N,children:"Refresh"}),(0,o.jsx)("input",{type:"date",className:"form-control form-control-sm d-inline-block me-2",style:{width:150},value:D,onChange:e=>k(e.target.value),placeholder:"Start date"}),(0,o.jsx)("input",{type:"date",className:"form-control form-control-sm d-inline-block me-2",style:{width:150},value:_,onChange:e=>A(e.target.value),placeholder:"End date"}),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-success me-2",onClick:()=>P(1),disabled:N,children:"Apply"}),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-secondary me-2",onClick:()=>{k(""),A(""),P(1)},disabled:N,children:"Clear"}),!1,(0,o.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>w(e=>Math.max(1,e-1)),disabled:1===y||N,children:"Prev"}),(0,o.jsxs)("span",{className:"mx-2",children:["Page ",y]}),(0,o.jsx)("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>w(e=>e+1),disabled:N,children:"Next"})]})]}),(0,o.jsxs)(n.W6,{children:[!S&&(0,o.jsx)("div",{className:"mb-3",children:(0,o.jsxs)(n.kj,{color:"warning",children:["Missing ",(0,o.jsx)("code",{children:"businessId"})," in localStorage. Set it to view dispositions."]})}),(0,o.jsxs)(n.zS,{visible:U,onClose:M,alignment:"center",children:[(0,o.jsx)(n.E4,{children:(0,o.jsx)(n.lb,{children:"Disposition Details"})}),(0,o.jsx)(n.Tc,{children:T?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"mb-3",children:[(0,o.jsx)("strong",{children:"Agent:"})," ",(null===(e=T.agent)||void 0===e||null===(l=e.email)||void 0===l?void 0:l.split("@")[0])||(null===(s=T.agent)||void 0===s?void 0:s._id)||"-",(null===(d=T.agent)||void 0===d?void 0:d.email)&&(0,o.jsx)("div",{className:"text-muted small",children:T.agent.email})]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Contact:"})," ",(null===(c=T.callLog)||void 0===c?void 0:c.contact)||T.contact||"-"]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Virtual Number:"})," ",(null===(r=T.callLog)||void 0===r?void 0:r.virtualNumber)||T.virtualNumber||"-"]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Call Date:"})," ",(e=>{if(!e)return"-";try{return new Date(e).toLocaleString()}catch(l){return e}})((null===(v=T.callLog)||void 0===v?void 0:v.callDate)||T.callDate)]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Duration:"})," ",null!==(u=T.callLog)&&void 0!==u&&u.duration||T.duration?"".concat((null===(m=T.callLog)||void 0===m?void 0:m.duration)||T.duration,"s"):"-"]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Call Type:"})," ",T.callType||"-"]}),(0,o.jsx)("hr",{}),(0,o.jsx)("h6",{children:"Disposition Path"}),(0,o.jsxs)("div",{className:"mb-2",children:[I.level1&&(0,o.jsxs)("div",{className:"mb-1",children:[(0,o.jsx)(n.$X,{color:"primary",className:"me-1",children:"Level 1"}),(0,o.jsx)("span",{children:T.level1||"-"})]}),I.level2&&(0,o.jsxs)("div",{className:"mb-1",children:[(0,o.jsx)(n.$X,{color:"info",className:"me-1",children:"Level 2"}),(0,o.jsx)("span",{children:T.level2||"-"})]}),I.level3&&(0,o.jsxs)("div",{className:"mb-1",children:[(0,o.jsx)(n.$X,{color:"secondary",className:"me-1",children:"Level 3"}),(0,o.jsx)("span",{children:T.level3||"-"})]})]}),(0,o.jsx)("hr",{}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Code:"})," ",T.code||"-"]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Note:"})," ",T.note||"-"]}),(0,o.jsxs)("div",{className:"mb-2",children:[(0,o.jsx)("strong",{children:"Call Status:"})," ",(0,o.jsx)(n.$X,{color:"closed"===(null===(h=T.callLog)||void 0===h?void 0:h.status)||"closed"===T.status?"success":"completed"===(null===(x=T.callLog)||void 0===x?void 0:x.status)||"completed"===T.status?"info":"failed"===(null===(p=T.callLog)||void 0===p?void 0:p.status)||"failed"===T.status?"danger":"secondary",children:(null===(j=T.callLog)||void 0===j?void 0:j.status)||T.status||"-"})]})]}):(0,o.jsx)("div",{children:"No item selected"})}),(0,o.jsx)(n.If,{children:(0,o.jsx)(n.Q_,{color:"secondary",onClick:M,children:"Close"})})]}),N?(0,o.jsx)("div",{className:"text-center py-4",children:(0,o.jsx)(n.JT,{})}):0===g.length?(0,o.jsx)("div",{className:"text-center py-3",children:"No call logs found"}):(0,o.jsxs)(n._v,{hover:!0,responsive:!0,className:"table-sm compact-table",style:{tableLayout:"auto"},children:[(0,o.jsx)(n.wV,{children:(0,o.jsxs)(n.YI,{children:[(0,o.jsx)(n.$s,{style:{width:"3%"}}),(0,o.jsx)(n.$s,{style:{width:"15%"},children:"Agent"}),(0,o.jsx)(n.$s,{style:{width:"12%"},children:"Contact"}),(0,o.jsx)(n.$s,{style:{width:"12%"},children:"Virtual Number"}),(0,o.jsx)(n.$s,{style:{width:"8%"},children:"Duration"}),(0,o.jsx)(n.$s,{style:{width:"15%"},children:"Call Date"}),(0,o.jsx)(n.$s,{style:{width:"10%"},children:"Call Type"}),(0,o.jsx)(n.$s,{className:"text-center",style:{width:"10%"},children:"Status"})]})}),(0,o.jsx)(n.jS,{children:g.map(e=>{var l,s,t,a,d,c,r,v,u,m,h,x,p,j,g,b,N,f,y,w,C,S,L,D,k,_,A,I,$,T,X,U,F,P,M,Y,z,G,H,J,q,B;return(0,o.jsxs)(i.Fragment,{children:[(0,o.jsxs)(n.YI,{onClick:()=>(e=>{const l=new Set(R);l.has(e)?l.delete(e):l.add(e),E(l)})(e._id),style:{cursor:"pointer",backgroundColor:R.has(e._id)?"#f8f9fa":"transparent"},role:"button",tabIndex:0,children:[(0,o.jsx)(n.cC,{className:"align-middle text-center",children:(0,o.jsx)("span",{style:{fontSize:"1.2rem"},children:R.has(e._id)?"\u25bc":"\u25b6"})}),(0,o.jsx)(n.cC,{className:"align-middle",children:(0,o.jsx)("span",{title:(null===(l=e.agent)||void 0===l?void 0:l.email)||(null===(s=e.agent)||void 0===s?void 0:s._id)||"-",children:(null===(t=e.agent)||void 0===t||null===(a=t.email)||void 0===a?void 0:a.split("@")[0])||(null===(d=e.agent)||void 0===d?void 0:d._id)||"-"})}),(0,o.jsx)(n.cC,{className:"align-middle",children:(null===(c=e.callLog)||void 0===c?void 0:c.contact)||e.contact||"-"}),(0,o.jsx)(n.cC,{className:"align-middle",children:(null===(r=e.callLog)||void 0===r?void 0:r.virtualNumber)||e.virtualNumber||"-"}),(0,o.jsx)(n.cC,{className:"align-middle",children:null!==(v=e.callLog)&&void 0!==v&&v.duration||e.duration?"".concat((null===(u=e.callLog)||void 0===u?void 0:u.duration)||e.duration,"s"):"-"}),(0,o.jsx)(n.cC,{className:"align-middle nowrap",children:V((null===(m=e.callLog)||void 0===m?void 0:m.callDate)||e.callDate)}),(0,o.jsx)(n.cC,{className:"align-middle",children:e.callType||"-"}),(0,o.jsx)(n.cC,{className:"text-center align-middle",children:(0,o.jsx)(n.$X,{color:"closed"===(null===(h=e.callLog)||void 0===h?void 0:h.status)||"closed"===e.status?"success":"completed"===(null===(x=e.callLog)||void 0===x?void 0:x.status)||"completed"===e.status?"info":"failed"===(null===(p=e.callLog)||void 0===p?void 0:p.status)||"failed"===e.status?"danger":"secondary",children:(null===(j=e.callLog)||void 0===j?void 0:j.status)||e.status||"-"})})]}),R.has(e._id)&&(0,o.jsx)(n.YI,{children:(0,o.jsx)(n.cC,{colSpan:8,style:{padding:"1rem",backgroundColor:"#f8f9fa"},children:(0,o.jsxs)("div",{className:"disposition-details",children:[(0,o.jsx)("h6",{className:"mb-3",children:"Disposition Details"}),e.level1||e.level2||e.level3||null!==(g=e.raw)&&void 0!==g&&g.dispositions&&(0!==(null===(b=e.raw.dispositions.level1)||void 0===b?void 0:b.length)||0!==(null===(N=e.raw.dispositions.level2)||void 0===N?void 0:N.length)||0!==(null===(f=e.raw.dispositions.level3)||void 0===f?void 0:f.length))?(0,o.jsxs)("div",{children:[(e.level1||(null===(y=e.raw)||void 0===y||null===(w=y.dispositions)||void 0===w?void 0:w.level1)&&e.raw.dispositions.level1.length>0)&&(0,o.jsxs)("div",{className:"mb-3",children:[(0,o.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,o.jsx)(n.$X,{color:"primary",className:"me-2",children:"Level 1"}),(0,o.jsx)("strong",{children:e.level1||(null===(C=e.raw)||void 0===C||null===(S=C.dispositions)||void 0===S||null===(L=S.level1[0])||void 0===L?void 0:L.level1)||"-"})]}),null===(D=e.raw)||void 0===D||null===(k=D.dispositions)||void 0===k||null===(_=k.level1)||void 0===_?void 0:_.map((e,l)=>{var s,i,n;return(0,o.jsxs)("div",{className:"ms-4 mb-2 p-2",style:{backgroundColor:"#fff",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Agent:"})," ",(null===(s=e.agent)||void 0===s?void 0:s.name)||(null===(i=e.agent)||void 0===i||null===(n=i.email)||void 0===n?void 0:n.split("@")[0])||"-"]}),e.code&&(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Code:"})," ",e.code]}),e.note&&(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Note:"})," ",e.note]}),(0,o.jsxs)("div",{className:"text-muted small",children:["Created: ",V(e.createdAt)]})]},l)})]}),(e.level2||(null===(A=e.raw)||void 0===A||null===(I=A.dispositions)||void 0===I?void 0:I.level2)&&e.raw.dispositions.level2.length>0)&&(0,o.jsxs)("div",{className:"mb-3 ms-3",children:[(0,o.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,o.jsx)(n.$X,{color:"info",className:"me-2",children:"Level 2"}),(0,o.jsx)("strong",{children:e.level2||(null===($=e.raw)||void 0===$||null===(T=$.dispositions)||void 0===T||null===(X=T.level2[0])||void 0===X?void 0:X.level2)||"-"})]}),null===(U=e.raw)||void 0===U||null===(F=U.dispositions)||void 0===F||null===(P=F.level2)||void 0===P?void 0:P.map((e,l)=>{var s,i,n;return(0,o.jsxs)("div",{className:"ms-4 mb-2 p-2",style:{backgroundColor:"#fff",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Agent:"})," ",(null===(s=e.agent)||void 0===s?void 0:s.name)||(null===(i=e.agent)||void 0===i||null===(n=i.email)||void 0===n?void 0:n.split("@")[0])||"-"]}),e.code&&(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Code:"})," ",e.code]}),e.note&&(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Note:"})," ",e.note]}),(0,o.jsxs)("div",{className:"text-muted small",children:["Created: ",V(e.createdAt)]})]},l)})]}),(e.level3||(null===(M=e.raw)||void 0===M||null===(Y=M.dispositions)||void 0===Y?void 0:Y.level3)&&e.raw.dispositions.level3.length>0)&&(0,o.jsxs)("div",{className:"mb-3 ms-4",children:[(0,o.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,o.jsx)(n.$X,{color:"secondary",className:"me-2",children:"Level 3"}),(0,o.jsx)("strong",{children:e.level3||(null===(z=e.raw)||void 0===z||null===(G=z.dispositions)||void 0===G||null===(H=G.level3[0])||void 0===H?void 0:H.level3)||"-"})]}),null===(J=e.raw)||void 0===J||null===(q=J.dispositions)||void 0===q||null===(B=q.level3)||void 0===B?void 0:B.map((e,l)=>{var s,i,n;return(0,o.jsxs)("div",{className:"ms-4 mb-2 p-2",style:{backgroundColor:"#fff",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Agent:"})," ",(null===(s=e.agent)||void 0===s?void 0:s.name)||(null===(i=e.agent)||void 0===i||null===(n=i.email)||void 0===n?void 0:n.split("@")[0])||"-"]}),e.code&&(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Code:"})," ",e.code]}),e.note&&(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Note:"})," ",e.note]}),e.meta&&(0,o.jsxs)("div",{children:[(0,o.jsx)("strong",{children:"Meta:"})," ",JSON.stringify(e.meta)]}),(0,o.jsxs)("div",{className:"text-muted small",children:["Created: ",V(e.createdAt)," | Updated: ",V(e.updatedAt)]})]},l)})]})]}):(0,o.jsx)("div",{className:"alert alert-warning mb-0",children:"No disposition set for this call"})]})})})]},e._id)})})]})]})]})}}}]);