"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[8350],{4445:function(e,t,l){l.d(t,{s:function(){return n}});const n=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='272 434.744 272 209.176 240 209.176 240 434.744 188.118 382.862 165.49 405.489 256 496 346.51 405.489 323.882 382.862 272 434.744' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M400,161.176c0-79.4-64.6-144-144-144s-144,64.6-144,144a96,96,0,0,0,0,192h80v-32H112a64,64,0,0,1,0-128h32v-32a112,112,0,0,1,224,0v32h32a64,64,0,0,1,0,128H320v32h80a96,96,0,0,0,0-192Z' class='ci-primary'/>"]},10185:function(e,t,l){l.d(t,{B:function(){return n}});const n=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"]},14495:function(e,t,l){l.d(t,{R:function(){return n}});const n=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M238.627,496H192V253.828l-168-200V16H480V53.612l-160,200V414.627ZM224,464h1.373L288,401.373V242.388L443.51,48H60.9L224,242.172Z' class='ci-primary'/>"]},73834:function(){},78350:function(e,t,l){l.r(t),l.d(t,{default:function(){return m}});var n=l(9950),a=l(49911),c=l(81949),s=l(10185),r=l(14495),o=l(4445),i=l(49079);const d=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M444.4,235.236,132.275,49.449A24,24,0,0,0,96,70.072V434.214a24.017,24.017,0,0,0,35.907,20.839L444.03,276.7a24,24,0,0,0,.367-41.461ZM128,420.429V84.144L416.244,255.718Z' class='ci-primary'/>"];l(73834);var u=l(2720),h=l(44414);var m=()=>{const[e,t]=(0,n.useState)([]),[l,m]=(0,n.useState)(10),[g,p]=(0,n.useState)(!0),[x,f]=(0,n.useState)(null),[y,j]=(0,n.useState)(""),[v,b]=(0,n.useState)(1),[w,C]=(0,n.useState)(1),[N,A]=(0,n.useState)(0),[S,k]=(0,n.useState)(!1),[R,T]=(0,n.useState)([]),[I,E]=(0,n.useState)(!1),[U,L]=(0,n.useState)(null),[D,B]=(0,n.useState)("All Calls"),[O,_]=(0,n.useState)(null),[F,M]=(0,n.useState)(""),[z,P]=(0,n.useState)(""),[H,Y]=(0,n.useState)("All"),[G,Q]=(0,n.useState)(!1),[V,W]=(0,n.useState)(null),[X,$]=(0,n.useState)(!1),[Z,J]=(0,n.useState)(""),[K,q]=(0,n.useState)(null),[ee,te]=(0,n.useState)(!1),[le,ne]=(0,n.useState)(null),ae=(0,n.useRef)(null),[ce,se]=(0,n.useState)(null),re=(0,n.useRef)(null),oe=(0,n.useRef)(null),ie=(0,n.useRef)(null),[de,ue]=(0,n.useState)(!1),[he,me]=(0,n.useState)(null),[ge,pe]=(0,n.useState)(null),[xe,fe]=(0,n.useState)(!1),ye=(0,n.useRef)("");(0,n.useEffect)(()=>{(async()=>{try{var e;const t=await(0,u.H2)("/v1/user/details","GET");if(null!==t&&void 0!==t&&null!==(e=t.user)&&void 0!==e&&e.businessId)return void _(t.user.businessId);const l=localStorage.getItem("businessId");if(l)return void _(l);throw new Error("Business ID not found")}catch(t){console.error("Failed to get business ID:",t),f("Failed to get business ID. Please make sure you are properly logged in.")}})()},[]);const je=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,n="/call-logs/business/".concat(O,"?page=").concat(e,"&limit=").concat(t);if(y&&(n+="&search=".concat(encodeURIComponent(y))),F)try{const e=String(F).split("-");if(3===e.length){const t=Number(e[0]),l=Number(e[1])-1,a=Number(e[2]),c=new Date(t,l,a);c.setHours(0,0,0,0),n+="&from=".concat(encodeURIComponent(c.toISOString()))}else n+="&from=".concat(encodeURIComponent(F))}catch(a){n+="&from=".concat(encodeURIComponent(F))}if(z)try{const e=String(z).split("-");if(3===e.length){const t=Number(e[0]),l=Number(e[1])-1,a=Number(e[2]),c=new Date(t,l,a);c.setHours(23,59,59,999),n+="&to=".concat(encodeURIComponent(c.toISOString()))}else n+="&to=".concat(encodeURIComponent(z))}catch(a){n+="&to=".concat(encodeURIComponent(z))}if(H&&"All"!==H){const e=String(H);let t=e.toLowerCase();"Outgoing"===e?t="outbound":"Incoming"===e&&(t="inbound"),n+="&callType=".concat(encodeURIComponent(t))}return D&&"All Calls"!==D&&("Completed"===D?n+="&status=completed":"Failed"===D?n+="&status=failed":"Outgoing"===D?n+="&callType=outbound":"Incoming"===D&&(n+="&callType=inbound")),n};(0,n.useEffect)(()=>{(async()=>{if(O){p(!0),f(null);try{const a=Boolean(F||z),c=je(a?1:v,a?1e3:l),s="".concat(F||"","|").concat(z||"","|").concat(O||"");let r=null,o=[],i=null;if(a&&ye.current===s&&e&&e.length>0)console.debug("Using cached filtered call logs for",s),o=e;else if(console.debug("Fetching call logs from endpoint:",c),r=await(0,u.H2)(c,"GET"),Array.isArray(r))o=r;else if(r&&Array.isArray(r.data))o=r.data,i=r.pagination||null;else if(r&&Array.isArray(r.callLogs))o=r.callLogs,i=r.pagination||null;else{var n;o=[],i=(null===(n=r)||void 0===n?void 0:n.pagination)||null}if(a){const e=ye.current!==s;ye.current=s,k(!1),t(o),A(o.length),C(Math.max(1,Math.ceil(o.length/l))),e&&b(1)}else t(o),i?(k(!0),C(i.totalPages||Math.max(1,Math.ceil((i.totalRecords||o.length)/l))),A(i.totalRecords||o.length)):(k(!1),A(o.length),C(Math.max(1,Math.ceil(o.length/l))))}catch(a){f("Business ID not found"===a.message?"Business ID not found. Please make sure you are properly logged in.":"Failed to fetch call logs. Please try again later."),t([]),C(1),A(0)}finally{p(!1)}}})()},[O,v,y,l,F,z,H,D]),(0,n.useEffect)(()=>{(async()=>{if(O){E(!0),L(null);try{const e=await(0,u.H2)("/v1/audio-recordings","GET");Array.isArray(null===e||void 0===e?void 0:e.files)?T(e.files):Array.isArray(e)?T(e):T([])}catch(e){console.error("Failed to fetch audio recordings",e),L("Failed to load audio recordings"),T([])}finally{E(!1)}}})()},[O]);const ve=e=>{if(!e)return"Unknown";return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},be=e=>{if(!e)return"";try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return e}},we=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;const l=String(e).split("-");if(3!==l.length)return null;const n=Number(l[0]),a=Number(l[1])-1,c=Number(l[2]);if(Number.isNaN(n)||Number.isNaN(a)||Number.isNaN(c))return null;const s=new Date(n,a,c);return t?s.setHours(23,59,59,999):s.setHours(0,0,0,0),s.getTime()},Ce=S?e:e.filter(e=>{const t=String(e.callType||"").toLowerCase(),l=String(e.status||"").toLowerCase();let n=!0;if(D&&"All Calls"!==D&&("Completed"===D?n="completed"===l||"success"===l:"Failed"===D?n=l.includes("fail")||l.includes("error"):"Outgoing"===D?n="outbound"===t||"outgoing"===t:"Incoming"===D&&(n="inbound"===t||"incoming"===t)),n&&H&&"All"!==H){const e=H.toLowerCase();"outgoing"===e?n="outbound"===t||"outgoing"===t:"incoming"===e&&(n="inbound"===t||"incoming"===t)}if(n&&(F||z)){const t=e.callDate||e.createdAt;if(t){const e=new Date(t).getTime();if(F){const t=we(F,!1);null!==t&&e<t&&(n=!1)}if(n&&z){const t=we(z,!0);null!==t&&e>t&&(n=!1)}}}return n}),Ne=S?Ce:Ce.slice((v-1)*l,v*l),Ae=(S||Ce.length,S?w:Math.max(1,Math.ceil(Ce.length/l))),Se=e=>{B(e),b(1)},ke=async e=>{if(e){ne(null),te(!0);try{const l=localStorage.getItem("authToken")||"";let n=e;try{n=new URL(e).href}catch(t){e.startsWith("/")||(n="".concat((0,u.vo)(),"/api/v1/audio-recordings/").concat(encodeURIComponent(e)))}const a=await fetch(n,{method:"GET",headers:{Authorization:l?"Bearer ".concat(l):""}});if(console.debug("Recording fetch response",{url:e,ok:a.ok,status:a.status,headers:Array.from(a.headers.entries())}),!a.ok){const e=await a.text().catch(()=>"");throw new Error("Failed to fetch recording: ".concat(a.status," ").concat(e))}let c=a.headers.get("Content-Type")||"";c&&"application/octet-stream"!==c||(c=e.toLowerCase().endsWith(".wav")?"audio/wav":"audio/mpeg");const s=await a.arrayBuffer();if(!s||0===s.byteLength)throw new Error("Empty audio file received");const r=new Blob([s],{type:c}),o=URL.createObjectURL(r);if(K)try{URL.revokeObjectURL(K)}catch(t){}q(o),se(c),me({status:a.status,contentType:c,size:r.size}),setTimeout(async()=>{try{if(ae.current){ae.current.onerror=null,ae.current.src=o,ae.current.load();const e=ae.current.play();e&&"function"===typeof e.then&&e.catch(e=>{console.warn("Autoplay prevented or playback failed on audio element, will try WebAudio fallback",e),Re(s,c)}),ae.current.onerror=e=>{console.warn("Audio element error, attempting WebAudio fallback",e),Re(s,c)}}}catch(t){console.warn("Error attempting to play audio element, trying WebAudio fallback",t);try{Re(s,c)}catch(e){console.warn(e)}}},50)}catch(l){console.error("Failed to play recording",l),ne(l.message||"Failed to play recording")}finally{te(!1)}}else alert("No recording available for this call")},Re=async(e,t)=>{try{if(!re.current){const e=window.AudioContext||window.webkitAudioContext;re.current=new e}const t=re.current;if(ie.current){try{ie.current.stop(0)}catch(l){}ie.current.disconnect(),ie.current=null}let n;n=1===t.decodeAudioData.length?await t.decodeAudioData(e.slice(0)):await new Promise((l,n)=>{t.decodeAudioData(e.slice(0),l,n)}),oe.current=n;const a=t.createBufferSource();a.buffer=n,a.connect(t.destination),ie.current=a,a.onended=()=>{ue(!1)},a.start(0),ue(!0)}catch(n){console.error("WebAudio fallback failed",n),ne("Playback failed (decoder error)")}},Te=()=>{try{if(ie.current){try{ie.current.stop(0)}catch(e){}ie.current.disconnect(),ie.current=null}ue(!1)}catch(e){console.warn("Error stopping WebAudio",e)}},Ie=async(e,t)=>{const l=t||e;try{pe(l),await(async(e,t)=>{try{let n=t||"";try{const t=new URL(e).pathname.split("/");n=n||decodeURIComponent(t.pop()||t.pop())}catch(l){n||(n=e)}if(!n)return void alert("No recording available for download");const a=localStorage.getItem("authToken")||"",c="".concat((0,u.vo)(),"/api/v1/audio-recordings/download/").concat(encodeURIComponent(n)),s=await fetch(c,{method:"GET",headers:{Authorization:a?"Bearer ".concat(a):""}});if(!s.ok){const e=await s.text().catch(()=>"");throw new Error("Download failed: ".concat(s.status," ").concat(e))}const r=await s.blob(),o=URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=n,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(o)}catch(n){console.error("Download failed",n),alert("Download failed")}})(e,t)}finally{pe(null)}},Ee=e=>{if(!e)return"00:00";const t=parseInt(e),l=Math.floor(t/60),n=t%60;return"".concat(l.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))},Ue=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'+t.replace(/"/g,'""')+'"':t};return(0,h.jsxs)("div",{className:"call-logs-container",children:[(0,h.jsx)(a.E$,{className:"mb-4",children:(0,h.jsxs)(a.W6,{children:[(0,h.jsxs)(a.sK,{className:"mb-3 align-items-center",children:[(0,h.jsx)(a.UF,{md:6,children:(0,h.jsx)("h1",{className:"call-logs-title",children:"Call Logs"})}),(0,h.jsx)(a.UF,{md:6,className:"d-flex justify-content-end"})]}),(0,h.jsxs)(a.sK,{className:"mb-4",children:[(0,h.jsx)(a.UF,{md:6,children:(0,h.jsxs)(a.BG,{children:[(0,h.jsx)(a.OG,{placeholder:"Search call logs...",value:y,onChange:e=>{j(e.target.value),b(1)}}),(0,h.jsx)(a.Q_,{type:"button",color:"primary",variant:"outline",children:(0,h.jsx)(c.Ay,{icon:s.B})})]})}),(0,h.jsx)(a.UF,{md:6,className:"d-flex justify-content-end",children:(0,h.jsx)("div",{className:"d-flex align-items-center",children:(0,h.jsxs)(a.BG,{style:{maxWidth:180},children:[(0,h.jsx)(a.OG,{type:"number",value:l,disabled:!0,readOnly:!0,"aria-label":"Rows per page"}),(0,h.jsx)(a.Q_,{type:"button",color:"secondary",variant:"outline",disabled:!0,children:"Rows/Page"})]})})})]}),(0,h.jsx)(a.sK,{className:"mb-3",children:(0,h.jsx)(a.UF,{md:12,children:(0,h.jsxs)("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[(0,h.jsxs)(a.MT,{value:H,onChange:e=>{Y(e.target.value),b(1)},style:{width:160},children:[(0,h.jsx)("option",{value:"All",children:"All Call Types"}),(0,h.jsx)("option",{value:"Incoming",children:"Incoming"}),(0,h.jsx)("option",{value:"Outgoing",children:"Outgoing"})]}),(0,h.jsx)(a.OG,{type:"date",value:F,onChange:e=>{M(e.target.value),b(1)},style:{width:180}}),(0,h.jsx)(a.OG,{type:"date",value:z,onChange:e=>{P(e.target.value),b(1)},style:{width:180}}),(0,h.jsxs)(a.ji,{children:[(0,h.jsxs)(a.VH,{color:"secondary",variant:"outline",style:{minWidth:150},children:[(0,h.jsx)(c.Ay,{icon:r.R,className:"me-2"}),D]}),(0,h.jsxs)(a.QR,{children:[(0,h.jsxs)(a.kd,{onClick:()=>Se("All Calls"),active:"All Calls"===D,children:["All Calls ","All Calls"===D&&"\u2713"]}),(0,h.jsxs)(a.kd,{onClick:()=>Se("Completed"),active:"Completed"===D,children:["Completed ","Completed"===D&&"\u2713"]}),(0,h.jsxs)(a.kd,{onClick:()=>Se("Outgoing"),active:"Outgoing"===D,children:["Outgoing ","Outgoing"===D&&"\u2713"]}),(0,h.jsxs)(a.kd,{onClick:()=>Se("Incoming"),active:"Incoming"===D,children:["Incoming ","Incoming"===D&&"\u2713"]}),(0,h.jsxs)(a.kd,{onClick:()=>Se("Failed"),active:"Failed"===D,children:["Failed ","Failed"===D&&"\u2713"]})]})]}),(0,h.jsx)(a.Q_,{color:"light",onClick:()=>{M(""),P(""),Y("All"),j(""),B("All Calls"),b(1)},children:"Clear Filters"}),(0,h.jsx)("div",{style:{marginLeft:"auto"},children:(()=>{const e=S?N:Ce.length;return(0,h.jsx)(a.Q_,{color:"info",onClick:()=>(async()=>{if(O){fe(!0);try{const l=Boolean(F||z),n=1e3;let a=[];if(l){let l=1;const c=5e3,s=Math.ceil(c/n),r=F?we(F,!1):null,o=z?we(z,!0):null;for(;;){const c=je(l,n);console.debug("Export (filtered) fetching page ".concat(l,":"),c);const i=await(0,u.H2)(c,"GET");let d=[];if(d=Array.isArray(i)?i:i&&Array.isArray(i.data)?i.data:i&&Array.isArray(i.callLogs)?i.callLogs:[],d.length>0){var e,t;const n=d.map(e=>new Date(e.callDate||e.createdAt).getTime()).filter(Boolean),c=n.length?Math.max(...n):null,s=n.length?Math.min(...n):null,i=d.filter(e=>{const t=new Date(e.callDate||e.createdAt).getTime();return!Number.isNaN(t)&&!(null!==r&&t<r)&&!(null!==o&&t>o)});if(a=a.concat(i),console.debug("Export (filtered) page ".concat(l," returned ").concat(d.length," records, matched ").concat(i.length),i.length?{firstMatched:null===(e=i[0])||void 0===e?void 0:e.callDate,lastMatched:null===(t=i[i.length-1])||void 0===t?void 0:t.callDate}:null,{maxPageTs:c?new Date(c).toISOString():null,minPageTs:s?new Date(s).toISOString():null}),null!==r&&null!==c&&c<r){console.debug("Export (filtered) early stop: page max timestamp is older than fromTs");break}}if(d.length<n)break;if(l+=1,l>s){console.warn("Reached export max pages cap; stopping further fetches");break}}}else{const e=je(1,n);console.debug("Export (unfiltered) fetching first page:",e);const t=await(0,u.H2)(e,"GET");let l=null;if(Array.isArray(t)?a=t:t&&Array.isArray(t.data)?(a=t.data,l=t.pagination||null):t&&Array.isArray(t.callLogs)?(a=t.callLogs,l=t.pagination||null):(a=[],l=(null===t||void 0===t?void 0:t.pagination)||null),l&&l.totalPages&&l.totalPages>1){const e=l.totalPages,t=l.limit||n,c=[];for(let l=2;l<=e;l++){const e=je(l,t);console.debug("Export (unfiltered) will fetch page",l,e),c.push((0,u.H2)(e,"GET"))}(await Promise.all(c)).forEach(e=>{Array.isArray(e)?a=a.concat(e):e&&Array.isArray(e.data)?a=a.concat(e.data):e&&Array.isArray(e.callLogs)&&(a=a.concat(e.callLogs))})}}if(!a||0===a.length)return void alert("No call logs available to export");const c=["S.NO","TYPE","DATE","INITIATED BY","RECEIVED BY","REJECTED BY","TEAM","HANG UP BY","DURATION","COST","NOTES","STATUS","VIRTUAL NUMBER","CONTACT"],s=[];s.push(c.join(",")),a.forEach((e,t)=>{const l=be(e.callDate||e.createdAt),n=Ee(e.callDuration||e.duration),a=null!=e.cost?Number(e.cost).toFixed(2):"",c=[t+1,Ue(e.callType||""),Ue(l),Ue(e.callInitiatedBy||""),Ue(e.callReceivedBy||""),Ue(e.callRejectedBy||""),Ue(e.team||""),Ue(e.hangUpBy||""),Ue(n),Ue(a),Ue(e.notes||""),Ue(ve(e.status)),Ue(e.virtualNumber||""),Ue(e.contact||"")];s.push(c.join(","))});const r=s.join("\n"),o=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(o),d=document.createElement("a");d.href=i;const h=new Date,m="call-logs-".concat(O,"-").concat(h.toISOString().slice(0,19).replace(/[:T]/g,"-"),".csv");d.download=m,document.body.appendChild(d),d.click(),d.remove(),URL.revokeObjectURL(i)}catch(l){console.error("Export failed",l),alert("Export failed. Check console for details.")}finally{fe(!1)}}else alert("Business ID not available yet. Please try again.")})(),disabled:!O||xe,children:xe?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(a.JT,{size:"sm",className:"me-2"})," Exporting..."]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.Ay,{icon:o.s,className:"me-2"})," Export All (",e,")"]})})})()})]})})}),(0,h.jsxs)(a._v,{hover:!0,responsive:!0,className:"table-sm compact-table branches-table",style:{tableLayout:"auto"},children:[(0,h.jsx)(a.wV,{children:(0,h.jsxs)(a.YI,{children:[(0,h.jsx)(a.$s,{children:"S.NO"}),(0,h.jsx)(a.$s,{children:"TYPE"}),(0,h.jsx)(a.$s,{children:"DATE"}),(0,h.jsx)(a.$s,{children:"INITIATED BY"}),(0,h.jsx)(a.$s,{children:"RECEIVED BY"}),(0,h.jsx)(a.$s,{children:"NOTES"}),(0,h.jsx)(a.$s,{children:"STATUS"})]})}),(0,h.jsx)(a.jS,{children:g?(0,h.jsx)(a.YI,{children:(0,h.jsxs)(a.cC,{colSpan:"12",className:"text-center py-5",children:[(0,h.jsx)(a.JT,{color:"primary"}),(0,h.jsx)("div",{className:"mt-3",children:"Loading call logs..."})]})}):x?(0,h.jsx)(a.YI,{children:(0,h.jsx)(a.cC,{colSpan:"12",className:"text-center py-5",children:(0,h.jsx)(a.kj,{color:"danger",className:"mb-0",children:x})})}):0===Ce.length?(0,h.jsx)(a.YI,{children:(0,h.jsx)(a.cC,{colSpan:"12",className:"text-center py-5",children:(0,h.jsxs)("div",{className:"empty-state",children:[(0,h.jsx)("div",{className:"empty-state-icon",children:(0,h.jsx)(c.Ay,{icon:s.B,size:"xl"})}),(0,h.jsx)("h4",{children:"No call logs found"}),(0,h.jsx)("p",{children:"There are no call logs available matching your search criteria."})]})})}):Ne.map((e,t)=>{const n=e.callType||"Unknown",s=be(e.callDate||e.createdAt),r=ve(e.status);return(0,h.jsxs)(a.YI,{onClick:()=>{W(e),Q(!0)},style:{cursor:"pointer"},children:[(0,h.jsx)(a.cC,{className:"align-middle",children:(0,h.jsx)("div",{className:"agent-number",children:(v-1)*l+t+1})}),(0,h.jsx)(a.cC,{className:"align-middle",children:(0,h.jsx)("div",{className:"agent-name text-capitalize",children:n})}),(0,h.jsx)(a.cC,{className:"align-middle",children:(0,h.jsx)("div",{className:"department-name",children:s})}),(0,h.jsx)(a.cC,{className:"align-middle",children:(0,h.jsx)("div",{className:"agent-name",children:e.callInitiatedBy||"Unknown"})}),(0,h.jsx)(a.cC,{className:"align-middle",children:(0,h.jsx)("div",{className:"manager-email",children:e.callReceivedBy||"N/A"})}),(0,h.jsx)(a.cC,{children:(0,h.jsx)("div",{children:(0,h.jsx)(a.Q_,{size:"sm",color:"info",variant:"outline",onClick:t=>{t.stopPropagation(),J(e.notes||""),$(!0)},title:e.notes?"View notes":"No notes",children:(0,h.jsx)(c.Ay,{icon:i.H})})})}),(0,h.jsx)(a.cC,{children:(0,h.jsx)(a.$X,{color:"success"===r.toLowerCase()||"completed"===r.toLowerCase()?"success":r.toLowerCase().includes("fail")?"danger":"missed"===r.toLowerCase()?"warning":"secondary",className:"status-badge",children:r})})]},e._id)})})]}),Ae>1&&(0,h.jsx)("div",{style:{overflowX:"auto",whiteSpace:"nowrap",maxWidth:"100%"},children:(0,h.jsxs)(a._l,{"aria-label":"Page navigation",className:"justify-content-center mt-4",style:{display:"inline-flex",flexWrap:"nowrap"},children:[(0,h.jsx)(a.Xp,{disabled:1===v,onClick:()=>b(v-1),children:"Previous"}),(()=>{const e=[],t=Ae;return e.push((0,h.jsx)(a.Xp,{active:1===v,onClick:()=>b(1),children:1},1)),v>3&&e.push((0,h.jsx)(a.Xp,{disabled:!0,children:"..."},"start-ellipsis")),v>2&&v!==t&&e.push((0,h.jsx)(a.Xp,{onClick:()=>b(v-1),children:v-1},v-1)),1!==v&&v!==t&&e.push((0,h.jsx)(a.Xp,{active:!0,onClick:()=>b(v),children:v},v)),v<t-1&&1!==v&&e.push((0,h.jsx)(a.Xp,{onClick:()=>b(v+1),children:v+1},v+1)),v<t-2&&e.push((0,h.jsx)(a.Xp,{disabled:!0,children:"..."},"end-ellipsis")),1!==t&&e.push((0,h.jsx)(a.Xp,{active:v===t,onClick:()=>b(t),children:t},t)),e})(),(0,h.jsx)(a.Xp,{disabled:v===Ae,onClick:()=>b(v+1),children:"Next"})]})})]})}),(0,h.jsxs)(a.zS,{visible:G,scrollable:!0,onClose:()=>{if(Q(!1),K){try{URL.revokeObjectURL(K)}catch(e){}q(null)}se(null),ne(null),te(!1),me(null);try{Te()}catch(e){}try{re.current&&(re.current.close(),re.current=null)}catch(e){}},size:"lg",children:[(0,h.jsx)(a.E4,{children:(0,h.jsxs)("h5",{children:["Call Recording - ",V?be(V.callDate||V.createdAt):""]})}),(0,h.jsx)(a.Tc,{style:{maxHeight:"65vh",overflowY:"auto"},children:V&&(0,h.jsxs)("div",{children:[(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("strong",{children:"Call Details:"}),(0,h.jsxs)("p",{children:["Type: ",V.callType||"Unknown"]}),(0,h.jsxs)("p",{children:["Initiated By: ",V.callInitiatedBy||"Unknown"]}),(0,h.jsxs)("p",{children:["Received By: ",V.callReceivedBy||"N/A"]}),(0,h.jsxs)("p",{children:["Rejected By: ",V.callRejectedBy||"N/A"]}),(0,h.jsxs)("p",{children:["Team: ",V.team||"N/A"]}),(0,h.jsxs)("p",{children:["Hang Up By: ",V.hangUpBy||"Unknown"]}),(0,h.jsxs)("p",{children:["Duration: ",Ee(V.callDuration||V.duration)]}),(0,h.jsxs)("p",{children:["Cost: ",null!=V.cost?"$".concat(Number(V.cost).toFixed(2)):"N/A"]}),(0,h.jsxs)("p",{children:["Status: ",ve(V.status)]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)("strong",{children:"Recording Options:"}),(0,h.jsx)("div",{className:"d-flex gap-2 flex-wrap mt-2",children:V.callRecording?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(a.Q_,{color:"primary",onClick:()=>ke(V.callRecording),children:[(0,h.jsx)(c.Ay,{icon:d,className:"me-2"}),"Play Recording"]}),(0,h.jsx)(a.Q_,{color:"success",onClick:()=>Ie(V.callRecording,"call-recording-".concat(V._id,".mp3")),disabled:null!==ge,children:ge==="call-recording-".concat(V._id,".mp3")?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(a.JT,{size:"sm",className:"me-2"}),"Downloading..."]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.Ay,{icon:o.s,className:"me-2"}),"Download Recording"]})})]}):(()=>{const e=String(V.virtualNumber||"").replace(/[^0-9]/g,""),t=String(V.contact||"").replace(/[^0-9]/g,"");if(!e||!t||0===R.length)return(0,h.jsx)("p",{className:"text-muted",children:"No recording available for this call."});const l=e=>{const t=[];return e?(t.push(e),e.length>10&&t.push(e.slice(-10)),e.length>8&&t.push(e.slice(-8)),e.length>6&&t.push(e.slice(-6)),t):t},n=l(e),s=l(t),r=R.filter(e=>n.some(t=>t&&e.includes(t))&&s.some(t=>t&&e.includes(t)));if(0===r.length)return(0,h.jsx)("p",{className:"text-muted",children:"No recording available for this call."});const i=new Set,m=r.filter(e=>!i.has(e)&&(i.add(e),!0));return(0,h.jsxs)("div",{children:[(0,h.jsx)("p",{className:"mb-2",children:"Available recordings:"}),(0,h.jsx)("div",{className:"d-flex flex-column gap-2",children:m.map((e,t)=>{const l="".concat((0,u.vo)(),"/api/v1/audio-recordings/").concat(encodeURIComponent(e));return(0,h.jsxs)("div",{className:"d-flex align-items-center gap-2 p-2 border rounded",children:[(0,h.jsx)("span",{className:"flex-grow-1 text-truncate",title:e,children:e}),(0,h.jsx)(a.Q_,{size:"sm",color:"primary",variant:"outline",onClick:()=>ke(l),children:(0,h.jsx)(c.Ay,{icon:d,size:"sm"})}),(0,h.jsx)(a.Q_,{size:"sm",color:"success",variant:"outline",onClick:()=>Ie(l,e),disabled:null!==ge,children:ge===e?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(a.JT,{size:"sm",className:"me-1"}),"DL"]}):(0,h.jsx)(c.Ay,{icon:o.s,size:"sm"})})]},t)})})]})})()}),ee&&(0,h.jsx)("div",{className:"mt-3",children:"Loading recording..."}),le&&(0,h.jsx)("div",{className:"mt-3 text-danger",children:le}),he&&(0,h.jsxs)("div",{className:"mt-2 small text-muted",children:["Response: ",he.status," \u2022 Type: ",he.contentType," \u2022 Size: ",Math.round((he.size||0)/1024)," KB"]}),K&&(0,h.jsxs)("div",{className:"mt-3",children:[(0,h.jsxs)("div",{className:"d-flex gap-2 mb-2",children:[(0,h.jsx)(a.Q_,{size:"sm",color:"info",variant:"outline",onClick:()=>window.open(K,"_blank"),children:"Open in new tab"}),(0,h.jsx)(a.Q_,{size:"sm",color:"secondary",variant:"outline",onClick:()=>{const e=document.createElement("a");e.href=K,e.download="recording.".concat(ce&&ce.includes("wav")?"wav":"mp3"),document.body.appendChild(e),e.click(),e.remove()},children:"Download (debug)"}),de?(0,h.jsx)(a.Q_,{size:"sm",color:"danger",variant:"outline",onClick:()=>Te(),children:"Stop WebAudio"}):null]}),(0,h.jsxs)("audio",{controls:!0,ref:ae,autoPlay:!0,style:{width:"100%"},children:[(0,h.jsx)("source",{src:K,type:ce||"audio/mpeg"}),"Your browser does not support the audio element."]})]})]})]})}),(0,h.jsx)(a.If,{children:(0,h.jsx)(a.Q_,{color:"secondary",onClick:()=>{if(Q(!1),K){try{URL.revokeObjectURL(K)}catch(e){}q(null)}se(null),ne(null),te(!1),me(null);try{Te()}catch(e){}try{re.current&&(re.current.close(),re.current=null)}catch(e){}},children:"Close"})})]}),(0,h.jsxs)(a.zS,{visible:X,scrollable:!0,onClose:()=>$(!1),size:"md",children:[(0,h.jsx)(a.E4,{children:(0,h.jsx)("h5",{children:"Notes"})}),(0,h.jsx)(a.Tc,{style:{maxHeight:"50vh",overflowY:"auto"},children:(0,h.jsxs)("div",{children:[(0,h.jsx)("textarea",{readOnly:!0,value:Z,rows:12,style:{width:"100%",resize:"vertical",fontFamily:"inherit",padding:"10px",borderRadius:4,border:"1px solid #ddd",background:"#fffef6"}}),(!Z||""===String(Z).trim())&&(0,h.jsx)("div",{className:"text-muted mt-2",children:"No notes available for this call."})]})}),(0,h.jsx)(a.If,{children:(0,h.jsx)(a.Q_,{color:"secondary",onClick:()=>$(!1),children:"Close"})})]})]})}}}]);