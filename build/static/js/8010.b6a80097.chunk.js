"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[8010],{4445:function(e,s,a){a.d(s,{s:function(){return t}});const t=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='272 434.744 272 209.176 240 209.176 240 434.744 188.118 382.862 165.49 405.489 256 496 346.51 405.489 323.882 382.862 272 434.744' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M400,161.176c0-79.4-64.6-144-144-144s-144,64.6-144,144a96,96,0,0,0,0,192h80v-32H112a64,64,0,0,1,0-128h32v-32a112,112,0,0,1,224,0v32h32a64,64,0,0,1,0,128H320v32h80a96,96,0,0,0,0-192Z' class='ci-primary'/>"]},10185:function(e,s,a){a.d(s,{B:function(){return t}});const t=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"]},18010:function(e,s,a){a.r(s),a.d(s,{default:function(){return h}});var t=a(9950),c=a(49911),l=a(81949),n=a(4445),r=a(10185),i=a(44429),o=a(2720),d=a(44414);var h=()=>{const e="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4MzQ0OTBiZjkzMDYxNTQ1OTM4ODU4MSIsImlhdCI6MTc1MTg4MDYwMX0.tMpKo7INMcUp3u1b8NBnzRMutPCZVhNWbPxfAqFwIvc",[s,a]=(0,t.useState)(!1),[h,m]=(0,t.useState)(null),[u,x]=(0,t.useState)("data-access-logs"),[j,p]=(0,t.useState)("today"),[g,v]=(0,t.useState)(""),[C,N]=(0,t.useState)(""),[S,f]=(0,t.useState)(""),[y,A]=(0,t.useState)("all"),[b,T]=(0,t.useState)("all"),[I,w]=(0,t.useState)(1),[E]=(0,t.useState)(10),[M,R]=(0,t.useState)([]),[L,U]=(0,t.useState)([]),[B,D]=(0,t.useState)(0),[$,F]=(0,t.useState)(1),[O,_]=(0,t.useState)({name:"",totalBranches:0}),k=[{id:1,caller:"+91 9876543210",receiver:"+91 8765432109",duration:"00:02:45",timestamp:"2025-07-22 10:30:00",status:"Completed",type:"Outbound"},{id:2,caller:"+91 7654321098",receiver:"+91 6543210987",duration:"00:01:23",timestamp:"2025-07-22 11:15:00",status:"Missed",type:"Inbound"},{id:3,caller:"+91 5432109876",receiver:"+91 4321098765",duration:"00:05:12",timestamp:"2025-07-22 12:45:00",status:"Completed",type:"Outbound"}],P=[{id:1,name:"John Doe",totalCalls:25,completedCalls:20,missedCalls:5,avgDuration:"00:03:45",status:"Active"},{id:2,name:"Jane Smith",totalCalls:30,completedCalls:28,missedCalls:2,avgDuration:"00:04:12",status:"Active"},{id:3,name:"Bob Wilson",totalCalls:18,completedCalls:15,missedCalls:3,avgDuration:"00:02:58",status:"Break"}];(0,t.useEffect)(()=>{z(),"data-access-logs"!==u&&(A("all"),T("all"))},[u,j,g,C,I,E]);const z=async()=>{a(!0),m(null);try{if("data-access-logs"===u){var s;const a=new URLSearchParams({page:I,limit:E,sortBy:"createdAt",order:"desc",..."all"!==j&&"custom"!==j&&{dateRange:j},..."custom"===j&&g&&C&&{dateFrom:g,dateTo:C},..."all"!==y&&{resource:y},..."all"!==b&&{role:b},...S&&{search:S}}),l=await(0,o.H2)("api/data-access-logs/business-logs?".concat(a.toString()),"GET",null,{Authorization:e,"Content-Type":"application/json"}).catch(e=>{throw console.error("Business contact person data logs API call failed:",e),e.response&&401===e.response.status?new Error("Authentication failed. Please check the authorization token."):e.response&&404===e.response.status?new Error("Business contact person not found or no data available."):new Error("Failed to fetch business contact person data logs.")});if(null!==l&&void 0!==l&&null!==(s=l.data)&&void 0!==s&&s.logs&&Array.isArray(l.data.logs)){var t,c;const e=l.data.logs,s=(null===(t=l.data.pagination)||void 0===t?void 0:t.total)||0,a=(null===(c=l.data.pagination)||void 0===c?void 0:c.pages)||1;D(s),F(a);const n=e.map(e=>{var s,a;return{id:String(e._id),userId:(null===(s=e.user)||void 0===s?void 0:s.email)||"N/A",userRole:(null===(a=e.user)||void 0===a?void 0:a.role)||"N/A",accessType:e.action,resourceAccessed:e.resource,timestamp:(()=>{try{const s=e.createdAt;if(!s)return"N/A";const a=new Date(s);return isNaN(a.getTime())?"N/A":a.toLocaleString()}catch(s){return"N/A"}})(),ipAddress:e.ipAddress,status:"Success"}});(l.data.businessName||l.data.totalBranches)&&_({name:l.data.businessName||"",totalBranches:l.data.totalBranches||0}),R(n);const r=[...new Set(n.map(e=>e.resourceAccessed))].filter(e=>"N/A"!==e).sort();U(r)}else R([]),U([])}else"call-logs"===u?(await new Promise(e=>setTimeout(e,1e3)),R(k)):"agent-performance"===u?(await new Promise(e=>setTimeout(e,1e3)),R(P)):R([])}catch(l){console.error("Failed to fetch report data:",l),m(l.message||"Failed to fetch report data. Please try again later."),R([])}finally{setTimeout(()=>{a(!1)},100)}},Y="data-access-logs"===u?M:M.filter(e=>{if("call-logs"===u){const s=String(e.caller||"").toLowerCase(),a=String(e.receiver||"").toLowerCase(),t=String(e.status||"").toLowerCase(),c=S.toLowerCase();return s.includes(c)||a.includes(c)||t.includes(c)}if("agent-performance"===u){const s=String(e.name||"").toLowerCase(),a=String(e.status||"").toLowerCase(),t=S.toLowerCase();return s.includes(t)||a.includes(t)}return!0});(0,t.useEffect)(()=>{w(1)},[S,y,b]);const X=I*E,G=X-E;let J,Z;"data-access-logs"===u?(J=M,Z=$):(J=Y.slice(G,X),Z=Math.ceil(Y.length/E));const H=e=>{w(e)},Q=e=>{let s="info";return"Completed"===e||"Active"===e?s="success":"Missed"===e?s="danger":"Break"===e&&(s="warning"),(0,d.jsx)(c.$X,{color:s,children:e})};return(0,d.jsx)("div",{className:"contact-list-container",children:(0,d.jsx)(c.E$,{className:"mb-4",children:(0,d.jsxs)(c.W6,{children:[(0,d.jsxs)(c.sK,{className:"mb-4 align-items-center",children:[(0,d.jsx)(c.UF,{md:6,children:(0,d.jsx)("h1",{className:"contact-list-title",children:"Reports & Analytics"})}),(0,d.jsx)(c.UF,{md:6,className:"d-flex justify-content-end",children:(0,d.jsxs)(c.Q_,{color:"primary",className:"add-contact-btn",onClick:()=>{let e="",s=[];"data-access-logs"===u?(s=["ID","User Email","Action","Resource","Timestamp","IP Address"],e=s.join(",")+"\n",M.forEach(s=>{e+='"'.concat(s.id,'","').concat(s.userId,'","').concat(s.accessType,'","').concat(s.resourceAccessed,'","').concat(s.timestamp,'","').concat(s.ipAddress,'"\n')})):"call-logs"===u?(s=["ID","Caller","Receiver","Duration","Timestamp","Status","Type"],e=s.join(",")+"\n",M.forEach(s=>{e+="".concat(s.id,',"').concat(s.caller,'","').concat(s.receiver,'","').concat(s.duration,'","').concat(s.timestamp,'","').concat(s.status,'","').concat(s.type,'"\n')})):"agent-performance"===u&&(s=["ID","Name","Total Calls","Completed Calls","Missed Calls","Avg Duration","Status"],e=s.join(",")+"\n",M.forEach(s=>{e+="".concat(s.id,',"').concat(s.name,'",').concat(s.totalCalls,",").concat(s.completedCalls,",").concat(s.missedCalls,',"').concat(s.avgDuration,'","').concat(s.status,'"\n')}));const a=new Blob([e],{type:"text/csv"}),t=window.URL.createObjectURL(a),c=document.createElement("a");c.href=t,c.download="".concat(u,"-report-").concat((new Date).toISOString().split("T")[0],".csv"),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(t)},disabled:s||0===Y.length,children:[(0,d.jsx)(l.Ay,{icon:n.s,className:"me-2"}),"Export Report"]})})]}),(0,d.jsxs)(c.sK,{className:"mb-4",children:[(0,d.jsx)(c.UF,{md:2,children:(0,d.jsxs)(c.MT,{value:j,onChange:e=>{const s=e.target.value;p(s),"custom"!==s&&(v(""),N(""))},children:[(0,d.jsx)("option",{value:"today",children:"Today"}),(0,d.jsx)("option",{value:"yesterday",children:"Yesterday"}),(0,d.jsx)("option",{value:"last-7-days",children:"Last 7 Days"}),(0,d.jsx)("option",{value:"last-30-days",children:"Last 30 Days"}),(0,d.jsx)("option",{value:"custom",children:"Custom Range"})]})}),"custom"===j&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(c.UF,{md:2,children:(0,d.jsx)(c.OG,{type:"date",value:g,onChange:e=>v(e.target.value),"aria-label":"Start date"})}),(0,d.jsx)(c.UF,{md:2,children:(0,d.jsx)(c.OG,{type:"date",value:C,onChange:e=>N(e.target.value),"aria-label":"End date"})})]}),"data-access-logs"===u&&(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(c.UF,{md:2,children:(0,d.jsxs)(c.MT,{value:y,onChange:e=>A(e.target.value),children:[(0,d.jsx)("option",{value:"all",children:"All Resources"}),L.map((e,s)=>(0,d.jsx)("option",{value:e,children:e},s))]})}),(0,d.jsx)(c.UF,{md:2,children:(0,d.jsxs)(c.MT,{value:b,onChange:e=>T(e.target.value),children:[(0,d.jsx)("option",{value:"all",children:"All Roles"}),(0,d.jsx)("option",{value:"business",children:"Business"}),(0,d.jsx)("option",{value:"agent(branch_manager)",children:"Agent (Branch Manager)"})]})})]}),(0,d.jsx)(c.UF,{md:"data-access-logs"===u?6:10,children:(0,d.jsxs)(c.BG,{children:[(0,d.jsx)(c.OG,{placeholder:"Search reports...",value:S,onChange:e=>f(e.target.value)}),(0,d.jsx)(c.Q_,{type:"button",color:"primary",variant:"outline",children:(0,d.jsx)(l.Ay,{icon:r.B})})]})})]}),"data-access-logs"===u&&("all"!==y||"all"!==b)&&(0,d.jsx)(c.sK,{className:"mb-3",children:(0,d.jsx)(c.UF,{children:(0,d.jsxs)("div",{className:"d-flex align-items-center",children:[(0,d.jsx)("small",{className:"text-muted me-2",children:"Active filters:"}),"all"!==y&&(0,d.jsxs)(c.$X,{color:"info",className:"me-2",children:["Resource: ",y,(0,d.jsx)(c.Q_,{size:"sm",color:"info",variant:"ghost",className:"ms-1 p-0",style:{fontSize:"10px",lineHeight:"1"},onClick:()=>A("all"),children:"\xd7"})]}),"all"!==b&&(0,d.jsxs)(c.$X,{color:"info",className:"me-2",children:["Role: ",b,(0,d.jsx)(c.Q_,{size:"sm",color:"info",variant:"ghost",className:"ms-1 p-0",style:{fontSize:"10px",lineHeight:"1"},onClick:()=>T("all"),children:"\xd7"})]})]})})}),h&&(0,d.jsx)(c.kj,{color:"danger",className:"mb-4",children:h}),(0,d.jsxs)(c._v,{hover:!0,responsive:!0,className:"contact-table",children:[(0,d.jsx)(c.wV,{children:"data-access-logs"===u?(0,d.jsxs)(c.YI,{children:[(0,d.jsx)(c.$s,{children:"S.NO"}),(0,d.jsx)(c.$s,{children:"USER EMAIL"}),(0,d.jsx)(c.$s,{children:"ACTION"}),(0,d.jsx)(c.$s,{children:"RESOURCE"}),(0,d.jsx)(c.$s,{children:"TIMESTAMP"}),(0,d.jsx)(c.$s,{children:"IP ADDRESS"})]}):"call-logs"===u?(0,d.jsxs)(c.YI,{children:[(0,d.jsx)(c.$s,{children:"S.NO"}),(0,d.jsx)(c.$s,{children:"CALLER"}),(0,d.jsx)(c.$s,{children:"RECEIVER"}),(0,d.jsx)(c.$s,{children:"DURATION"}),(0,d.jsx)(c.$s,{children:"STATUS"}),(0,d.jsx)(c.$s,{children:"TYPE"})]}):"agent-performance"===u?(0,d.jsxs)(c.YI,{children:[(0,d.jsx)(c.$s,{children:"S.NO"}),(0,d.jsx)(c.$s,{children:"AGENT NAME"}),(0,d.jsx)(c.$s,{children:"TOTAL CALLS"}),(0,d.jsx)(c.$s,{children:"COMPLETED"}),(0,d.jsx)(c.$s,{children:"STATUS"})]}):void 0}),(0,d.jsx)(c.jS,{children:s?(0,d.jsx)(c.YI,{children:(0,d.jsxs)(c.cC,{colSpan:"6",className:"text-center py-5",children:[(0,d.jsx)(c.JT,{color:"primary"}),(0,d.jsx)("div",{className:"mt-3",children:"Loading report data..."})]})}):0===J.length?(0,d.jsx)(c.YI,{children:(0,d.jsx)(c.cC,{colSpan:"6",className:"text-center py-5",children:(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("div",{className:"empty-state-icon",children:(0,d.jsx)(l.Ay,{icon:i.H,size:"xl"})}),(0,d.jsx)("h4",{children:"No Data Available"}),(0,d.jsx)("p",{children:"No report data found for the selected criteria."})]})})}):J.map((e,s)=>(0,d.jsxs)(c.YI,{children:[(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-number",children:G+s+1})}),"data-access-logs"===u?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-name",children:String(e.userId||"N/A")})}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:String(e.accessType||"N/A")})}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:String(e.resourceAccessed||"N/A")})}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:e.timestamp})}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:String(e.ipAddress||"N/A")})})]}):"call-logs"===u?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-name",children:e.caller})}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:e.receiver})}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:e.duration})}),(0,d.jsx)(c.cC,{children:Q(e.status)}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:e.type})})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-name",children:e.name})}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:e.totalCalls})}),(0,d.jsx)(c.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:e.completedCalls})}),(0,d.jsx)(c.cC,{children:Q(e.status)})]})]},e.id))})]}),"data-access-logs"===u&&(0,d.jsx)(c.sK,{className:"mt-4",children:(0,d.jsxs)(c.UF,{className:"d-flex justify-content-between align-items-center",children:[(0,d.jsxs)("div",{className:"pagination-info",children:[O.name&&(0,d.jsxs)("span",{className:"me-3",children:[(0,d.jsx)("strong",{children:"Business:"})," ",O.name,O.totalBranches>0&&" (".concat(O.totalBranches," branches)")]}),(0,d.jsxs)("span",{children:["Showing ",(I-1)*E+1," to ",Math.min(I*E,B)," of ",B," entries"]})]}),(0,d.jsxs)(c._l,{"aria-label":"Page navigation example",className:"mb-0",children:[(0,d.jsx)(c.Xp,{disabled:1===I,onClick:()=>H(I-1),children:"Previous"}),(0,d.jsxs)(c.Xp,{active:!0,children:[I," of ",$]}),(0,d.jsx)(c.Xp,{disabled:I===$,onClick:()=>H(I+1),children:"Next"})]})]})})]})})})}}}]);