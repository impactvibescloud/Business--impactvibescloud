"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[8350],{4445:function(e,t,l){l.d(t,{s:function(){return n}});const n=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='272 434.744 272 209.176 240 209.176 240 434.744 188.118 382.862 165.49 405.489 256 496 346.51 405.489 323.882 382.862 272 434.744' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M400,161.176c0-79.4-64.6-144-144-144s-144,64.6-144,144a96,96,0,0,0,0,192h80v-32H112a64,64,0,0,1,0-128h32v-32a112,112,0,0,1,224,0v32h32a64,64,0,0,1,0,128H320v32h80a96,96,0,0,0,0-192Z' class='ci-primary'/>"]},10185:function(e,t,l){l.d(t,{B:function(){return n}});const n=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"]},14495:function(e,t,l){l.d(t,{R:function(){return n}});const n=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M238.627,496H192V253.828l-168-200V16H480V53.612l-160,200V414.627ZM224,464h1.373L288,401.373V242.388L443.51,48H60.9L224,242.172Z' class='ci-primary'/>"]},78350:function(e,t,l){l.r(t),l.d(t,{default:function(){return h}});var n=l(9950),a=l(49911),c=l(81949),s=l(10185),r=l(14495),o=l(4445);const i=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M444.4,235.236,132.275,49.449A24,24,0,0,0,96,70.072V434.214a24.017,24.017,0,0,0,35.907,20.839L444.03,276.7a24,24,0,0,0,.367-41.461ZM128,420.429V84.144L416.244,255.718Z' class='ci-primary'/>"];var d=l(2720),u=l(44414);var h=()=>{const[e,t]=(0,n.useState)([]),[l,h]=(0,n.useState)(20),[g,m]=(0,n.useState)(!0),[p,x]=(0,n.useState)(null),[f,y]=(0,n.useState)(""),[j,v]=(0,n.useState)(1),[C,b]=(0,n.useState)(1),[A,w]=(0,n.useState)(0),[N,S]=(0,n.useState)(!1),[L,k]=(0,n.useState)([]),[R,T]=(0,n.useState)(!1),[I,E]=(0,n.useState)(null),[U,D]=(0,n.useState)("All Calls"),[B,O]=(0,n.useState)(null),[_,F]=(0,n.useState)(""),[M,P]=(0,n.useState)(""),[z,H]=(0,n.useState)("All"),[G,Y]=(0,n.useState)(!1),[$,W]=(0,n.useState)(null),[Q,V]=(0,n.useState)(null),[X,Z]=(0,n.useState)(!1),[J,K]=(0,n.useState)(null),q=(0,n.useRef)(null),[ee,te]=(0,n.useState)(null),le=(0,n.useRef)(null),ne=(0,n.useRef)(null),ae=(0,n.useRef)(null),[ce,se]=(0,n.useState)(!1),[re,oe]=(0,n.useState)(null),[ie,de]=(0,n.useState)(null),[ue,he]=(0,n.useState)(!1),ge=(0,n.useRef)("");(0,n.useEffect)(()=>{(async()=>{try{var e;const t=await(0,d.H2)("/v1/user/details","GET");if(null!==t&&void 0!==t&&null!==(e=t.user)&&void 0!==e&&e.businessId)return void O(t.user.businessId);const l=localStorage.getItem("businessId");if(l)return void O(l);throw new Error("Business ID not found")}catch(t){console.error("Failed to get business ID:",t),x("Failed to get business ID. Please make sure you are properly logged in.")}})()},[]);const me=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l,n="/call-logs/business/".concat(B,"?page=").concat(e,"&limit=").concat(t);if(f&&(n+="&search=".concat(encodeURIComponent(f))),_)try{const e=String(_).split("-");if(3===e.length){const t=Number(e[0]),l=Number(e[1])-1,a=Number(e[2]),c=new Date(t,l,a);c.setHours(0,0,0,0),n+="&from=".concat(encodeURIComponent(c.toISOString()))}else n+="&from=".concat(encodeURIComponent(_))}catch(a){n+="&from=".concat(encodeURIComponent(_))}if(M)try{const e=String(M).split("-");if(3===e.length){const t=Number(e[0]),l=Number(e[1])-1,a=Number(e[2]),c=new Date(t,l,a);c.setHours(23,59,59,999),n+="&to=".concat(encodeURIComponent(c.toISOString()))}else n+="&to=".concat(encodeURIComponent(M))}catch(a){n+="&to=".concat(encodeURIComponent(M))}if(z&&"All"!==z){const e=String(z);let t=e.toLowerCase();"Outgoing"===e?t="outbound":"Incoming"===e&&(t="inbound"),n+="&callType=".concat(encodeURIComponent(t))}return U&&"All Calls"!==U&&("Completed"===U?n+="&status=completed":"Failed"===U?n+="&status=failed":"Outgoing"===U?n+="&callType=outbound":"Incoming"===U&&(n+="&callType=inbound")),n};(0,n.useEffect)(()=>{(async()=>{if(B){m(!0),x(null);try{const a=Boolean(_||M),c=me(a?1:j,a?1e3:l),s="".concat(_||"","|").concat(M||"","|").concat(B||"");let r=null,o=[],i=null;if(a&&ge.current===s&&e&&e.length>0)console.debug("Using cached filtered call logs for",s),o=e;else if(console.debug("Fetching call logs from endpoint:",c),r=await(0,d.H2)(c,"GET"),Array.isArray(r))o=r;else if(r&&Array.isArray(r.data))o=r.data,i=r.pagination||null;else if(r&&Array.isArray(r.callLogs))o=r.callLogs,i=r.pagination||null;else{var n;o=[],i=(null===(n=r)||void 0===n?void 0:n.pagination)||null}if(a){const e=ge.current!==s;ge.current=s,S(!1),t(o),w(o.length),b(Math.max(1,Math.ceil(o.length/l))),e&&v(1)}else t(o),i?(S(!0),b(i.totalPages||Math.max(1,Math.ceil((i.totalRecords||o.length)/l))),w(i.totalRecords||o.length)):(S(!1),w(o.length),b(Math.max(1,Math.ceil(o.length/l))))}catch(a){x("Business ID not found"===a.message?"Business ID not found. Please make sure you are properly logged in.":"Failed to fetch call logs. Please try again later."),t([]),b(1),w(0)}finally{m(!1)}}})()},[B,j,f,l,_,M,z,U]),(0,n.useEffect)(()=>{(async()=>{if(B){T(!0),E(null);try{const e=await(0,d.H2)("/v1/audio-recordings","GET");Array.isArray(null===e||void 0===e?void 0:e.files)?k(e.files):Array.isArray(e)?k(e):k([])}catch(e){console.error("Failed to fetch audio recordings",e),E("Failed to load audio recordings"),k([])}finally{T(!1)}}})()},[B]);const pe=e=>{if(!e)return"Unknown";return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},xe=e=>{if(!e)return"";try{return new Date(e).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!0})}catch(t){return e}},fe=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return null;const l=String(e).split("-");if(3!==l.length)return null;const n=Number(l[0]),a=Number(l[1])-1,c=Number(l[2]);if(Number.isNaN(n)||Number.isNaN(a)||Number.isNaN(c))return null;const s=new Date(n,a,c);return t?s.setHours(23,59,59,999):s.setHours(0,0,0,0),s.getTime()},ye=N?e:e.filter(e=>{const t=String(e.callType||"").toLowerCase(),l=String(e.status||"").toLowerCase();let n=!0;if(U&&"All Calls"!==U&&("Completed"===U?n="completed"===l||"success"===l:"Failed"===U?n=l.includes("fail")||l.includes("error"):"Outgoing"===U?n="outbound"===t||"outgoing"===t:"Incoming"===U&&(n="inbound"===t||"incoming"===t)),n&&z&&"All"!==z){const e=z.toLowerCase();"outgoing"===e?n="outbound"===t||"outgoing"===t:"incoming"===e&&(n="inbound"===t||"incoming"===t)}if(n&&(_||M)){const t=e.callDate||e.createdAt;if(t){const e=new Date(t).getTime();if(_){const t=fe(_,!1);null!==t&&e<t&&(n=!1)}if(n&&M){const t=fe(M,!0);null!==t&&e>t&&(n=!1)}}}return n}),je=N?ye:ye.slice((j-1)*l,j*l),ve=(N||ye.length,N?C:Math.max(1,Math.ceil(ye.length/l))),Ce=e=>{D(e),v(1)},be=async e=>{if(e){K(null),Z(!0);try{const l=localStorage.getItem("authToken")||"";let n=e;try{n=new URL(e).href}catch(t){e.startsWith("/")||(n="".concat((0,d.vo)(),"/api/v1/audio-recordings/").concat(encodeURIComponent(e)))}const a=await fetch(n,{method:"GET",headers:{Authorization:l?"Bearer ".concat(l):""}});if(console.debug("Recording fetch response",{url:e,ok:a.ok,status:a.status,headers:Array.from(a.headers.entries())}),!a.ok){const e=await a.text().catch(()=>"");throw new Error("Failed to fetch recording: ".concat(a.status," ").concat(e))}let c=a.headers.get("Content-Type")||"";c&&"application/octet-stream"!==c||(c=e.toLowerCase().endsWith(".wav")?"audio/wav":"audio/mpeg");const s=await a.arrayBuffer();if(!s||0===s.byteLength)throw new Error("Empty audio file received");const r=new Blob([s],{type:c}),o=URL.createObjectURL(r);if(Q)try{URL.revokeObjectURL(Q)}catch(t){}V(o),te(c),oe({status:a.status,contentType:c,size:r.size}),setTimeout(async()=>{try{if(q.current){q.current.onerror=null,q.current.src=o,q.current.load();const e=q.current.play();e&&"function"===typeof e.then&&e.catch(e=>{console.warn("Autoplay prevented or playback failed on audio element, will try WebAudio fallback",e),Ae(s,c)}),q.current.onerror=e=>{console.warn("Audio element error, attempting WebAudio fallback",e),Ae(s,c)}}}catch(t){console.warn("Error attempting to play audio element, trying WebAudio fallback",t);try{Ae(s,c)}catch(e){console.warn(e)}}},50)}catch(l){console.error("Failed to play recording",l),K(l.message||"Failed to play recording")}finally{Z(!1)}}else alert("No recording available for this call")},Ae=async(e,t)=>{try{if(!le.current){const e=window.AudioContext||window.webkitAudioContext;le.current=new e}const t=le.current;if(ae.current){try{ae.current.stop(0)}catch(l){}ae.current.disconnect(),ae.current=null}let n;n=1===t.decodeAudioData.length?await t.decodeAudioData(e.slice(0)):await new Promise((l,n)=>{t.decodeAudioData(e.slice(0),l,n)}),ne.current=n;const a=t.createBufferSource();a.buffer=n,a.connect(t.destination),ae.current=a,a.onended=()=>{se(!1)},a.start(0),se(!0)}catch(n){console.error("WebAudio fallback failed",n),K("Playback failed (decoder error)")}},we=()=>{try{if(ae.current){try{ae.current.stop(0)}catch(e){}ae.current.disconnect(),ae.current=null}se(!1)}catch(e){console.warn("Error stopping WebAudio",e)}},Ne=async(e,t)=>{const l=t||e;try{de(l),await(async(e,t)=>{try{let n=t||"";try{const t=new URL(e).pathname.split("/");n=n||decodeURIComponent(t.pop()||t.pop())}catch(l){n||(n=e)}if(!n)return void alert("No recording available for download");const a=localStorage.getItem("authToken")||"",c="".concat((0,d.vo)(),"/api/v1/audio-recordings/download/").concat(encodeURIComponent(n)),s=await fetch(c,{method:"GET",headers:{Authorization:a?"Bearer ".concat(a):""}});if(!s.ok){const e=await s.text().catch(()=>"");throw new Error("Download failed: ".concat(s.status," ").concat(e))}const r=await s.blob(),o=URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=n,document.body.appendChild(i),i.click(),i.remove(),URL.revokeObjectURL(o)}catch(n){console.error("Download failed",n),alert("Download failed")}})(e,t)}finally{de(null)}},Se=e=>{if(!e)return"00:00";const t=parseInt(e),l=Math.floor(t/60),n=t%60;return"".concat(l.toString().padStart(2,"0"),":").concat(n.toString().padStart(2,"0"))},Le=e=>{if(null==e)return"";const t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'+t.replace(/"/g,'""')+'"':t};return(0,u.jsxs)("div",{className:"call-logs-container",children:[(0,u.jsx)(a.E$,{className:"mb-4",children:(0,u.jsxs)(a.W6,{children:[(0,u.jsxs)(a.sK,{className:"mb-3 align-items-center",children:[(0,u.jsx)(a.UF,{md:6,children:(0,u.jsx)("h1",{className:"call-logs-title",children:"Call Logs"})}),(0,u.jsx)(a.UF,{md:6,className:"d-flex justify-content-end"})]}),(0,u.jsxs)(a.sK,{className:"mb-4",children:[(0,u.jsx)(a.UF,{md:6,children:(0,u.jsxs)(a.BG,{children:[(0,u.jsx)(a.OG,{placeholder:"Search call logs...",value:f,onChange:e=>{y(e.target.value),v(1)}}),(0,u.jsx)(a.Q_,{type:"button",color:"primary",variant:"outline",children:(0,u.jsx)(c.Ay,{icon:s.B})})]})}),(0,u.jsx)(a.UF,{md:6,className:"d-flex justify-content-end",children:(0,u.jsx)("div",{className:"d-flex align-items-center",children:(0,u.jsxs)(a.BG,{style:{maxWidth:180},children:[(0,u.jsx)(a.OG,{type:"number",min:5,max:100,value:l,onChange:e=>{h(Number(e.target.value)),v(1)},placeholder:"Rows per page"}),(0,u.jsx)(a.Q_,{type:"button",color:"secondary",variant:"outline",disabled:!0,children:"Rows/Page"})]})})})]}),(0,u.jsx)(a.sK,{className:"mb-3",children:(0,u.jsx)(a.UF,{md:12,children:(0,u.jsxs)("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[(0,u.jsxs)(a.MT,{value:z,onChange:e=>{H(e.target.value),v(1)},style:{width:160},children:[(0,u.jsx)("option",{value:"All",children:"All Call Types"}),(0,u.jsx)("option",{value:"Incoming",children:"Incoming"}),(0,u.jsx)("option",{value:"Outgoing",children:"Outgoing"})]}),(0,u.jsx)(a.OG,{type:"date",value:_,onChange:e=>{F(e.target.value),v(1)},style:{width:180}}),(0,u.jsx)(a.OG,{type:"date",value:M,onChange:e=>{P(e.target.value),v(1)},style:{width:180}}),(0,u.jsxs)(a.ji,{children:[(0,u.jsxs)(a.VH,{color:"secondary",variant:"outline",style:{minWidth:150},children:[(0,u.jsx)(c.Ay,{icon:r.R,className:"me-2"}),U]}),(0,u.jsxs)(a.QR,{children:[(0,u.jsxs)(a.kd,{onClick:()=>Ce("All Calls"),active:"All Calls"===U,children:["All Calls ","All Calls"===U&&"\u2713"]}),(0,u.jsxs)(a.kd,{onClick:()=>Ce("Completed"),active:"Completed"===U,children:["Completed ","Completed"===U&&"\u2713"]}),(0,u.jsxs)(a.kd,{onClick:()=>Ce("Outgoing"),active:"Outgoing"===U,children:["Outgoing ","Outgoing"===U&&"\u2713"]}),(0,u.jsxs)(a.kd,{onClick:()=>Ce("Incoming"),active:"Incoming"===U,children:["Incoming ","Incoming"===U&&"\u2713"]}),(0,u.jsxs)(a.kd,{onClick:()=>Ce("Failed"),active:"Failed"===U,children:["Failed ","Failed"===U&&"\u2713"]})]})]}),(0,u.jsx)(a.Q_,{color:"light",onClick:()=>{F(""),P(""),H("All"),y(""),D("All Calls"),v(1)},children:"Clear Filters"}),(0,u.jsx)("div",{style:{marginLeft:"auto"},children:(()=>{const e=N?A:ye.length;return(0,u.jsx)(a.Q_,{color:"info",onClick:()=>(async()=>{if(B){he(!0);try{const l=Boolean(_||M),n=1e3;let a=[];if(l){let l=1;const c=5e3,s=Math.ceil(c/n),r=_?fe(_,!1):null,o=M?fe(M,!0):null;for(;;){const c=me(l,n);console.debug("Export (filtered) fetching page ".concat(l,":"),c);const i=await(0,d.H2)(c,"GET");let u=[];if(u=Array.isArray(i)?i:i&&Array.isArray(i.data)?i.data:i&&Array.isArray(i.callLogs)?i.callLogs:[],u.length>0){var e,t;const n=u.map(e=>new Date(e.callDate||e.createdAt).getTime()).filter(Boolean),c=n.length?Math.max(...n):null,s=n.length?Math.min(...n):null,i=u.filter(e=>{const t=new Date(e.callDate||e.createdAt).getTime();return!Number.isNaN(t)&&!(null!==r&&t<r)&&!(null!==o&&t>o)});if(a=a.concat(i),console.debug("Export (filtered) page ".concat(l," returned ").concat(u.length," records, matched ").concat(i.length),i.length?{firstMatched:null===(e=i[0])||void 0===e?void 0:e.callDate,lastMatched:null===(t=i[i.length-1])||void 0===t?void 0:t.callDate}:null,{maxPageTs:c?new Date(c).toISOString():null,minPageTs:s?new Date(s).toISOString():null}),null!==r&&null!==c&&c<r){console.debug("Export (filtered) early stop: page max timestamp is older than fromTs");break}}if(u.length<n)break;if(l+=1,l>s){console.warn("Reached export max pages cap; stopping further fetches");break}}}else{const e=me(1,n);console.debug("Export (unfiltered) fetching first page:",e);const t=await(0,d.H2)(e,"GET");let l=null;if(Array.isArray(t)?a=t:t&&Array.isArray(t.data)?(a=t.data,l=t.pagination||null):t&&Array.isArray(t.callLogs)?(a=t.callLogs,l=t.pagination||null):(a=[],l=(null===t||void 0===t?void 0:t.pagination)||null),l&&l.totalPages&&l.totalPages>1){const e=l.totalPages,t=l.limit||n,c=[];for(let l=2;l<=e;l++){const e=me(l,t);console.debug("Export (unfiltered) will fetch page",l,e),c.push((0,d.H2)(e,"GET"))}(await Promise.all(c)).forEach(e=>{Array.isArray(e)?a=a.concat(e):e&&Array.isArray(e.data)?a=a.concat(e.data):e&&Array.isArray(e.callLogs)&&(a=a.concat(e.callLogs))})}}if(!a||0===a.length)return void alert("No call logs available to export");const c=["S.NO","CALL TYPE","CALL DATE","CALL INITIATED BY","CALL RECEIVED BY","CALL REJECTED BY","TEAM","HANG UP BY","DURATION","COST","NOTES","STATUS","VIRTUAL NUMBER","CONTACT"],s=[];s.push(c.join(",")),a.forEach((e,t)=>{const l=xe(e.callDate||e.createdAt),n=Se(e.callDuration||e.duration),a=null!=e.cost?Number(e.cost).toFixed(2):"",c=[t+1,Le(e.callType||""),Le(l),Le(e.callInitiatedBy||""),Le(e.callReceivedBy||""),Le(e.callRejectedBy||""),Le(e.team||""),Le(e.hangUpBy||""),Le(n),Le(a),Le(e.notes||""),Le(pe(e.status)),Le(e.virtualNumber||""),Le(e.contact||"")];s.push(c.join(","))});const r=s.join("\n"),o=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(o),u=document.createElement("a");u.href=i;const h=new Date,g="call-logs-".concat(B,"-").concat(h.toISOString().slice(0,19).replace(/[:T]/g,"-"),".csv");u.download=g,document.body.appendChild(u),u.click(),u.remove(),URL.revokeObjectURL(i)}catch(l){console.error("Export failed",l),alert("Export failed. Check console for details.")}finally{he(!1)}}else alert("Business ID not available yet. Please try again.")})(),disabled:!B||ue,children:ue?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.JT,{size:"sm",className:"me-2"})," Exporting..."]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(c.Ay,{icon:o.s,className:"me-2"})," Export All (",e,")"]})})})()})]})})}),(0,u.jsxs)(a._v,{hover:!0,responsive:!0,className:"call-logs-table",children:[(0,u.jsx)(a.wV,{children:(0,u.jsxs)(a.YI,{children:[(0,u.jsx)(a.$s,{children:"S.NO"}),(0,u.jsx)(a.$s,{children:"CALL TYPE"}),(0,u.jsx)(a.$s,{children:"CALL DATE"}),(0,u.jsx)(a.$s,{children:"CALL INITIATED BY"}),(0,u.jsx)(a.$s,{children:"CALL RECEIVED BY"}),(0,u.jsx)(a.$s,{children:"CALL REJECTED BY"}),(0,u.jsx)(a.$s,{children:"TEAM"}),(0,u.jsx)(a.$s,{children:"HANG UP BY"}),(0,u.jsx)(a.$s,{children:"DURATION"}),(0,u.jsx)(a.$s,{children:"COST"}),(0,u.jsx)(a.$s,{children:"NOTES"}),(0,u.jsx)(a.$s,{children:"STATUS"})]})}),(0,u.jsx)(a.jS,{children:g?(0,u.jsx)(a.YI,{children:(0,u.jsxs)(a.cC,{colSpan:"12",className:"text-center py-5",children:[(0,u.jsx)(a.JT,{color:"primary"}),(0,u.jsx)("div",{className:"mt-3",children:"Loading call logs..."})]})}):p?(0,u.jsx)(a.YI,{children:(0,u.jsx)(a.cC,{colSpan:"12",className:"text-center py-5",children:(0,u.jsx)(a.kj,{color:"danger",className:"mb-0",children:p})})}):0===ye.length?(0,u.jsx)(a.YI,{children:(0,u.jsx)(a.cC,{colSpan:"12",className:"text-center py-5",children:(0,u.jsxs)("div",{className:"empty-state",children:[(0,u.jsx)("div",{className:"empty-state-icon",children:(0,u.jsx)(c.Ay,{icon:s.B,size:"xl"})}),(0,u.jsx)("h4",{children:"No call logs found"}),(0,u.jsx)("p",{children:"There are no call logs available matching your search criteria."})]})})}):je.map((e,t)=>{const n=e.callType||"Unknown",c=xe(e.callDate||e.createdAt),s=pe(e.status);return(0,u.jsxs)(a.YI,{onClick:()=>{W(e),Y(!0)},style:{cursor:"pointer"},children:[(0,u.jsx)(a.cC,{children:(0,u.jsx)("span",{className:"log-number",children:(j-1)*l+t+1})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{className:"log-type text-capitalize",children:n})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{className:"log-date",children:c})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{children:e.callInitiatedBy||"Unknown"})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{children:e.callReceivedBy||"N/A"})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{children:e.callRejectedBy||"N/A"})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{children:e.team||"N/A"})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{children:e.hangUpBy||"Unknown"})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{children:Se(e.callDuration||e.duration)})}),(0,u.jsx)(a.cC,{children:(0,u.jsxs)("div",{children:["$",e.cost?e.cost.toFixed(2):"N/A"]})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)("div",{className:"text-truncate",style:{maxWidth:"200px"},title:e.notes||"No notes available",children:e.notes||"No notes available"})}),(0,u.jsx)(a.cC,{children:(0,u.jsx)(a.$X,{color:"success"===s.toLowerCase()||"completed"===s.toLowerCase()?"success":s.toLowerCase().includes("fail")?"danger":"missed"===s.toLowerCase()?"warning":"secondary",className:"status-badge",children:s})})]},e._id)})})]}),ve>1&&(0,u.jsx)("div",{style:{overflowX:"auto",whiteSpace:"nowrap",maxWidth:"100%"},children:(0,u.jsxs)(a._l,{"aria-label":"Page navigation",className:"justify-content-center mt-4",style:{display:"inline-flex",flexWrap:"nowrap"},children:[(0,u.jsx)(a.Xp,{disabled:1===j,onClick:()=>v(j-1),children:"Previous"}),(()=>{const e=[],t=ve;return e.push((0,u.jsx)(a.Xp,{active:1===j,onClick:()=>v(1),children:1},1)),j>3&&e.push((0,u.jsx)(a.Xp,{disabled:!0,children:"..."},"start-ellipsis")),j>2&&j!==t&&e.push((0,u.jsx)(a.Xp,{onClick:()=>v(j-1),children:j-1},j-1)),1!==j&&j!==t&&e.push((0,u.jsx)(a.Xp,{active:!0,onClick:()=>v(j),children:j},j)),j<t-1&&1!==j&&e.push((0,u.jsx)(a.Xp,{onClick:()=>v(j+1),children:j+1},j+1)),j<t-2&&e.push((0,u.jsx)(a.Xp,{disabled:!0,children:"..."},"end-ellipsis")),1!==t&&e.push((0,u.jsx)(a.Xp,{active:j===t,onClick:()=>v(t),children:t},t)),e})(),(0,u.jsx)(a.Xp,{disabled:j===ve,onClick:()=>v(j+1),children:"Next"})]})})]})}),(0,u.jsxs)(a.zS,{visible:G,onClose:()=>{if(Y(!1),Q){try{URL.revokeObjectURL(Q)}catch(e){}V(null)}te(null),K(null),Z(!1),oe(null);try{we()}catch(e){}try{le.current&&(le.current.close(),le.current=null)}catch(e){}},size:"lg",children:[(0,u.jsx)(a.E4,{children:(0,u.jsxs)("h5",{children:["Call Recording - ",$?xe($.callDate||$.createdAt):""]})}),(0,u.jsx)(a.Tc,{children:$&&(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{className:"mb-3",children:[(0,u.jsx)("strong",{children:"Call Details:"}),(0,u.jsxs)("p",{children:["Type: ",$.callType||"Unknown"]}),(0,u.jsxs)("p",{children:["Initiated By: ",$.callInitiatedBy||"Unknown"]}),(0,u.jsxs)("p",{children:["Received By: ",$.callReceivedBy||"N/A"]}),(0,u.jsxs)("p",{children:["Duration: ",Se($.callDuration||$.duration)]}),(0,u.jsxs)("p",{children:["Status: ",pe($.status)]})]}),(0,u.jsxs)("div",{className:"mb-3",children:[(0,u.jsx)("strong",{children:"Recording Options:"}),(0,u.jsx)("div",{className:"d-flex gap-2 flex-wrap mt-2",children:$.callRecording?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(a.Q_,{color:"primary",onClick:()=>be($.callRecording),children:[(0,u.jsx)(c.Ay,{icon:i,className:"me-2"}),"Play Recording"]}),(0,u.jsx)(a.Q_,{color:"success",onClick:()=>Ne($.callRecording,"call-recording-".concat($._id,".mp3")),disabled:null!==ie,children:ie==="call-recording-".concat($._id,".mp3")?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.JT,{size:"sm",className:"me-2"}),"Downloading..."]}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(c.Ay,{icon:o.s,className:"me-2"}),"Download Recording"]})})]}):(()=>{const e=String($.virtualNumber||"").replace(/[^0-9]/g,""),t=String($.contact||"").replace(/[^0-9]/g,"");if(!e||!t||0===L.length)return(0,u.jsx)("p",{className:"text-muted",children:"No recording available for this call."});const l=e=>{const t=[];return e?(t.push(e),e.length>10&&t.push(e.slice(-10)),e.length>8&&t.push(e.slice(-8)),e.length>6&&t.push(e.slice(-6)),t):t},n=l(e),s=l(t),r=L.filter(e=>n.some(t=>t&&e.includes(t))&&s.some(t=>t&&e.includes(t)));if(0===r.length)return(0,u.jsx)("p",{className:"text-muted",children:"No recording available for this call."});const h=new Set,g=r.filter(e=>!h.has(e)&&(h.add(e),!0));return(0,u.jsxs)("div",{children:[(0,u.jsx)("p",{className:"mb-2",children:"Available recordings:"}),(0,u.jsx)("div",{className:"d-flex flex-column gap-2",children:g.map((e,t)=>{const l="".concat((0,d.vo)(),"/api/v1/audio-recordings/").concat(encodeURIComponent(e));return(0,u.jsxs)("div",{className:"d-flex align-items-center gap-2 p-2 border rounded",children:[(0,u.jsx)("span",{className:"flex-grow-1 text-truncate",title:e,children:e}),(0,u.jsx)(a.Q_,{size:"sm",color:"primary",variant:"outline",onClick:()=>be(l),children:(0,u.jsx)(c.Ay,{icon:i,size:"sm"})}),(0,u.jsx)(a.Q_,{size:"sm",color:"success",variant:"outline",onClick:()=>Ne(l,e),disabled:null!==ie,children:ie===e?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a.JT,{size:"sm",className:"me-1"}),"DL"]}):(0,u.jsx)(c.Ay,{icon:o.s,size:"sm"})})]},t)})})]})})()}),X&&(0,u.jsx)("div",{className:"mt-3",children:"Loading recording..."}),J&&(0,u.jsx)("div",{className:"mt-3 text-danger",children:J}),re&&(0,u.jsxs)("div",{className:"mt-2 small text-muted",children:["Response: ",re.status," \u2022 Type: ",re.contentType," \u2022 Size: ",Math.round((re.size||0)/1024)," KB"]}),Q&&(0,u.jsxs)("div",{className:"mt-3",children:[(0,u.jsxs)("div",{className:"d-flex gap-2 mb-2",children:[(0,u.jsx)(a.Q_,{size:"sm",color:"info",variant:"outline",onClick:()=>window.open(Q,"_blank"),children:"Open in new tab"}),(0,u.jsx)(a.Q_,{size:"sm",color:"secondary",variant:"outline",onClick:()=>{const e=document.createElement("a");e.href=Q,e.download="recording.".concat(ee&&ee.includes("wav")?"wav":"mp3"),document.body.appendChild(e),e.click(),e.remove()},children:"Download (debug)"}),ce?(0,u.jsx)(a.Q_,{size:"sm",color:"danger",variant:"outline",onClick:()=>we(),children:"Stop WebAudio"}):null]}),(0,u.jsxs)("audio",{controls:!0,ref:q,autoPlay:!0,style:{width:"100%"},children:[(0,u.jsx)("source",{src:Q,type:ee||"audio/mpeg"}),"Your browser does not support the audio element."]})]})]})]})}),(0,u.jsx)(a.If,{children:(0,u.jsx)(a.Q_,{color:"secondary",onClick:()=>{if(Y(!1),Q){try{URL.revokeObjectURL(Q)}catch(e){}V(null)}te(null),K(null),Z(!1),oe(null);try{we()}catch(e){}try{le.current&&(le.current.close(),le.current=null)}catch(e){}},children:"Close"})})]})]})}}}]);