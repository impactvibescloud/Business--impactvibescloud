"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[9614],{10185:function(e,r,s){s.d(r,{B:function(){return t}});const t=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"]},19614:function(e,r,s){s.r(r),s.d(r,{default:function(){return m}});var t=s(9950),n=s(49911),o=s(81949),a=s(50323),i=s(10185),l=s(10113),c=s(2720),u=s(11031),d=s(44414);var m=function(){const[e,r]=(0,t.useState)(""),[s,m]=(0,t.useState)("All Numbers"),[h,g]=(0,t.useState)(""),[y,p]=(0,t.useState)(!1),[f,x]=(0,t.useState)(null),[j,v]=(0,t.useState)([]),[b,A]=(0,t.useState)(null),[C,N]=(0,t.useState)(1),[w]=(0,t.useState)(10),[S,k]=(0,t.useState)(null),I=(0,u.g)();(0,t.useEffect)(()=>{I&&(async()=>{try{var e;if(!I&&!localStorage.getItem("authToken"))return void x("Authentication required. Please login again.");const r=await(0,c.H2)("/v1/user/details","GET"),s=(null===r||void 0===r||null===(e=r.user)||void 0===e?void 0:e.businessId)||localStorage.getItem("businessId");if(!s)return void x("Business ID not found. Please login again.");k({...r.user,businessId:s})}catch(r){console.error("Error fetching user details:",r),x("Failed to fetch user details")}})()},[I]),(0,t.useEffect)(()=>{const e=async function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(I)if(p(!0),x(null),null!==S&&void 0!==S&&S.businessId)try{console.log("Fetching virtual numbers for business:",S.businessId);const e=await(0,c.H2)("/numbers/assigned-to/".concat(S.businessId),"GET",null,{headers:{Authorization:"Bearer ".concat(I),"Content-Type":"application/json"}});if(!e)throw new Error("No data received from API");console.log("Virtual numbers fetched:",e),console.log("Response data type:",typeof e),"object"===typeof e.data&&console.log("Response data keys:",Object.keys(e.data));let r=[];if(Array.isArray(e)?(console.log("Response is already an array"),r=e.filter(e=>"assigned"===e.status)):"object"===typeof e?Array.isArray(e.data)?(console.log("Using response.data array"),r=e.data.filter(e=>"assigned"===e.status)):Array.isArray(e.numbers)?(console.log("Using response.numbers array"),r=e.numbers.filter(e=>"assigned"===e.status)):Array.isArray(e.results)?(console.log("Using response.results array"),r=e.results.filter(e=>"assigned"===e.status)):Array.isArray(e.items)?(console.log("Using response.items array"),r=e.items.filter(e=>"assigned"===e.status)):console.log("No array found in response, creating empty array"):console.log("Response data is not an object or array"),console.log("Final numbers array:",r),0===r.length&&"object"===typeof e&&!Array.isArray(e))if(console.log("Attempting to create array from object data"),e.number||e._id||e.extension)console.log("Treating response as a single item"),r=[e];else{const s=Object.values(e).filter(e=>e&&"object"===typeof e&&(e.number||e.extension||e._id||e.status));s.length>0&&(console.log("Created array from object values:",s),r=s)}v(r)}catch(t){console.error("Error fetching virtual numbers:",t);let n="Unknown error occurred";if(t.response){if(console.error("Error response:",t.response.status,t.response.data),403===t.response.status)return n="Access denied. Please check your authentication or contact support.",localStorage.removeItem("authToken"),void(window.location.href="/");if(401===t.response.status)return n="Authentication failed. Please log in again.",localStorage.removeItem("authToken"),void(window.location.href="/");var s;n="Server error: ".concat(t.response.status," - ").concat((null===(s=t.response.data)||void 0===s?void 0:s.message)||"Unknown server error")}else t.request?(n="No response received from server. Please check your network connection.",console.error("Error request:",t.request)):(n=t.message||"Failed to make request",console.error("Error message:",t.message));if(r<2)return console.log("Retrying API call (attempt ".concat(r+1,")...")),void setTimeout(()=>e(r+1),1500);x("Error fetching assigned numbers: ".concat(n)),v([])}finally{p(!1)}else x("Business ID not found. Please try again later.");else x("Authentication token not found. Please log in again.")};null!==S&&void 0!==S&&S.businessId&&e(0)},[I,null===S||void 0===S?void 0:S.businessId]);const L=Array.isArray(j)?j.filter(r=>{if(!r)return!1;if(e.trim()){if(!(r.number&&r.number.toString().toLowerCase().includes(e.toLowerCase())||r.extension&&r.extension.toString().toLowerCase().includes(e.toLowerCase())||r.city&&r.city.toString().toLowerCase().includes(e.toLowerCase())||r.type&&r.type.toString().toLowerCase().includes(e.toLowerCase())||Array.isArray(r.tag)&&r.tag.some(r=>r&&r.toString().toLowerCase().includes(e.toLowerCase()))))return!1}if("All Numbers"===s)return!0;const t=s.toLowerCase();return!(!r.type||r.type.toString().toLowerCase()!==t)||(!(!Array.isArray(r.tag)||!r.tag.some(e=>e&&e.toString().toLowerCase()===t))||(!("toll-free"!==t||!r.type||!r.type.toString().toLowerCase().includes("toll")&&!r.type.toString().toLowerCase().includes("free"))||(!("local"!==t||!r.type||!r.type.toString().toLowerCase().includes("local"))||!("international"!==t||!r.type||!r.type.toString().toLowerCase().includes("international")&&!r.type.toString().toLowerCase().includes("global")))))}):[],_=C*w,T=_-w,E=L.slice(T,_),P=Math.ceil(L.length/w),U=e=>{N(e)};return(0,d.jsxs)("div",{className:"contact-list-container",children:[h&&(0,d.jsx)(n.kj,{color:"success",className:"mb-4",dismissible:!0,onClose:()=>g(""),children:h}),(0,d.jsx)(n.E$,{className:"mb-4",children:(0,d.jsxs)(n.W6,{children:[(0,d.jsxs)(n.sK,{className:"mb-4 align-items-center",children:[(0,d.jsx)(n.UF,{md:6,children:(0,d.jsx)("h1",{className:"contact-list-title",children:"Virtual Numbers"})}),(0,d.jsx)(n.UF,{md:6,className:"d-flex justify-content-end",children:(0,d.jsxs)(n.Q_,{color:"primary",className:"add-contact-btn",onClick:()=>{r(""),m("All Numbers"),N(1)},children:[(0,d.jsx)(o.Ay,{icon:a.Z,className:"me-2"}),"Clear Filters"]})})]}),(0,d.jsxs)(n.sK,{className:"mb-4",children:[(0,d.jsx)(n.UF,{md:4,children:(0,d.jsxs)(n.BG,{children:[(0,d.jsx)(n.OG,{placeholder:"Search numbers...",value:e,onChange:e=>{r(e.target.value),N(1)}}),(0,d.jsx)(n.Q_,{type:"button",color:"primary",variant:"outline",children:(0,d.jsx)(o.Ay,{icon:i.B})})]})}),(0,d.jsx)(n.UF,{md:4,children:(0,d.jsxs)(n.MT,{value:s,onChange:e=>{return r=e.target.value,m(r),void N(1);var r},children:[(0,d.jsx)("option",{value:"All Numbers",children:"All Numbers"}),(0,d.jsx)("option",{value:"Toll-Free",children:"Toll-Free"}),(0,d.jsx)("option",{value:"Local",children:"Local"}),(0,d.jsx)("option",{value:"International",children:"International"})]})})]}),f&&(0,d.jsx)(n.kj,{color:"danger",className:"my-3",children:f}),(0,d.jsxs)(n._v,{hover:!0,responsive:!0,className:"contact-table",children:[(0,d.jsx)(n.wV,{children:(0,d.jsxs)(n.YI,{children:[(0,d.jsx)(n.$s,{children:"S.NO"}),(0,d.jsx)(n.$s,{children:"NUMBER"}),(0,d.jsx)(n.$s,{children:"LOCATION"}),(0,d.jsx)(n.$s,{children:"TYPE"}),(0,d.jsx)(n.$s,{children:"TAGS"}),(0,d.jsx)(n.$s,{children:"ACTIONS"})]})}),(0,d.jsx)(n.jS,{children:y?(0,d.jsx)(n.YI,{children:(0,d.jsxs)(n.cC,{colSpan:"6",className:"text-center py-5",children:[(0,d.jsx)(n.JT,{color:"primary"}),(0,d.jsx)("div",{className:"mt-3",children:"Loading virtual numbers..."})]})}):0===E.length?(0,d.jsx)(n.YI,{children:(0,d.jsx)(n.cC,{colSpan:"6",className:"text-center py-5",children:(0,d.jsxs)("div",{className:"empty-state",children:[(0,d.jsx)("div",{className:"empty-state-icon",children:(0,d.jsx)(o.Ay,{icon:l.L,size:"xl"})}),(0,d.jsx)("h4",{children:"No virtual numbers found"}),(0,d.jsx)("p",{children:"No virtual numbers are currently assigned to your account."})]})})}):E.map((e,r)=>(0,d.jsxs)(n.YI,{children:[(0,d.jsx)(n.cC,{children:(0,d.jsx)("div",{className:"contact-number",children:T+r+1})}),(0,d.jsx)(n.cC,{children:(0,d.jsxs)("div",{className:"contact-name",children:[(0,d.jsx)(o.Ay,{icon:l.L,className:"me-2"}),e.number||"-"]})}),(0,d.jsx)(n.cC,{children:(0,d.jsx)("div",{className:"contact-phone",children:e.city||"-"})}),(0,d.jsx)(n.cC,{children:(0,d.jsx)(n.$X,{color:"primary",children:e.type||(Array.isArray(e.tag)&&e.tag.length>0?e.tag[0]:"Standard")})}),(0,d.jsx)(n.cC,{children:(0,d.jsx)("div",{className:"d-flex gap-1 flex-wrap",children:Array.isArray(e.tag)&&e.tag.length>0?e.tag.map((e,r)=>(0,d.jsx)(n.$X,{color:"info",className:"text-capitalize",style:{fontSize:"0.75rem"},children:e},r)):(0,d.jsx)("span",{className:"text-muted fst-italic",children:"No tags"})})}),(0,d.jsx)(n.cC,{children:(0,d.jsx)(n.jl,{content:"Release this number",children:(0,d.jsx)(n.Q_,{color:"danger",size:"sm",variant:"ghost",onClick:()=>(async e=>{if(I)if(e){A(e),x(null);try{console.log("Releasing number via proxy API");const r=await(0,c.H2)("/numbers/".concat(e),"PUT",{status:"available"},{headers:{Authorization:"Bearer ".concat(I),"Content-Type":"application/json"}});console.log("Number released response:",r.data),v(r=>r.filter(r=>r._id!==e)),g("Virtual number has been successfully released."),setTimeout(()=>g(""),5e3)}catch(s){console.error("Error releasing number:",s);let e="Unknown error occurred";if(s.response)if(console.error("Error response:",s.response.status,s.response.data),403===s.response.status)e="Access denied. You do not have permission to release this number.";else{if(401===s.response.status)return e="Authentication failed. Please log in again.",localStorage.removeItem("authToken"),void(window.location.href="/");var r;e="Server error: ".concat(s.response.status," - ").concat((null===(r=s.response.data)||void 0===r?void 0:r.message)||"Unknown server error")}else s.request?(e="No response received from server. Please check your network connection.",console.error("Error request:",s.request)):(e=s.message||"Failed to make request",console.error("Error message:",s.message));x("Failed to release number: ".concat(e))}finally{A(null)}}else x("Number ID is required to release a number");else x("Authentication token not found. Please log in again.")})(e._id),disabled:b===e._id,children:b===e._id?(0,d.jsx)(n.JT,{size:"sm"}):(0,d.jsx)(o.Ay,{icon:a.Z})})})})]},e._id||"num-".concat(e.number)))})]}),P>1&&(0,d.jsxs)(n._l,{"aria-label":"Page navigation example",className:"justify-content-center mt-4",children:[(0,d.jsx)(n.Xp,{disabled:1===C,onClick:()=>U(C-1),children:"Previous"}),[...Array(P)].map((e,r)=>(0,d.jsx)(n.Xp,{active:r+1===C,onClick:()=>U(r+1),children:r+1},r)),(0,d.jsx)(n.Xp,{disabled:C===P,onClick:()=>U(C+1),children:"Next"})]})]})})]})}},50323:function(e,r,s){s.d(r,{Z:function(){return t}});const t=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M96,472a23.82,23.82,0,0,0,23.579,24H392.421A23.82,23.82,0,0,0,416,472V152H96Zm32-288H384V464H128Z' class='ci-primary'/><rect width='32' height='200' x='168' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='240' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='200' x='312' y='216' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M328,88V40c0-13.458-9.488-24-21.6-24H205.6C193.488,16,184,26.542,184,40V88H64v32H448V88ZM216,48h80V88H216Z' class='ci-primary'/>"]}}]);