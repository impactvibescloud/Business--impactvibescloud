"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[9879],{19879:function(e,s,a){a.r(s);var n=a(9950),i=a(49911),r=a(2720),t=a(4695),d=a.n(t),l=a(11031),c=a(44414);s.default=()=>{const[e,s]=(0,n.useState)({}),[a,t]=(0,n.useState)([]),[o,u]=(0,n.useState)(!0),[m,h]=(0,n.useState)({}),[v,f]=(0,n.useState)([]),x=(0,l.g)();(0,n.useEffect)(()=>{if(!x)return;(async()=>{try{var e;const a=await(0,r.H2)("/v1/user/details","GET"),n=a.user||(null===(e=a.data)||void 0===e?void 0:e.user)||a;s(n||{})}catch(a){console.error("Failed to fetch user details for Call Settings",a),s({})}})()},[x]),(0,n.useEffect)(()=>{(async()=>{if(null!==e&&void 0!==e&&e.businessId){u(!0);try{const s=await(0,r.H2)("/branch/".concat(e.businessId,"/branches"),"GET"),a=s.data||s.branches||s,n=(Array.isArray(a)?a:a.data||[]).map(e=>{var s,a,n,i;const r=(null===(s=e.user)||void 0===s?void 0:s.name)||e.branchName||(null===(a=e.manager)||void 0===a?void 0:a.name)||"Unknown",t=(null===(n=e.user)||void 0===n?void 0:n.phone)||e.phone||e.didNumber||"",d=Array.isArray(e.didNumbers)&&e.didNumbers[0]||e.didNumber||e.did||(null===(i=e.user)||void 0===i?void 0:i.didNumber)||"";return{id:e._id||e.id,name:r,phone:t,did:d,raw:e}});t(n);const i={};n.forEach(e=>i[e.id]=e.phone||""),h(i)}catch(s){console.error("Failed to fetch agents for Call Settings",s),t([])}finally{u(!1)}}})()},[null===e||void 0===e?void 0:e.businessId]);return(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:(0,c.jsx)("h1",{className:"h3",children:"Call Settings"})}),(0,c.jsx)(i.E$,{className:"mb-4",children:(0,c.jsxs)(i.W6,{children:[(0,c.jsx)("h5",{children:"Call Forward"}),(0,c.jsx)("p",{className:"text-muted",children:"Configure per-agent call forward phone numbers below."}),o?(0,c.jsx)("div",{className:"text-center py-4",children:(0,c.jsx)(i.JT,{})}):0===a.length?(0,c.jsx)("div",{className:"text-muted",children:"No agents found for your business."}):(0,c.jsxs)("div",{children:[(0,c.jsxs)(i.sK,{className:"align-items-center mb-2",children:[(0,c.jsx)(i.UF,{sm:4,className:"fw-semibold",children:"Agent"}),(0,c.jsx)(i.UF,{sm:3,className:"fw-semibold text-muted",children:"Assigned DID"}),(0,c.jsx)(i.UF,{sm:3,className:"fw-semibold",children:"Forward number"}),(0,c.jsx)(i.UF,{sm:2})]}),a.map(e=>(0,c.jsxs)(i.sK,{className:"align-items-center mb-3",children:[(0,c.jsx)(i.UF,{sm:4,className:"fw-semibold",children:e.name}),(0,c.jsx)(i.UF,{sm:3,className:"text-muted",children:(0,c.jsx)("div",{style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e.did?e.did:"\u2014"})}),(0,c.jsx)(i.UF,{sm:3,children:(0,c.jsx)(i.OG,{type:"text",value:m[e.id]||"",onChange:s=>{return a=e.id,n=s.target.value,void h(e=>({...e,[a]:n}));var a,n},placeholder:"Enter phone number"})}),(0,c.jsx)(i.UF,{sm:2,className:"text-end",children:(0,c.jsx)(i.Q_,{color:"primary",onClick:()=>(async e=>{const s=e.id,a=m&&m[s]||"";f(e=>[...e,s]);try{const n={userPhone:a};await(0,r.H2)("/branch/edit/".concat(s),"PATCH",n),d().fire({icon:"success",title:"Saved",text:"Phone for ".concat(e.name," updated.")})}catch(t){var n,i;console.error("Failed to save phone for agent",s,t),d().fire({icon:"error",title:"Error",text:(null===t||void 0===t||null===(n=t.response)||void 0===n||null===(i=n.data)||void 0===i?void 0:i.message)||"Failed to save phone"})}finally{f(e=>e.filter(e=>e!==s))}})(e),disabled:v.includes(e.id),children:v.includes(e.id)?"Saving...":"Save"})})]},e.id))]})]})})]})}}}]);