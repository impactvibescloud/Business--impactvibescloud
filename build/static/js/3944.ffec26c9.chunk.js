"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[3944],{93944:function(e,n,t){t.r(n);var s=t(9950),i=t(49911),a=t(4695),l=t.n(a),r=t(26910),o=t(2720),c=t(44414);n.default=()=>{const[e,n]=(0,s.useState)(""),[t,a]=(0,s.useState)([]),[d,u]=(0,s.useState)(!1),[m,h]=(0,s.useState)(!1),[p,x]=(0,s.useState)(""),[v,f]=(0,s.useState)(""),[j,g]=(0,s.useState)(null),[y,N]=(0,s.useState)(""),[b,w]=(0,s.useState)(""),[C,S]=(0,s.useState)([]),[A,k]=(0,s.useState)({name:"",menu:{welcome:"",options:[],repeat:""},children:[]}),[I,_]=(0,s.useState)([]),[R,T]=(0,s.useState)(!1),B=(0,s.useRef)(null),z=(0,s.useRef)(null),[E,L]=(0,s.useState)(null),[O,V]=(0,s.useState)(null),Q=localStorage.getItem("authToken"),[D,M]=(0,s.useState)(!1),[U,F]=(0,s.useState)(null),[G,$]=(0,s.useState)(!1),W=e=>["#e8fff0","#e8f7ff","#fff7e0","#f7e8ff","#ffffff"][e]||(e%2===0?"#f7f7f7":"#eef7f7"),J=(e,n)=>{if(!n||0===n.length)return e;const[t,...s]=n;return e.children&&e.children[t]?J(e.children[t],s):{name:"",menu:{welcome:"",options:[],repeat:""},children:[]}},H=(e,n,t)=>{if(!n||0===n.length)return t;const[s,...i]=n,a=(e.children||[]).map((e,n)=>n===s?H(e,i,t):e);return{...e,children:a}},P=e=>{var n,t,a;let{path:l,nodeProp:r,onChange:o,level:d=0}=e;const u=r||J(A,l),[m,h]=(0,s.useState)(u),p=(0,s.useRef)(null),[x,v]=(0,s.useState)(()=>new Set),[f,j]=(0,s.useState)(()=>new Set);(0,s.useEffect)(()=>{try{const e=document&&document.activeElement;if(p.current&&e&&p.current.contains(e))return}catch(e){}h(u)},[u]);const g=e=>{h(e)},y=e=>(e||(e=m),N.current&&(clearTimeout(N.current),N.current=null),o?o(e):((e,n)=>{k(t=>H(t,e,n))})(l,e)),N=(0,s.useRef)(null);(0,s.useEffect)(()=>()=>{N.current&&clearTimeout(N.current)},[]);const b=(e,n)=>{var t;const s=((null===(t=m.menu)||void 0===t?void 0:t.options)||[]).map((t,s)=>s===e?n:t),i={...m,menu:{...m.menu,options:s}};g(i)},w=()=>{if(l&&l.length>=0)return(e=>{k(n=>{const t=J(n,e),s={...t,children:[...t.children||[],{name:"",menu:{welcome:"",options:[],repeat:""},children:[]}]};return H(n,e,s)})})(l);const e={...m,children:[...m.children||[],{name:"",menu:{welcome:"",options:[],repeat:""},children:[]}]};g(e),y(e)},C=(Array.isArray(l)?l.length:d)||0,S=m,_=S.children||[];return(0,c.jsxs)("div",{ref:p,className:"border rounded p-2 mb-2",style:{backgroundColor:W(C)},children:[(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(i.A6,{children:"name"}),(0,c.jsx)(i.OG,{value:S.name||"",onChange:e=>g({...S,name:e.target.value}),onBlur:()=>y(),placeholder:"name (e.g. menu or SalesMenu)"})]}),(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(i.A6,{children:"menu.welcome"}),(0,c.jsx)(i.OG,{value:(null===(n=S.menu)||void 0===n?void 0:n.welcome)||"",onChange:e=>g({...S,menu:{...S.menu,welcome:e.target.value}}),onBlur:()=>y()})]}),(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(i.A6,{children:"menu.options[]"}),((null===(t=S.menu)||void 0===t?void 0:t.options)||[]).map((e,n)=>(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("div",{className:"input-group mb-1",children:[(0,c.jsx)(i.OG,{style:{maxWidth:80},value:e.key||"",placeholder:"menu.options[].key",onChange:t=>{const s={...e,key:t.target.value};b(n,s)},onBlur:()=>y()}),(0,c.jsx)(i.OG,{value:e.text||"",placeholder:"menu.options[].text",onChange:t=>b(n,{...e,text:t.target.value}),onBlur:()=>y()}),(0,c.jsxs)("select",{className:"form-control",style:{maxWidth:180,marginRight:6},value:e.destinationType||"menu",onChange:t=>b(n,{...e,destinationType:t.target.value,destination:""}),onBlur:()=>y(),children:[(0,c.jsx)("option",{value:"menu",children:"menu.options[].destination (menu)"}),(0,c.jsx)("option",{value:"did",children:"menu.options[].destination (did)"})]}),"did"===(e.destinationType||"menu")?(0,c.jsxs)("select",{className:"form-control",style:{maxWidth:220},value:e.destination||"",onChange:t=>b(n,{...e,destination:t.target.value}),onBlur:()=>y(),children:[(0,c.jsx)("option",{value:"",children:"menu.options[].destination"}),R?(0,c.jsx)("option",{disabled:!0,children:"Loading..."}):I.map(e=>(0,c.jsx)("option",{value:e.id,children:e.number},e.id))]}):(0,c.jsx)(i.OG,{value:e.destination||"",placeholder:"menu.options[].destination",onChange:t=>b(n,{...e,destination:t.target.value}),onBlur:()=>y()}),(0,c.jsx)("button",{type:"button",className:"btn btn-danger",onClick:()=>(e=>{var n;const t=((null===(n=m.menu)||void 0===n?void 0:n.options)||[]).filter((n,t)=>t!==e),s={...m,menu:{...m.menu,options:t}};g(s),y(s)})(n),children:"Remove"})]}),(0,c.jsxs)("div",{children:[(e.children||[]).map((e,t)=>{const s="opt-".concat(n,"-child-").concat(t),a=x.has(s);return(0,c.jsxs)("div",{className:"ms-3 mb-2",children:[(0,c.jsxs)("div",{className:"d-flex justify-content-between mb-1",children:[(0,c.jsx)("div",{className:"text-muted small",children:e.name||e.fileName||"Child Menu"}),(0,c.jsxs)("div",{children:[(0,c.jsx)(i.Q_,{color:"light",size:"sm",className:"me-2",onClick:()=>{v(e=>{const n=new Set(e);return n.has(s)?n.delete(s):n.add(s),n})},children:a?"Collapse":"Expand"}),(0,c.jsx)("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>((e,n)=>{var t;const s=((null===(t=m.menu)||void 0===t?void 0:t.options)||[]).map((t,s)=>{if(s!==e)return t;const i=(t.children||[]).filter((e,t)=>t!==n);return{...t,children:i}}),i={...m,menu:{...m.menu,options:s}};g(i),y(i)})(n,t),children:"Remove Child"})]})]}),a?(0,c.jsx)(P,{nodeProp:e,level:C+1,onChange:e=>((e,n,t,s)=>{k(i=>{var a;const l=J(i,e),r=((null===(a=l.menu)||void 0===a?void 0:a.options)||[]).map((e,i)=>{if(i!==n)return e;const a=(e.children||[]).map((e,n)=>n===t?s:e);return{...e,children:a}}),o={...l,menu:{...l.menu,options:r}};return H(i,e,o)})})(l,n,t,e)}):null]},t)}),(0,c.jsx)("div",{className:"mt-1",children:(0,c.jsx)(i.Q_,{color:"secondary",size:"sm",onClick:()=>(e=>{var n;const t=(null===(n=m.menu)||void 0===n?void 0:n.options)||[],s={name:"",menu:{welcome:"",options:[],repeat:""},children:[]},i=t.map((n,t)=>t===e?{...n||{},children:[...n&&n.children||[],s]}:n),a={...m,menu:{...m.menu,options:i}};g(a),y(a)})(n),children:"Add Child Menu"})})]})]},n)),(0,c.jsx)("div",{className:"mt-2",children:(0,c.jsx)(i.Q_,{color:"secondary",size:"sm",onClick:()=>(()=>{var e;const n=[...(null===(e=m.menu)||void 0===e?void 0:e.options)||[],{key:"",text:"",destination:"",destinationType:"menu"}],t={...m,menu:{...m.menu,options:n}};g(t),y(t)})(),children:"Add Option"})})]}),(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(i.A6,{children:"menu.repeat"}),(0,c.jsx)(i.OG,{value:(null===(a=S.menu)||void 0===a?void 0:a.repeat)||"",onChange:e=>g({...S,menu:{...S.menu,repeat:e.target.value}}),onBlur:()=>y()})]}),(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(i.a5,{className:"text-muted",children:"children (unattached)"}),(_||[]).map((e,n)=>{var t;if(e&&e.key&&(e.child||e.children)&&((null===(t=S.menu)||void 0===t?void 0:t.options)||[]).some(n=>n.key===e.key))return null;const s="child-".concat(n),a=f.has(s);return(0,c.jsxs)("div",{className:"ms-3 mb-2",children:[(0,c.jsxs)("div",{className:"d-flex justify-content-between mb-1",children:[(0,c.jsx)("div",{className:"text-muted small",children:e.name||e.fileName||"Child Menu"}),(0,c.jsxs)("div",{children:[(0,c.jsx)(i.Q_,{color:"light",size:"sm",className:"me-2",onClick:()=>j(e=>{const n=new Set(e);return n.has(s)?n.delete(s):n.add(s),n}),children:a?"Collapse":"Expand"}),(0,c.jsx)("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>((e,n)=>{k(t=>{const s=J(t,e),i=(s.children||[]).filter((e,t)=>t!==n),a={...s,children:i};return H(t,e,a)})})(l,n),children:"Remove Child"})]})]}),a?(0,c.jsx)(P,{path:[...l,n],level:C+1}):null]},n)}),(0,c.jsx)("div",{children:(0,c.jsx)(i.Q_,{color:"secondary",size:"sm",onClick:()=>w(),children:"Add Child Menu"})})]})]})};(0,s.useEffect)(()=>{(async()=>{try{const e=await(0,o.H2)("/v1/user/details","GET"),t=e.user||e.data||e;t&&t.businessId&&n(t.businessId)}catch(e){console.warn("Failed to fetch user details",e)}})()},[]),(0,s.useEffect)(()=>{e&&Y()},[e]),(0,s.useEffect)(()=>{if(!e)return;(async()=>{T(!0);try{const n=await(0,o.H2)("/numbers/assigned-to/".concat(e),"GET"),t=n.data||n.numbers||n||[],s=(Array.isArray(t)?t:[]).map(e=>({id:e._id||e.id,number:e.number||e}));_(s)}catch(n){console.warn("Failed to fetch DIDs",n)}finally{T(!1)}})()},[e]),(0,s.useEffect)(()=>()=>{if(E)try{window.URL.revokeObjectURL(E)}catch(e){}},[E]);const Y=async()=>{u(!0);try{const n="".concat((0,o.vo)(),"/api/ivr/tree/menu?businessId=").concat(e),t=await r.A.get(n,{headers:{Authorization:"Bearer ".concat(Q)}}),s=t&&t.data?t.data:t,i=s&&(s.tree||s);a(i?Array.isArray(i)?i:[i]:[])}catch(n){console.error("Failed to fetch IVRs",n),a([])}finally{u(!1)}};(0,s.useEffect)(()=>{if(!Z)return;if(0===Z.length)return x(""),f(""),g(null),void k({name:"",menu:{welcome:"",options:[],repeat:""},children:[]});const e=Z[0];x(e.name||""),f(e.description||"");let n=null;n=e.tree?e.tree:e.menu?{name:e.name||"",menu:e.menu,children:e.children||[]}:e;n&&k((e=>{if(!e)return e;const n=new Map;return Array.isArray(e.children)&&e.children.forEach(e=>{e&&e.child&&(e.child._id||e.child.id)?n.set(e.child._id||e.child.id,e.child):e&&(e._id||e.id)&&n.set(e._id||e.id,e)}),e.menu&&Array.isArray(e.menu.options)&&e.menu.options.forEach(e=>{e&&Array.isArray(e.children)&&e.children.forEach(e=>{const t=e&&(e._id||e.ivrId||e.id);t&&e.menu&&n.set(t,e)})}),e.menu&&Array.isArray(e.menu.options)&&(e.menu.options=e.menu.options.map(t=>t?(Array.isArray(t.children)&&(t.children=t.children.map(t=>{const s=t&&(t._id||t.ivrId||t.id);return s&&n.has(s)?n.get(s):t&&t.menu?t:{name:t.name||"",fileName:t.fileName||t.file||"",businessId:t.businessId||e.businessId||"",menu:t.menu||{welcome:"",options:[],repeat:""},children:t.children||[]}})),t):t)),e})(n))},[t]);const K=async n=>{const t=n._id||n.id;if(!t)return l().fire({icon:"error",title:"Invalid IVR"});if((await l().fire({title:"Delete IVR?",text:'Delete "'.concat(n.name||"IVR",'"?'),icon:"warning",showCancelButton:!0})).isConfirmed)try{const s=(n.name||"").toString().toLowerCase(),i=(n.fileName||"").toString().toLowerCase();if("menu"===s||i.includes("-menu")){const n="".concat((0,o.vo)(),"/api/ivr/nested/menu?businessId=").concat(e);await r.A.delete(n,{headers:{Authorization:"Bearer ".concat(Q)}})}else await(0,o.H2)("/api/ivr/".concat(t),"DELETE");l().fire({icon:"success",title:"Deleted"}),await Y()}catch(s){console.error("Delete IVR failed",s),l().fire({icon:"error",title:"Delete failed",text:(null===s||void 0===s?void 0:s.message)||"Delete failed"})}},q=async n=>{const t=n.name||n.fileName||n.file||"";if(!t)return l().fire({icon:"error",title:"No tree",text:"No tree available for this IVR."});$(!0);try{const n="".concat((0,o.vo)(),"/api/ivr/tree/").concat(encodeURIComponent(t),"?businessId=").concat(e),s=await r.A.get(n,{headers:{Authorization:"Bearer ".concat(Q)}}),i=(s.data&&(s.data.tree||s.data)&&(s.data.tree||s.data.tree||s.data),s.data&&s.data.tree?s.data.tree:s.data&&void 0===s.data.tree?s.data:null);F(i||s.data||null),M(!0)}catch(a){var s,i;console.error("Fetch tree failed",a),l().fire({icon:"error",title:"Fetch failed",text:(null===a||void 0===a||null===(s=a.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.message)||(null===a||void 0===a?void 0:a.message)||"Could not fetch tree"})}finally{$(!1)}},X=e=>{let{node:n,level:t=0}=e;if(!n)return null;const s={marginLeft:"".concat(12*t,"px"),borderLeft:0===t?"none":"1px dashed #ccc",paddingLeft:"8px"},i=n.menu||{},a=n.children||[];return(0,c.jsxs)("div",{style:{...s,backgroundColor:W(t),borderRadius:4},className:"mb-2 p-2",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("strong",{children:n.name||n.fileName||"Menu"})," ",n.fileName?(0,c.jsxs)("span",{className:"text-muted",children:["(",n.fileName,")"]}):null]}),i.welcome?(0,c.jsx)("div",{className:"text-muted",children:i.welcome}):null,i.options&&i.options.length>0&&(0,c.jsxs)("div",{className:"mt-1",children:[(0,c.jsx)("small",{className:"text-muted",children:"Options:"}),(0,c.jsx)("ul",{children:i.options.map((e,n)=>(0,c.jsxs)("li",{children:[e.key,": ",e.text," \u2192 ",e.destination]},e._id||n))})]}),i.repeat?(0,c.jsxs)("div",{className:"text-muted",children:["Repeat: ",i.repeat]}):null,i.options&&i.options.length>0&&(0,c.jsxs)("div",{className:"mt-2",children:[(0,c.jsx)("small",{className:"text-muted",children:"Option Children:"}),(0,c.jsx)("div",{children:i.options.map((e,n)=>e.children&&e.children.length>0?(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("div",{className:"text-muted",children:["On press ",(0,c.jsx)("strong",{children:e.key})," \u2192 ",e.text]}),e.children.map((e,n)=>(0,c.jsx)("div",{className:"ms-3 mb-1",children:(0,c.jsx)(X,{node:e,level:t+1})},n))]},n):null)})]}),a&&a.length>0&&(0,c.jsxs)("div",{className:"mt-2",children:[(0,c.jsx)("small",{className:"text-muted",children:"Children:"}),(0,c.jsx)("div",{children:a.map((e,n)=>e&&e.child?(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("div",{className:"text-muted",children:["On press ",(0,c.jsx)("strong",{children:e.key})," \u2192 ",e.destination]}),(0,c.jsx)(X,{node:e.child,level:t+1})]},n):(0,c.jsx)(X,{node:e,level:t+1},n))})]})]})},Z=t.filter(e=>{const n=(e.name||"").toString().toLowerCase();return"menu"===n||"main"===n||"root"===n||(!!(e.menu&&Array.isArray(e.children)&&e.children.length>0)||(!!(Array.isArray(e.children)&&e.children.length>0)||!!e.uploadedToAsterisk))}),[ee,ne]=(0,s.useState)([]),te=e=>ee.includes(e),[se,ie]=(0,s.useState)([]),ae=e=>se.includes(e),le=async(n,t)=>{const s=n._id||n.id||n.name;if(!s)return l().fire({icon:"error",title:"Invalid IVR"});const i=(n.ivrStatus||n.status||n.state||"").toString().toLowerCase(),a="boolean"===typeof t?t?"on":"off":"off"===i||"on"===i||"active"===i?"off":"on";try{ie(e=>[...e,s]);const t={action:a,name:n.name||n.fileName||n.file||"",businessId:e},i="".concat((0,o.vo)(),"/api/ivr/switch");await r.A.post(i,t,{headers:{Authorization:"Bearer ".concat(Q),"Content-Type":"application/json"}}),l().fire({icon:"success",title:"Switched ".concat(a)}),await Y()}catch(u){var c,d;console.error("Switch failed",u);const e=(null===u||void 0===u||null===(c=u.response)||void 0===c||null===(d=c.data)||void 0===d?void 0:d.message)||(null===u||void 0===u?void 0:u.message)||"Switch failed";l().fire({icon:"error",title:"Switch failed",text:e})}finally{ie(e=>e.filter(e=>e!==s))}},re=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!e)return[];const s=e._id||e.name||t||Math.random().toString(36).slice(2),a=e._id||e.id||e.name||s,d={paddingLeft:"".concat(18*n,"px")},u=[];return u.push((0,c.jsxs)(i.YI,{style:{backgroundColor:W(n)},children:[(0,c.jsx)(i.cC,{children:(0,c.jsxs)("div",{style:d,className:"d-flex align-items-center",children:[e.children&&e.children.length>0?(0,c.jsx)(i.Q_,{color:"light",size:"sm",className:"me-2",onClick:()=>{return e=s,void ne(n=>n.includes(e)?n.filter(n=>n!==e):[...n,e]);var e},children:te(s)?"\u25be":"\u25b8"}):(0,c.jsx)("span",{style:{width:34}}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{children:(0,c.jsx)("strong",{children:e.name||"Menu"})}),e.menu&&e.menu.welcome?(0,c.jsx)("div",{className:"text-muted small",children:e.menu.welcome}):null]})]})}),(0,c.jsx)(i.cC,{children:e.name||e.fileName?(0,c.jsx)(i.Q_,{color:"link",size:"sm",className:"p-0",onClick:()=>(async e=>{const n=e.name||e.fileName||e.file||"";if(!n)return l().fire({icon:"error",title:"No audio",text:"No audio file available for this IVR."});try{const e="".concat((0,o.vo)(),"/api/ivr/download/").concat(encodeURIComponent(n)),t=await r.A.get(e,{responseType:"arraybuffer",headers:{Authorization:"Bearer ".concat(Q)}}),s=t.headers&&t.headers["content-type"]?t.headers["content-type"]:"audio/wav",i=new Blob([t.data],{type:s}),a=window.URL.createObjectURL(i);window.open(a,"_blank"),setTimeout(()=>{try{window.URL.revokeObjectURL(a)}catch(e){}},6e4)}catch(s){var t;console.error("Open failed",s),l().fire({icon:"error",title:"Open failed",text:(null===s||void 0===s||null===(t=s.response)||void 0===t?void 0:t.data)||(null===s||void 0===s?void 0:s.message)||"Could not open audio"})}})(e),children:e.name||e.fileName}):e.audio?(0,c.jsx)("a",{href:e.audio,target:"_blank",rel:"noreferrer",children:"Play"}):"-"}),(0,c.jsx)(i.cC,{style:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis"},children:e.menu&&e.menu.options&&e.menu.options.map(e=>"".concat(e.key,":").concat(e.text)).join(", ")||e.generatedText||"-"}),(0,c.jsxs)(i.cC,{children:[ae(a)&&(0,c.jsx)(i.JT,{size:"sm",className:"me-2"}),(()=>{const n="on"===(e.ivrStatus||e.status||e.state||"").toString().toLowerCase()||"active"===(e.ivrStatus||e.status||"").toString().toLowerCase();return(0,c.jsx)(i.Qb,{checked:n,className:"me-2",disabled:ae(a),onChange:n=>le(e,n.target.checked)})})()]}),(0,c.jsxs)(i.cC,{children:[(0,c.jsx)(i.Q_,{color:"secondary",size:"sm",className:"me-2",onClick:()=>q(e),children:"View Tree"}),(0,c.jsx)(i.Q_,{color:"danger",size:"sm",onClick:()=>K(e),children:"Delete"})]})]},"node-".concat(s))),te(s)&&e.children&&e.children.length>0&&e.children.forEach((e,a)=>{e&&e.child?(u.push((0,c.jsx)(i.YI,{style:{backgroundColor:W(n+1)},children:(0,c.jsx)(i.cC,{colSpan:5,children:(0,c.jsxs)("div",{style:{paddingLeft:"".concat(18*(n+1),"px")},className:"text-muted small",children:["On press ",(0,c.jsx)("strong",{children:e.key})," \u2192 ",e.destination]})})},"opt-".concat(s,"-").concat(a))),u.push(...re(e.child,n+1,"".concat(t,"/").concat(a)))):u.push(...re(e,n+1,"".concat(t,"/").concat(a)))}),u};return(0,c.jsx)("div",{className:"p-3",children:(0,c.jsx)(i.E$,{children:(0,c.jsxs)(i.W6,{children:[(0,c.jsxs)(i.sK,{className:"align-items-center mb-3",children:[(0,c.jsxs)(i.UF,{children:[(0,c.jsx)("h3",{children:"IVR Management"}),(0,c.jsx)("p",{className:"text-muted",children:"Create and manage IVR flows and audio prompts."})]}),(0,c.jsx)(i.UF,{className:"text-end"})]}),m&&(0,c.jsx)(i.E$,{className:"mb-4",children:(0,c.jsxs)(i.W6,{children:[(0,c.jsxs)(i.sK,{className:"align-items-center mb-3",children:[(0,c.jsx)(i.UF,{children:(0,c.jsx)("h4",{className:"mb-0",children:"New IVR"})}),(0,c.jsx)(i.UF,{className:"text-end",children:(0,c.jsx)(i.Q_,{color:"secondary",onClick:()=>h(!1),children:"Back"})})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(i.A6,{children:"name"}),(0,c.jsx)(i.OG,{value:p,onChange:e=>x(e.target.value),placeholder:"name"})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(i.A6,{children:"description"}),(0,c.jsx)(i.OG,{value:v,onChange:e=>f(e.target.value),placeholder:"description"})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(i.A6,{children:"Build Menu (visual editor)"}),(0,c.jsx)(P,{path:[]}),(0,c.jsx)(i.a5,{className:"text-muted",children:"Use the visual editor to build a nested menu tree. Top-level node name will default to the IVR name if left empty."})]}),(0,c.jsxs)("div",{className:"text-end",children:[(0,c.jsx)(i.Q_,{color:"secondary",onClick:()=>h(!1),children:"Cancel"}),(0,c.jsx)(i.Q_,{color:"primary",onClick:async()=>{if(e)try{if(A&&(A.menu&&(A.menu.welcome||A.menu.options&&A.menu.options.length>0||A.menu.repeat)||A.children&&A.children.length>0)){const n={...A};n.name||(n.name=p||"menu");const t="".concat((0,o.vo)(),"/api/ivr/create-nested");await r.A.post(t,{businessId:e,tree:n},{headers:{Authorization:"Bearer ".concat(Q),"Content-Type":"application/json"}})}else if(j){const n=new FormData;n.append("name",p),n.append("description",v),n.append("businessId",e),n.append("audio",j);const t="".concat((0,o.vo)(),"/api/ivr");await r.A.post(t,n,{headers:{Authorization:"Bearer ".concat(Q),"Content-Type":"multipart/form-data"}})}else{const n="".concat((0,o.vo)(),"/api/ivr");await r.A.post(n,{name:p,description:v,businessId:e},{headers:{Authorization:"Bearer ".concat(Q),"Content-Type":"application/json"}})}l().fire({icon:"success",title:"IVR Created"}),h(!1),x(""),f(""),g(null),N(""),w(""),S([]),k({name:"",menu:{welcome:"",options:[],repeat:""},children:[]}),B.current&&(B.current.value=""),await Y()}catch(s){var n,t;console.error("Create IVR failed",s);const e=(null===s||void 0===s||null===(n=s.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||s.message||"Create failed";l().fire({icon:"error",title:"Create failed",text:e})}else l().fire({icon:"warning",title:"Missing fields",text:"Business ID not available."})},className:"ms-2",children:"Create"})]})]})}),(0,c.jsxs)("div",{className:"mt-4",children:[(0,c.jsx)("h5",{children:"IVR Settings"}),d?(0,c.jsx)("div",{className:"py-3 text-center",children:(0,c.jsx)(i.JT,{})}):Z.length<=1?(()=>{const n=Z[0],t=n&&(n._id||n.id||n.name),s=!(!n||"on"!==(n.ivrStatus||n.status||n.state||"").toString().toLowerCase()&&"active"!==(n.ivrStatus||n.status||"").toString().toLowerCase());return(0,c.jsx)(i.E$,{children:(0,c.jsxs)(i.W6,{children:[(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(i.A6,{children:"Build Menu (visual editor)"}),(0,c.jsx)(P,{path:[]}),(0,c.jsx)(i.a5,{className:"text-muted",children:"Use the visual editor to build a nested menu tree."})]}),n&&(0,c.jsxs)("div",{className:"mb-3 d-flex align-items-center",children:[(0,c.jsx)("strong",{className:"me-2",children:"Status:"}),ae(t)&&(0,c.jsx)(i.JT,{size:"sm",className:"me-2"}),(0,c.jsx)(i.Qb,{checked:s,className:"me-2",disabled:ae(t),onChange:e=>le(n,e.target.checked)})]}),(0,c.jsxs)("div",{className:"text-end",children:[n&&(0,c.jsx)(i.Q_,{color:"secondary",size:"sm",className:"me-2",onClick:()=>q(n),children:"View Tree"}),n&&(0,c.jsx)(i.Q_,{color:"danger",size:"sm",className:"me-2",onClick:()=>K(n),children:"Delete"}),(0,c.jsx)(i.Q_,{color:"primary",onClick:()=>(async n=>{if(!e)return l().fire({icon:"warning",title:"Missing business",text:"Business ID not available"});try{if(A&&(A.menu&&(A.menu.welcome||A.menu.options&&A.menu.options.length>0||A.menu.repeat)||A.children&&A.children.length>0)){const n={...A};n.name||(n.name=p||"menu");const t="".concat((0,o.vo)(),"/api/ivr/create-nested");await r.A.post(t,{businessId:e,tree:n},{headers:{Authorization:"Bearer ".concat(Q),"Content-Type":"application/json"}})}else if(j){const n=new FormData;n.append("name",p),n.append("description",v),n.append("businessId",e),n.append("audio",j);const t="".concat((0,o.vo)(),"/api/ivr");await r.A.post(t,n,{headers:{Authorization:"Bearer ".concat(Q),"Content-Type":"multipart/form-data"}})}else{const n="".concat((0,o.vo)(),"/api/ivr");await r.A.post(n,{name:p,description:v,businessId:e},{headers:{Authorization:"Bearer ".concat(Q),"Content-Type":"application/json"}})}l().fire({icon:"success",title:n?"Saved":"Created"}),B.current&&(B.current.value=""),g(null),await Y()}catch(i){var t,s;console.error("Save failed",i);const e=(null===i||void 0===i||null===(t=i.response)||void 0===t||null===(s=t.data)||void 0===s?void 0:s.message)||(null===i||void 0===i?void 0:i.message)||"Save failed";l().fire({icon:"error",title:"Save failed",text:e})}})(n),children:n?"Save":"Create"})]})]})})})():(0,c.jsx)("div",{className:"table-responsive",children:(0,c.jsxs)(i._v,{children:[(0,c.jsx)(i.wV,{children:(0,c.jsxs)(i.YI,{children:[(0,c.jsx)(i.$s,{children:"Name"}),(0,c.jsx)(i.$s,{children:"File"}),(0,c.jsx)(i.$s,{children:"Generated Text"}),(0,c.jsx)(i.$s,{children:"Status"}),(0,c.jsx)(i.$s,{children:"Actions"})]})}),(0,c.jsx)(i.jS,{children:Z.reduce((e,n,t)=>e.concat(re(n,0,String(t))),[])})]})}),E&&(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsx)("h6",{children:"Now playing"}),(0,c.jsx)("audio",{ref:z,controls:!0,style:{width:"100%"}})]}),(0,c.jsxs)(i.zS,{visible:D,onClose:()=>{M(!1),F(null)},children:[(0,c.jsx)(i.E4,{closeButton:!0,children:(0,c.jsx)(i.lb,{children:"IVR Tree"})}),(0,c.jsx)(i.Tc,{children:G?(0,c.jsx)("div",{className:"text-center py-3",children:(0,c.jsx)(i.JT,{})}):U?(0,c.jsx)("div",{children:(0,c.jsx)(X,{node:U})}):(0,c.jsx)("div",{className:"text-muted",children:"No tree data available."})}),(0,c.jsx)(i.If,{children:(0,c.jsx)(i.Q_,{color:"secondary",onClick:()=>{M(!1),F(null)},children:"Close"})})]})]})]})})})}}}]);