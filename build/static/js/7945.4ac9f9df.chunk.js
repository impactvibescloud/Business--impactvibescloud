"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[7945],{10185:function(e,s,n){n.d(s,{B:function(){return a}});const a=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"]},71293:function(e,s,n){n.d(s,{x:function(){return a}});const a=["512 512","<polygon fill='var(--ci-primary-color, currentColor)' points='440 240 272 240 272 72 240 72 240 240 72 240 72 272 240 272 240 440 272 440 272 272 440 272 440 240' class='ci-primary'/>"]},77945:function(e,s,n){n.r(s),n.d(s,{default:function(){return x}});var a=n(9950),r=n(49911),i=n(81949),t=n(71293),l=n(10185),d=n(27760),o=n(26910),c=n(2720),m=n(4695),u=n.n(m),h=n(44414);var x=()=>{const[e,s]=(0,a.useState)([]),[n,m]=(0,a.useState)(!0),[x,v]=(0,a.useState)(""),[g,j]=(0,a.useState)(1),[p]=(0,a.useState)(10),[b,N]=(0,a.useState)(!1),[f,y]=(0,a.useState)(!1),[A,S]=(0,a.useState)(""),[C,_]=(0,a.useState)(""),[T,w]=(0,a.useState)(""),[I,E]=(0,a.useState)(""),[M,D]=(0,a.useState)(""),[U,F]=(0,a.useState)(""),P={morning:{startTime:"09:00",endTime:"12:00"},afternoon:{startTime:"12:00",endTime:"18:00"},full:{startTime:"09:00",endTime:"18:00"},night:{startTime:"18:00",endTime:"00:00"}},k=e=>{E(e);const s=P[e];s?(D(s.startTime),F(s.endTime)):(D(""),F(""))},[G,B]=(0,a.useState)(""),[L,H]=(0,a.useState)("Active"),[q,O]=(0,a.useState)(null),[z,Q]=(0,a.useState)({}),[K,$]=(0,a.useState)([]),R=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const n=new Set;return e.forEach(e=>{s&&e._id===s||(Array.isArray(e.didNumbers)?e.didNumbers.forEach(e=>n.add(e)):e.didNumber&&n.add(e.didNumber))}),K.filter(a=>{if(s){const n=e.find(e=>e._id===s),r=n&&(Array.isArray(n.didNumbers)?n.didNumbers[0]:n.didNumber);if(a.id===Y||a.number===r)return!0}return!n.has(a.number)})},[Y,X]=(0,a.useState)(""),[J,Z]=(0,a.useState)([]),[W,V]=(0,a.useState)({show:!1,message:""}),[ee,se]=(0,a.useState)(!1),[ne,ae]=(0,a.useState)(0),re=(0,a.useRef)(null),[ie,te]=(0,a.useState)(""),[le,de]=(0,a.useState)(null),[oe,ce]=(0,a.useState)({}),[me,ue]=(0,a.useState)({}),he=localStorage.getItem("authToken");(0,a.useEffect)(()=>{he&&(0,c.H2)("/v1/user/details","GET").then(e=>{var s,n,a;Q(e.user||(null===(s=e.data)||void 0===s?void 0:s.user)||(null===(n=e.user)||void 0===n?void 0:n.user)||(null===(a=e.user)||void 0===a?void 0:a.data)||e.data)}).catch(e=>{console.error("Failed to fetch user details:",e)})},[he]);(0,a.useEffect)(()=>{null!==z&&void 0!==z&&z.businessId&&(xe(),ve(),(async()=>{try{var e;const s=await(0,c.H2)("/departments/business/".concat(z.businessId),"GET");console.log("Departments API Response:",s);const n=(s.departments||s.data||(null===(e=s.data)||void 0===e?void 0:e.departments)||[]).map(e=>"object"===typeof e?{_id:e._id||e.id,name:e.name||"Unnamed Department",status:e.status}:{_id:e,name:String(e)});console.log("Processed Departments:",n),Z(n)}catch(s){console.error("Error fetching departments:",s)}})())},[null===z||void 0===z?void 0:z.businessId]);const xe=async()=>{try{const e=await(0,c.H2)("/branch/".concat(z.businessId,"/branches"),"GET"),n=(e.data||e.branches||[]).map(e=>{var s,n,a,r;return{...e,manager:{name:(null===(s=e.user)||void 0===s?void 0:s.name)||"",email:(null===(n=e.user)||void 0===n?void 0:n.email)||"",userId:(null===(a=e.user)||void 0===a?void 0:a._id)||""},department:function(){const s=e.department||e.deparment||e.dept;return s?"object"===typeof s?{_id:s._id||s.id||s.departmentId||null,name:s.name||s.departmentName||s.label||""}:{_id:String(s),name:String(s)}:null}(),id:e._id,didNumber:(null===(r=e.didNumbers)||void 0===r?void 0:r[0])||""}});s(n),m(!1)}catch(a){var e,n;console.error("Error fetching branches:",a),m(!1),u().fire({icon:"error",title:"Error",text:(null===a||void 0===a||null===(e=a.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||"Failed to fetch agents"})}},ve=async()=>{try{const e=await(0,c.H2)("/numbers/assigned-to/".concat(z.businessId),"GET"),s=e.data||e.numbers||e||[];$(s.map(e=>({id:e._id,number:e.number})))}catch(e){console.error("Error fetching DID numbers:",e)}},ge=()=>{N(!0)},je=()=>{N(!1),Ce()},pe=e.filter(e=>{var s,n,a,r,i;return(null===(s=e.branchName)||void 0===s?void 0:s.toLowerCase().includes(x.toLowerCase()))||(null===(n=e.manager)||void 0===n||null===(a=n.name)||void 0===a?void 0:a.toLowerCase().includes(x.toLowerCase()))||(null===(r=e.manager)||void 0===r||null===(i=r.email)||void 0===i?void 0:i.toLowerCase().includes(x.toLowerCase()))}),be=g*p,Ne=be-p,fe=pe.slice(Ne,be),ye=Math.ceil(pe.length/p),Ae=e=>{j(e)},Se=()=>{y(!1),O(null),Ce()},Ce=()=>{S(""),_(""),w(""),E(""),D(""),F(""),B(""),H("Active"),X("")},_e=async e=>{if(null===z||void 0===z||!z.businessId)return void u().fire({icon:"error",title:"Missing Business",text:"Business ID not found. Please login again."});const s=new FormData;s.append("file",e),s.append("businessId",z.businessId),se(!0),ae(0),te("");try{var n,a;const e="".concat((0,c.vo)(),"/api/branch/upload"),r=await o.A.post(e,s,{headers:{Authorization:"Bearer ".concat(he),"Content-Type":"multipart/form-data"},onUploadProgress:e=>{if(e.total){const s=Math.round(100*e.loaded/e.total);ae(s)}}});console.log("Bulk upload response:",r.data),te((null===(n=r.data)||void 0===n?void 0:n.message)||"Upload successful"),u().fire({icon:"success",title:"Upload Complete",text:(null===(a=r.data)||void 0===a?void 0:a.message)||"Branches uploaded successfully."}),xe()}catch(t){var r,i;console.error("Bulk upload error:",t);const e=(null===t||void 0===t||null===(r=t.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.message)||t.message||"Upload failed";te(e),u().fire({icon:"error",title:"Upload Failed",text:e})}finally{se(!1),ae(0)}},Te=e=>{const s=le===e._id?null:e._id;if(de(s),s){var n;const s=(null===(n=e.manager)||void 0===n?void 0:n.userId)||e.userId||e.managerId||e._id;oe[s]||(async e=>{var s;const n=(null===(s=e.manager)||void 0===s?void 0:s.userId)||e.userId||e.managerId||e._id;try{var a;if(ue(e=>({...e,[n]:!0})),console.log("Using userId for state management:",n),console.log("Branch data:",e),console.log("Looking for user ID in branch:",{"manager?.userId":null===(a=e.manager)||void 0===a?void 0:a.userId,"branch.userId":e.userId,"branch.managerId":e.managerId,"fallback to branch._id":e._id,"selected userId":n}),!n)return console.error("No user ID found for this branch:",e),void ue(e=>({...e,[n]:!1}));console.log("Fetching call details for user ID: ".concat(n));const s=await(0,c.H2)("/call-uses/user/".concat(n),"GET");console.log("API URL being called: /api/call-uses/user/"+n),console.log("Call details response:",s.data),console.log("Response structure:",JSON.stringify(s.data,null,2));let r={};s&&s.callUses&&s.callUses.length>0?(r=s.callUses[0],console.log("Found call data in callUses array:",r)):s&&s.data?(r=s.data,console.log("Using nested data property")):(r=s,console.log("Using response data directly")),ce(e=>({...e,[n]:r}))}catch(r){console.error("Error fetching call details:",r),console.error("Error details:",r.response?r.response.data:"No response data")}finally{ue(e=>({...e,[n]:!1}))}})(e)}};return(0,h.jsxs)("div",{className:"branches-container",children:[W.show&&(0,h.jsx)(r.kj,{color:"success",dismissible:!0,onClose:()=>V({show:!1,message:""}),children:W.message}),(0,h.jsx)(r.E$,{className:"mb-4",children:(0,h.jsxs)(r.W6,{children:[(0,h.jsxs)(r.sK,{className:"mb-4 align-items-center",children:[(0,h.jsx)(r.UF,{md:6,children:(0,h.jsx)("h1",{className:"branches-title",children:"Agents"})}),(0,h.jsx)(r.UF,{md:6,className:"d-flex justify-content-end",children:(0,h.jsxs)("div",{className:"d-flex gap-2",children:[(0,h.jsx)(r.Q_,{color:"secondary",className:"add-agent-btn",onClick:()=>re.current&&re.current.click(),children:"Bulk Upload"}),(0,h.jsx)("input",{ref:re,type:"file",accept:".xlsx,.xls,.csv",style:{display:"none"},onChange:e=>(async e=>{const s=e.target.files&&e.target.files[0];s&&(e.target.value="",await _e(s))})(e)}),(0,h.jsxs)(r.Q_,{color:"primary",className:"add-agent-btn",onClick:ge,children:[(0,h.jsx)(i.Ay,{icon:t.x,className:"me-2"}),"Add Agent"]})]})})]}),(0,h.jsx)(r.sK,{className:"mb-4",children:(0,h.jsx)(r.UF,{md:6,children:(0,h.jsxs)(r.BG,{children:[(0,h.jsx)(r.OG,{placeholder:"Search agents...",value:x,onChange:e=>v(e.target.value)}),(0,h.jsx)(r.Q_,{type:"button",color:"primary",variant:"outline",children:(0,h.jsx)(i.Ay,{icon:l.B})})]})})}),(0,h.jsxs)(r._v,{hover:!0,responsive:!0,className:"branches-table",children:[(0,h.jsx)(r.wV,{children:(0,h.jsxs)(r.YI,{children:[(0,h.jsx)(r.$s,{children:"S.NO"}),(0,h.jsx)(r.$s,{children:"AGENT NAME"}),(0,h.jsx)(r.$s,{children:"EMAIL ADDRESS"}),(0,h.jsx)(r.$s,{children:"DEPARTMENT"}),(0,h.jsx)(r.$s,{children:"STATUS"}),(0,h.jsx)(r.$s,{children:"ASSIGNED NUMBER"}),(0,h.jsx)(r.$s,{className:"text-center",children:"ACTIONS"})]})}),(0,h.jsx)(r.jS,{children:n?(0,h.jsx)(r.YI,{children:(0,h.jsxs)(r.cC,{colSpan:"8",className:"text-center py-5",children:[(0,h.jsx)(r.JT,{color:"primary"}),(0,h.jsx)("div",{className:"mt-3",children:"Loading agents..."})]})}):0===fe.length?(0,h.jsx)(r.YI,{children:(0,h.jsx)(r.cC,{colSpan:"8",className:"text-center py-5",children:(0,h.jsxs)("div",{className:"empty-state",children:[(0,h.jsx)("div",{className:"empty-state-icon",children:(0,h.jsx)(i.Ay,{icon:t.x,size:"xl"})}),(0,h.jsx)("h4",{children:"No agents found"}),(0,h.jsx)("p",{children:"Create your first agent to get started."}),(0,h.jsx)(r.Q_,{color:"primary",className:"mt-3",onClick:ge,children:"Add Agent"})]})})}):fe.map((e,s)=>{var n;return(0,h.jsxs)(a.Fragment,{children:[(0,h.jsxs)(r.YI,{onClick:()=>Te(e),style:{cursor:"pointer"},children:[(0,h.jsx)(r.cC,{children:(0,h.jsx)("div",{className:"agent-number",children:Ne+s+1})}),(0,h.jsx)(r.cC,{children:(0,h.jsx)("div",{className:"agent-name",children:e.branchName})}),(0,h.jsx)(r.cC,{children:(0,h.jsx)("div",{className:"manager-email",children:(null===(n=e.manager)||void 0===n?void 0:n.email)||"-"})}),(0,h.jsx)(r.cC,{children:(0,h.jsx)("div",{className:"department-name",children:e.department?"object"===typeof e.department?e.department.name||"No Name":String(e.department):"Not Assigned"})}),(0,h.jsx)(r.cC,{children:(0,h.jsx)(r.$X,{color:e.isSuspended?"warning":"success",className:"status-badge",children:e.isSuspended?"Suspended":"Active"})}),(0,h.jsx)(r.cC,{children:(0,h.jsx)("div",{className:"assigned-number",children:Array.isArray(e.didNumbers)&&e.didNumbers.length>0?e.didNumbers[0]:"Not Assigned"})}),(0,h.jsxs)(r.cC,{className:"text-center",children:[(0,h.jsx)(r.Q_,{color:"light",onClick:s=>{s.stopPropagation(),(e=>{var s,n,a;O(e),S(e.branchName||""),B((null===(s=e.user)||void 0===s?void 0:s.email)||(null===(n=e.manager)||void 0===n?void 0:n.email)||""),w((null===(a=e.department)||void 0===a?void 0:a._id)||"");const r=e.timeGroup;if(r&&"object"===typeof r)E(r.timeGroup||""),D(r.startTime||""),F(r.endTime||"");else if(E(r||""),r&&"string"===typeof r&&P[r]){const e=P[r];D(e.startTime||""),F(e.endTime||"")}else D(""),F("");H(e.isSuspended?"Suspended":"Active");let i="";if(Array.isArray(e.didNumbers)&&e.didNumbers.length>0){const s=e.didNumbers[0],n=K.find(e=>e.number===s);i=n?n.id:""}else if(e.didNumber){const s=K.find(s=>s.number===e.didNumber);i=s?s.id:""}X(i),y(!0)})(e)},className:"me-2",size:"sm",children:(0,h.jsx)(i.Ay,{icon:d.K})}),(0,h.jsx)(r.Q_,{color:e.isSuspended?"success":"warning",onClick:s=>{s.stopPropagation(),(async e=>{try{await o.A.patch("/api/branch/".concat(e,"/status"),{},{headers:{Authorization:"Bearer ".concat(he)}}),xe(),u().fire({icon:"success",title:"Agent status updated successfully"})}catch(a){var s,n;console.error("Error suspending branch:",a),u().fire({icon:"error",title:"Error",text:(null===a||void 0===a||null===(s=a.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"Something went wrong"})}})(e.id)},className:"me-2",size:"sm",children:e.isSuspended?"Activate":"Suspend"}),(0,h.jsx)(r.Q_,{color:"info",onClick:s=>{s.stopPropagation(),(async e=>{try{u().fire({title:"Are you sure?",text:"This will reset the manager's password. They will receive an email with instructions.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, reset it!"}).then(async s=>{s.isConfirmed&&(await o.A.post("/api/v1/user/password/forgot",{email:e},{headers:{Authorization:"Bearer ".concat(he)}}),u().fire({icon:"success",title:"Password Reset",text:"Password has been reset successfully. An email has been sent to the manager."}))})}catch(a){var s,n;console.error("Error resetting password:",a),u().fire({icon:"error",title:"Error",text:(null===a||void 0===a||null===(s=a.response)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.message)||"Something went wrong"})}})(e.manager.email)},size:"sm",children:"Reset"})]})]}),le===e._id&&(0,h.jsx)(r.YI,{children:(0,h.jsx)(r.cC,{colSpan:"8",style:{padding:0,backgroundColor:"#f8f9fa"},children:(0,h.jsxs)("div",{style:{padding:"20px"},children:[(0,h.jsx)(r.sK,{className:"mb-4",children:(0,h.jsx)(r.UF,{children:(0,h.jsxs)("h5",{className:"mb-3",children:["Agent Details - ",e.branchName]})})}),(0,h.jsx)(r.sK,{className:"mb-4",children:(0,h.jsxs)(r.UF,{children:[(0,h.jsx)("h6",{className:"mb-3",children:"Call Details"}),((s,n,a,i,t)=>{const l=(null===(s=e.manager)||void 0===s?void 0:s.userId)||e.userId||e.managerId||e._id;return me[l]?(0,h.jsxs)("div",{className:"text-center py-4",children:[(0,h.jsx)(r.JT,{color:"primary"}),(0,h.jsx)("div",{className:"mt-2",children:"Loading call details..."})]}):(0,h.jsxs)(r.sK,{children:[(0,h.jsx)(r.UF,{md:3,children:(0,h.jsxs)("div",{className:"text-center p-3 border rounded bg-white",children:[(0,h.jsx)("h4",{className:"text-primary mb-1",children:(null===(n=oe[l])||void 0===n?void 0:n.outboundCalls)||0}),(0,h.jsx)("small",{className:"text-muted",children:"Outbound Calls"})]})}),(0,h.jsx)(r.UF,{md:3,children:(0,h.jsxs)("div",{className:"text-center p-3 border rounded bg-white",children:[(0,h.jsx)("h4",{className:"text-success mb-1",children:(null===(a=oe[l])||void 0===a?void 0:a.inboundCalls)||0}),(0,h.jsx)("small",{className:"text-muted",children:"Inbound Calls"})]})}),(0,h.jsx)(r.UF,{md:3,children:(0,h.jsxs)("div",{className:"text-center p-3 border rounded bg-white",children:[(0,h.jsx)("h4",{className:"text-warning mb-1",children:(null===(i=oe[l])||void 0===i?void 0:i.missedCalls)||0}),(0,h.jsx)("small",{className:"text-muted",children:"Missed Calls"})]})}),(0,h.jsx)(r.UF,{md:3,children:(0,h.jsxs)("div",{className:"text-center p-3 border rounded bg-white",children:[(0,h.jsx)("h4",{className:"text-danger mb-1",children:(null===(t=oe[l])||void 0===t?void 0:t.hangCalls)||0}),(0,h.jsx)("small",{className:"text-muted",children:"Hang Calls"})]})})]})})()]})}),(0,h.jsx)(r.sK,{className:"mb-4",children:(0,h.jsxs)(r.UF,{children:[(0,h.jsx)("h6",{className:"mb-3",children:"Working Hours"}),(0,h.jsx)("div",{className:"p-3 border rounded bg-white",children:(0,h.jsxs)(r.sK,{children:[(0,h.jsxs)(r.UF,{md:6,children:[(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Start Time:"})," 9:00 AM"]}),(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"End Time:"})," 6:00 PM"]})]}),(0,h.jsxs)(r.UF,{md:6,children:[(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Break Time:"})," 1:00 PM - 2:00 PM"]}),(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Total Hours:"})," 8 hours"]})]})]})})]})}),(0,h.jsx)(r.sK,{children:(0,h.jsxs)(r.UF,{children:[(0,h.jsx)("h6",{className:"mb-3",children:"Active Hours (Today)"}),(0,h.jsx)("div",{className:"p-3 border rounded bg-white",children:(0,h.jsxs)(r.sK,{children:[(0,h.jsxs)(r.UF,{md:4,children:[(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Login Time:"})," 9:15 AM"]}),(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Total Active Time:"})," 6h 45m"]})]}),(0,h.jsxs)(r.UF,{md:4,children:[(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Break Duration:"})," 1h 15m"]}),(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Idle Time:"})," 30m"]})]}),(0,h.jsxs)(r.UF,{md:4,children:[(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Current Status:"}),(0,h.jsx)(r.$X,{color:"success",className:"ms-2",children:"Online"})]}),(0,h.jsxs)("div",{className:"mb-2",children:[(0,h.jsx)("strong",{children:"Last Activity:"})," 2 minutes ago"]})]})]})})]})})]})})})]},e._id)})})]}),ye>1&&(0,h.jsxs)(r._l,{"aria-label":"Page navigation example",className:"justify-content-center mt-4",children:[(0,h.jsx)(r.Xp,{disabled:1===g,onClick:()=>Ae(g-1),children:"Previous"}),[...Array(ye)].map((e,s)=>(0,h.jsx)(r.Xp,{active:s+1===g,onClick:()=>Ae(s+1),children:s+1},s)),(0,h.jsx)(r.Xp,{disabled:g===ye,onClick:()=>Ae(g+1),children:"Next"})]})]})}),(0,h.jsxs)(r.zS,{visible:b,onClose:je,size:"lg",children:[(0,h.jsx)(r.E4,{children:(0,h.jsx)(r.lb,{children:"Add New Agent"})}),(0,h.jsx)(r.Tc,{children:(0,h.jsxs)(r.qI,{children:[(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"agentName",children:"Agent Name"}),(0,h.jsx)(r.OG,{type:"text",id:"agentName",value:A,onChange:e=>S(e.target.value),placeholder:"Enter agent name",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"agentPhone",children:"Agent Phone Number"}),(0,h.jsx)(r.OG,{type:"text",id:"agentPhone",value:C,onChange:e=>_(e.target.value),placeholder:"Enter agent phone number",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"managerEmail",children:"Email Address"}),(0,h.jsx)(r.OG,{type:"email",id:"managerEmail",value:G,onChange:e=>B(e.target.value),placeholder:"Enter email address",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"department",children:"Department"}),(0,h.jsxs)(r.MT,{id:"department",value:T,onChange:e=>w(e.target.value),required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select Department"}),0===J.length?(0,h.jsx)("option",{value:"",disabled:!0,children:"Loading departments..."}):J.map(e=>(0,h.jsx)("option",{value:e._id||e.id,children:"object"===typeof e?e.name||"Unnamed Department":String(e)},e._id))]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"timeGroup",children:"Shift"}),(0,h.jsxs)(r.MT,{id:"timeGroup",value:I,onChange:e=>k(e.target.value),required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select Shift"}),(0,h.jsx)("option",{value:"morning",children:"Morning Shift (9 AM - 12 PM)"}),(0,h.jsx)("option",{value:"afternoon",children:"Afternoon Shift (12 PM - 6 PM)"}),(0,h.jsx)("option",{value:"full",children:"Full Shift (9 AM - 6 PM)"}),(0,h.jsx)("option",{value:"night",children:"Night Shift (6 PM - 12 AM)"}),(0,h.jsx)("option",{value:"custom",children:"Custom Shift"})]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"assignDid",children:"Assign DID"}),(0,h.jsxs)(r.MT,{id:"assignDid",value:Y,onChange:e=>X(e.target.value),required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select DID Number"}),R().map(e=>(0,h.jsx)("option",{value:e.id,children:e.number},e.id))]})]})]})}),(0,h.jsxs)(r.If,{children:[(0,h.jsx)(r.Q_,{color:"secondary",onClick:je,children:"Cancel"}),(0,h.jsx)(r.Q_,{color:"primary",onClick:async()=>{try{var e,s;let r=Y;const i=K.find(e=>e.id===Y);i&&(r=i.number);const l={branchName:A,branchEmail:G,phone:C,businessId:z.businessId,didNumbers:r?[r]:[],timeGroup:I};M&&""!==M.trim()&&(l.startTime=M),U&&""!==U.trim()&&(l.endTime=U),T&&(l.department=T);const d=await(0,c.H2)("/branch/create/new","POST",l);if(Y&&d.data&&(null!==(e=d.data.branch)&&void 0!==e&&e._id||null!==(s=d.data.data)&&void 0!==s&&s._id)){var n,a;const e=(null===(n=d.data.branch)||void 0===n?void 0:n._id)||(null===(a=d.data.data)||void 0===a?void 0:a._id),s=Y;try{await(0,c.H2)("/numbers/".concat(s),"PUT",{assigned_to_branch:e})}catch(t){console.error("Error assigning DID to branch:",t)}}xe(),je(),V({show:!0,message:'Agent "'.concat(A,'" added successfully!')}),setTimeout(()=>{V({show:!1,message:""})},5e3)}catch(l){var r,i;console.error("Error adding branch:",l),u().fire({title:"Error",text:(null===l||void 0===l||null===(r=l.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.message)||"Something went wrong",icon:"error"})}},children:"Save Agent"})]})]}),(0,h.jsxs)(r.zS,{visible:f,onClose:Se,size:"lg",children:[(0,h.jsx)(r.E4,{children:(0,h.jsx)(r.lb,{children:"Edit Agent"})}),(0,h.jsx)(r.Tc,{children:(0,h.jsxs)(r.qI,{children:[(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"editAgentName",children:"Agent Name"}),(0,h.jsx)(r.OG,{type:"text",id:"editAgentName",value:A,onChange:e=>S(e.target.value),placeholder:"Enter agent name",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"editManagerEmail",children:"Email Address"}),(0,h.jsx)(r.OG,{type:"email",id:"editManagerEmail",value:G,onChange:e=>B(e.target.value),placeholder:"Enter email address",required:!0})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"editDepartment",children:"Department"}),(0,h.jsxs)(r.MT,{id:"editDepartment",value:T,onChange:e=>w(e.target.value),required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select Department"}),J.map(e=>(0,h.jsx)("option",{value:e._id||e.id,children:"object"===typeof e?e.name||"Unnamed Department":String(e)},e._id))]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"editTimeGroup",children:"Shift"}),(0,h.jsxs)(r.MT,{id:"editTimeGroup",value:I,onChange:e=>k(e.target.value),required:!0,children:[(0,h.jsx)("option",{value:"",children:"Select Shift"}),(0,h.jsx)("option",{value:"morning",children:"Morning Shift (9 AM - 12 PM)"}),(0,h.jsx)("option",{value:"afternoon",children:"Afternoon Shift (12 PM - 6 PM)"}),(0,h.jsx)("option",{value:"full",children:"Full Shift (9 AM - 6 PM)"}),(0,h.jsx)("option",{value:"night",children:"Night Shift (6 PM - 12 AM)"}),(0,h.jsx)("option",{value:"custom",children:"Custom Shift"})]})]}),(0,h.jsxs)("div",{className:"mb-3",children:[(0,h.jsx)(r.A6,{htmlFor:"editAssignDid",children:"Assign DID"}),(0,h.jsxs)(r.MT,{id:"editAssignDid",value:Y,onChange:e=>X(e.target.value),children:[(0,h.jsx)("option",{value:"",children:"Select DID Number"}),R(null===q||void 0===q?void 0:q._id).map(e=>(0,h.jsx)("option",{value:e.id,children:e.number},e.id))]})]})]})}),(0,h.jsxs)(r.If,{children:[(0,h.jsx)(r.Q_,{color:"secondary",onClick:Se,children:"Cancel"}),(0,h.jsx)(r.Q_,{color:"primary",onClick:async()=>{try{var e,s;let r=Y;const i=K.find(e=>e.id===Y);i&&(r=i.number);const l={branchName:A,userEmail:G,businessId:z.businessId,didNumbers:r?[r]:[],timeGroup:I,...T?{department:T}:{}};M&&""!==M.trim()&&(l.startTime=M),U&&""!==U.trim()&&(l.endTime=U);const d=await(0,c.H2)("/branch/edit/".concat(q._id),"PATCH",l);if(Y&&(q._id||d.data&&(null!==(e=d.data.branch)&&void 0!==e&&e._id||null!==(s=d.data.data)&&void 0!==s&&s._id))){var n,a;const e=q._id||(null===(n=d.data.branch)||void 0===n?void 0:n._id)||(null===(a=d.data.data)||void 0===a?void 0:a._id),s=Y;try{await(0,c.H2)("/numbers/".concat(s),"PUT",{assigned_to_branch:e})}catch(t){console.error("Error assigning DID to branch:",t)}}xe(),Se(),V({show:!0,message:'Agent "'.concat(A,'" updated successfully!')}),setTimeout(()=>{V({show:!1,message:""})},5e3)}catch(l){var r,i;u().fire({title:"Error",text:(null===l||void 0===l||null===(r=l.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.message)||"Something went wrong",icon:"error"})}},children:"Update Agent"})]})]})]})}}}]);