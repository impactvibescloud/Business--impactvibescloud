"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[2141],{62141:function(e,s,n){n.r(s),n.d(s,{default:function(){return c}});var a=n(9950),t=n(49911),i=n(2720),l=n(44414);function c(){const[e,s]=(0,a.useState)([]),[n,c]=(0,a.useState)(!0),[o,r]=(0,a.useState)(""),[d,h]=(0,a.useState)(null),[u,m]=(0,a.useState)(1),[x]=(0,a.useState)(10),[j,g]=(0,a.useState)(1),[p,v]=(0,a.useState)(0),[f,b]=(0,a.useState)(""),[C,y]=(0,a.useState)("name"),[S,_]=(0,a.useState)({name:"",email:"",phone:"",company:"",tags:[]}),[I,w]=(0,a.useState)(!1),[E,A]=(0,a.useState)(!1),[N,k]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{c(!0);try{var e;const c=localStorage.getItem("authToken");if(!c)throw new Error("Authentication required. Please login again.");const o=await fetch("/api/v1/user/details",{headers:{Authorization:"Bearer ".concat(c)}}),d=await o.json(),h=(null===d||void 0===d||null===(e=d.user)||void 0===e?void 0:e.businessId)||localStorage.getItem("businessId");if(!h)throw new Error("Business ID not found. Please login again.");const m=new URLSearchParams({page:u.toString(),limit:x.toString(),sortBy:"createdAt",order:"desc"});f&&(m.append("search",f),m.append("searchField",C));const j=await(0,i.H2)("/contacts/business/".concat(h,"?").concat(m),"GET");if(j.success&&j.data){var n,a,t,l;s(j.data);const e=null!==(n=null===(a=j.pagination)||void 0===a?void 0:a.total)&&void 0!==n?n:j.data.length,i=null!==(t=null===(l=j.pagination)||void 0===l?void 0:l.pages)&&void 0!==t?t:1;g(i),v(e)}else s([]),g(1),v(0);r("")}catch(o){r(o.message)}finally{c(!1)}})()},[u,x]);const P=()=>{_({name:"",email:"",phone:"",company:"",tags:[]}),w(!1)},T=e=>{const{name:s,value:n}=e.target;_("tags"===s?e=>({...e,tags:n.trim()?n.split(",").map(e=>e.trim()).filter(Boolean):[]}):e=>({...e,[s]:n}))};return n?(0,l.jsxs)("div",{className:"p-4 text-center",children:[(0,l.jsx)(t.JT,{})," Loading contacts..."]}):o?(0,l.jsxs)("div",{className:"p-4 text-center text-danger",children:["Error: ",o]}):(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[(0,l.jsx)("h2",{children:"Contacts"}),(0,l.jsx)(t.Q_,{color:"primary",onClick:()=>A(!0),children:"Add Contact"})]}),(0,l.jsxs)("div",{className:"d-flex gap-3 mb-3",children:[(0,l.jsx)("div",{style:{width:"200px"},children:(0,l.jsxs)("select",{className:"form-select",value:C,onChange:e=>y(e.target.value),children:[(0,l.jsx)("option",{value:"name",children:"Name"}),(0,l.jsx)("option",{value:"email",children:"Email"}),(0,l.jsx)("option",{value:"phone",children:"Phone"}),(0,l.jsx)("option",{value:"company",children:"Company"}),(0,l.jsx)("option",{value:"tags",children:"Tags"})]})}),(0,l.jsx)("div",{style:{flex:1},children:(0,l.jsx)("input",{type:"text",className:"form-control",placeholder:"Search by ".concat(C,"..."),value:f,onChange:e=>b(e.target.value)})})]}),(0,l.jsxs)(t._v,{className:"mt-3",hover:!0,children:[(0,l.jsx)(t.wV,{children:(0,l.jsxs)(t.YI,{children:[(0,l.jsx)(t.$s,{children:"Name"}),(0,l.jsx)(t.$s,{children:"Email"}),(0,l.jsx)(t.$s,{children:"Phone"}),(0,l.jsx)(t.$s,{children:"Company"}),(0,l.jsx)(t.$s,{children:"Tags"}),(0,l.jsx)(t.$s,{children:"Actions"})]})}),(0,l.jsx)(t.jS,{children:(e||[]).map(e=>(0,l.jsxs)(t.YI,{children:[(0,l.jsx)(t.cC,{children:e.name}),(0,l.jsx)(t.cC,{children:e.email}),(0,l.jsx)(t.cC,{children:e.phone}),(0,l.jsx)(t.cC,{children:e.company}),(0,l.jsx)(t.cC,{children:(e.tags||[]).join(", ")}),(0,l.jsxs)(t.cC,{children:[(0,l.jsx)(t.Q_,{size:"sm",color:"info",className:"me-2",onClick:()=>h(e),children:"View"}),(0,l.jsx)(t.Q_,{size:"sm",color:"warning",className:"me-2",onClick:()=>(_(e),w(!0),void A(!0)),children:"Edit"}),(0,l.jsx)(t.Q_,{size:"sm",color:"danger",onClick:()=>k(e),children:"Delete"})]})]},e.email))})]}),(0,l.jsxs)("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[(0,l.jsxs)("div",{children:["Showing ",e.length," of ",p," contacts"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(t.Q_,{color:"light",onClick:()=>m(e=>Math.max(e-1,1)),disabled:u<=1,className:"me-2",children:"Previous"}),(0,l.jsxs)("span",{className:"mx-2",children:["Page ",u," of ",j]}),(0,l.jsx)(t.Q_,{color:"light",onClick:()=>m(e=>Math.min(e+1,j)),disabled:u>=j,className:"ms-2",children:"Next"})]})]}),(0,l.jsxs)(t.zS,{visible:!!d,onClose:()=>h(null),children:[(0,l.jsx)(t.E4,{closeButton:!0,children:(0,l.jsx)(t.lb,{children:"Contact Details"})}),(0,l.jsx)(t.Tc,{children:d&&(0,l.jsxs)("div",{children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Name:"})," ",d.name]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Email:"})," ",d.email]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Phone:"})," ",d.phone]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Company:"})," ",d.company]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("strong",{children:"Tags:"})," ",(d.tags||[]).join(", ")]})]})}),(0,l.jsx)(t.If,{children:(0,l.jsx)(t.Q_,{color:"secondary",onClick:()=>h(null),children:"Close"})})]}),(0,l.jsxs)(t.zS,{visible:E,onClose:()=>A(!1),children:[(0,l.jsx)(t.E4,{closeButton:!0,children:(0,l.jsx)(t.lb,{children:I?"Edit Contact":"Add Contact"})}),(0,l.jsx)(t.Tc,{children:(0,l.jsxs)(t.qI,{onSubmit:async e=>{e.preventDefault();const n=I?"PUT":"POST";if(!localStorage.getItem("authToken"))return void alert("Authentication required. Please login again.");try{var a;const e=await(0,i.H2)("/v1/user/details","GET"),t=(null===e||void 0===e||null===(a=e.user)||void 0===a?void 0:a.businessId)||localStorage.getItem("businessId");if(!t)return void alert("Business ID not found. Please login again.");const l=I?"/api/contacts/business/".concat(t,"/").concat(S._id):"/api/contacts/business/".concat(t),c=await(0,i.H2)(l,n,{...S,businessId:t});s(I?e=>e.map(e=>e.email===c.email?c:e):e=>[...e,c]),A(!1),P()}catch(l){alert(l.message)}const t=I?"/api/contacts/business/".concat(businessId,"/").concat(S._id):"/api/contacts/business/".concat(businessId);(0,i.H2)(t,n,{...S,businessId:businessId}).then(e=>e).then(e=>{s(I?s=>s.map(s=>s.email===e.email?e:s):s=>[...s,e]),A(!1),P()}).catch(e=>alert(e.message))},children:[(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)(t.A6,{children:"Name"}),(0,l.jsx)(t.OG,{type:"text",name:"name",value:S.name,onChange:T,required:!0})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)(t.A6,{children:"Email"}),(0,l.jsx)(t.OG,{type:"email",name:"email",value:S.email,onChange:T,required:!0,disabled:I})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)(t.A6,{children:"Phone"}),(0,l.jsx)(t.OG,{type:"text",name:"phone",value:S.phone,onChange:T})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)(t.A6,{children:"Company"}),(0,l.jsx)(t.OG,{type:"text",name:"company",value:S.company,onChange:T})]}),(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsx)(t.A6,{children:"Tags"}),(0,l.jsx)(t.OG,{type:"text",name:"tags",placeholder:"Enter comma-separated tags",value:Array.isArray(S.tags)?S.tags.join(", "):"",onChange:T})]}),(0,l.jsx)(t.Q_,{type:"submit",color:"primary",children:I?"Update Contact":"Add Contact"})]})})]}),(0,l.jsxs)(t.zS,{visible:!!N,onClose:()=>k(null),children:[(0,l.jsx)(t.E4,{closeButton:!0,children:(0,l.jsx)(t.lb,{children:"Confirm Delete"})}),(0,l.jsxs)(t.Tc,{children:["Are you sure you want to delete ",null===N||void 0===N?void 0:N.name,"?"]}),(0,l.jsxs)(t.If,{children:[(0,l.jsx)(t.Q_,{color:"danger",onClick:()=>(async e=>{const n=localStorage.getItem("authToken");if(n){try{var a;const t=await fetch("/api/v1/user/details",{headers:{Authorization:"Bearer ".concat(n)}}),i=await t.json(),l=(null===i||void 0===i||null===(a=i.user)||void 0===a?void 0:a.businessId)||localStorage.getItem("businessId");if(!l)return void alert("Business ID not found. Please login again.");if(!(await fetch("".concat(API_BASE,"/business/").concat(l,"/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n)}})).ok)throw new Error("Delete failed");s(s=>s.filter(s=>s._id!==e)),k(null)}catch(t){alert(t.message)}fetch("".concat(API_BASE,"/business/").concat(businessId,"/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(n)}}).then(n=>{if(!n.ok)throw new Error("Delete failed");s(s=>s.filter(s=>s._id!==e)),k(null)}).catch(e=>alert(e.message))}else alert("Authentication required. Please login again.")})(N.email),children:"Delete"}),(0,l.jsx)(t.Q_,{color:"secondary",onClick:()=>k(null),children:"Cancel"})]})]})]})}}}]);