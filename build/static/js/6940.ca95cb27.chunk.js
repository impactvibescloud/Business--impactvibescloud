"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[6940],{6940:function(e,a,s){s.r(a);var t=s(9950),n=s(49911),l=s(26910),i=s(4695),r=s.n(i),d=s(2720),c=s(44414);a.default=()=>{const[e,a]=(0,t.useState)(""),[s,i]=(0,t.useState)(""),[o,u]=(0,t.useState)(""),[m,h]=(0,t.useState)([]),[p,x]=(0,t.useState)(!1),[j,b]=(0,t.useState)(""),[g,f]=(0,t.useState)(null),[v,N]=(0,t.useState)(null),[C,y]=(0,t.useState)(!1),[S,A]=(0,t.useState)(0),D=(0,t.useRef)(null),w=(0,t.useRef)(null),[F,_]=(0,t.useState)([]),[I,k]=(0,t.useState)(!1),[E,T]=(0,t.useState)(!1);(0,t.useEffect)(()=>{(async()=>{try{const e=await(0,d.H2)("/v1/user/details","GET"),a=e.user||e.data||e;a&&a.businessId&&i(a.businessId)}catch(e){console.warn("Could not fetch user details for businessId")}})()},[]),(0,t.useEffect)(()=>{(async()=>{if(s){x(!0);try{const e=await(0,d.H2)("/numbers/assigned-to/".concat(s),"GET"),a=e.data||e.numbers||e||[],t=(Array.isArray(a)?a:[]).map(e=>({id:e._id||e.id,number:e.number||e}));h(t),!o&&t.length>0&&u(t[0].number)}catch(e){console.error("Failed to fetch DID numbers",e)}finally{x(!1)}}})()},[s]),(0,t.useEffect)(()=>{s&&U()},[s]);const U=async()=>{if(s){k(!0);try{const e=await(0,d.H2)("/campaigns?businessId=".concat(s),"GET");let a=e;e&&e.data&&void 0!==e.data.data?a=e.data:e&&e.success&&void 0!==e.data&&(a=e);const t=a.data||a.campaigns||a.results||a||[];_(Array.isArray(t)?t:[])}catch(e){console.error("Failed to fetch campaigns",e)}finally{k(!1)}}},G=localStorage.getItem("authToken");return(0,c.jsxs)("div",{className:"p-3",children:[(0,c.jsx)(n.E$,{children:(0,c.jsxs)(n.W6,{children:[(0,c.jsxs)(n.sK,{className:"align-items-center mb-3",children:[(0,c.jsxs)(n.UF,{children:[(0,c.jsx)("h3",{children:"Audio Campaigns"}),(0,c.jsx)("p",{className:"text-muted",children:"Create and manage your audio campaigns here."})]}),(0,c.jsx)(n.UF,{className:"text-end",children:(0,c.jsx)(n.Q_,{color:"primary",onClick:()=>T(!0),children:"New Campaign"})})]}),(0,c.jsxs)(n.zS,{visible:E,onClose:()=>T(!1),backdrop:"static",children:[(0,c.jsx)(n.E4,{closeButton:!0,children:(0,c.jsx)(n.lb,{children:"New Audio Campaign"})}),(0,c.jsxs)(n.Tc,{children:[(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(n.A6,{htmlFor:"campaignName",children:"Campaign Name"}),(0,c.jsx)(n.OG,{id:"campaignName",value:e,onChange:e=>a(e.target.value),placeholder:"Enter audio campaign name"})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(n.A6,{htmlFor:"didNumber",children:"DID Number"}),(0,c.jsxs)(n.MT,{id:"didNumber",value:o,onChange:e=>u(e.target.value),"aria-label":"Select DID Number",children:[(0,c.jsx)("option",{value:"",children:"Select DID Number"}),p?(0,c.jsx)("option",{disabled:!0,children:"Loading..."}):m.map(e=>(0,c.jsx)("option",{value:e.number,children:e.number},e.id))]}),(0,c.jsx)(n.a5,{className:"text-muted",children:"Destination DID number for outbound calls."})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(n.A6,{htmlFor:"scheduledAt",children:"Schedule (UTC)"}),(0,c.jsx)(n.OG,{id:"scheduledAt",type:"datetime-local",value:j,onChange:e=>b(e.target.value)}),(0,c.jsx)(n.a5,{className:"text-muted",children:"Set scheduled start time for the campaign."})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(n.A6,{htmlFor:"numbersFile",children:"Contacts File (CSV/XLSX)"}),(0,c.jsx)(n.OG,{type:"file",id:"numbersFile",accept:".csv,.xls,.xlsx",onChange:e=>{var a;return f((null===(a=e.target.files)||void 0===a?void 0:a[0])||null)},ref:D})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(n.A6,{htmlFor:"audioFile",children:"Audio File (optional)"}),(0,c.jsx)(n.OG,{type:"file",id:"audioFile",accept:"audio/*",onChange:e=>{var a;return N((null===(a=e.target.files)||void 0===a?void 0:a[0])||null)},ref:w})]}),C&&(0,c.jsx)("div",{className:"mb-3",children:(0,c.jsxs)(n.fZ,{value:S,children:[S,"%"]})})]}),(0,c.jsxs)(n.If,{children:[(0,c.jsx)(n.Q_,{color:"secondary",onClick:()=>T(!1),disabled:C,children:"Cancel"}),(0,c.jsx)(n.Q_,{color:"primary",onClick:async()=>{await(async()=>{if(!e||!s||!o||!j)return void r().fire({icon:"warning",title:"Missing fields",text:"Please fill name, business, DID and schedule."});if(!g)return void r().fire({icon:"warning",title:"Missing file",text:"Please upload contacts CSV/XLSX file."});const t=new FormData;t.append("name",e),t.append("businessId",s),t.append("didNumber",o);const n=j?new Date(j).toISOString():"";t.append("scheduledAt",n),t.append("file",g),v&&t.append("audio",v),y(!0),A(0);try{var i;const e="".concat((0,d.vo)(),"/api/campaigns/upload"),s=await l.A.post(e,t,{headers:{Authorization:"Bearer ".concat(G),"Content-Type":"multipart/form-data"},onUploadProgress:e=>{e.total&&A(Math.round(100*e.loaded/e.total))}});console.log("campaign upload response",s.data),r().fire({icon:"success",title:"Campaign Created",text:(null===(i=s.data)||void 0===i?void 0:i.message)||"Campaign uploaded successfully"}),a(""),u(""),b(""),f(null),N(null),D.current&&(D.current.value=""),w.current&&(w.current.value="");try{await U()}catch(h){}return!0}catch(p){var c,m;console.error("Upload failed",p);const e=(null===p||void 0===p||null===(c=p.response)||void 0===c||null===(m=c.data)||void 0===m?void 0:m.message)||p.message||"Upload failed";return r().fire({icon:"error",title:"Upload Failed",text:e}),!1}finally{y(!1),A(0)}})()&&T(!1)},disabled:C,children:C?"Uploading...":"Create Campaign"})]})]})]})}),(0,c.jsxs)("div",{className:"mt-4",children:[(0,c.jsx)("h5",{children:"Campaigns"}),I?(0,c.jsx)("div",{className:"py-3 text-center",children:(0,c.jsx)(n.JT,{})}):0===F.length?(0,c.jsx)("p",{className:"text-muted",children:"No campaigns found for this business."}):(0,c.jsx)("div",{className:"table-responsive",children:(0,c.jsxs)("table",{className:"table table-striped",children:[(0,c.jsx)("thead",{children:(0,c.jsxs)("tr",{children:[(0,c.jsx)("th",{children:"Name"}),(0,c.jsx)("th",{children:"DID"}),(0,c.jsx)("th",{children:"Numbers"}),(0,c.jsx)("th",{children:"Scheduled"}),(0,c.jsx)("th",{children:"Completed"}),(0,c.jsx)("th",{children:"Status"})]})}),(0,c.jsx)("tbody",{children:F.map(e=>{var a;return(0,c.jsxs)("tr",{children:[(0,c.jsx)("td",{children:e.name||e.title||"Untitled Campaign"}),(0,c.jsx)("td",{children:e.didNumber||e.did||"-"}),(0,c.jsx)("td",{children:Array.isArray(e.numbers)?e.numbers.length:e.numbers?e.numbers:"-"}),(0,c.jsx)("td",{children:e.scheduledAt?new Date(e.scheduledAt).toLocaleString():"-"}),(0,c.jsx)("td",{children:null!==(a=e.result)&&void 0!==a&&a.completedAt?new Date(e.result.completedAt).toLocaleString():"-"}),(0,c.jsx)("td",{children:e.status||e.state||"N/A"})]},e._id||e.id||e.name)})})]})})]})]})}}}]);