"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[6106],{36106:function(e,l,s){s.r(l);var i=s(9950),n=s(49911),t=s(26910),a=s(2720),d=(s(73834),s(44414));l.default=()=>{var e,l,s,o,c,r,v,u,m,h,x,j,g;const[p,b]=(0,i.useState)([]),[N,f]=(0,i.useState)(!1),[y,C]=(0,i.useState)(1),[w]=(0,i.useState)(50),[L,S]=(0,i.useState)(localStorage.getItem("businessId")||""),[A,D]=(0,i.useState)(""),[I,_]=(0,i.useState)(""),[k,T]=(0,i.useState)({level1:!1,level2:!1,level3:!1}),[$,R]=(0,i.useState)(new Set),[E,U]=(0,i.useState)(null),[X,F]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{if(!L)try{const l=await(0,a.H2)("/v1/user/details","GET"),s=l.user||l.data||l;if(s&&s.businessId){S(s.businessId);try{localStorage.setItem("businessId",s.businessId)}catch(e){}}}catch(l){}})()},[]);const M=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const l=L||localStorage.getItem("businessId")||"";if(!l)return console.warn("CallDispositions: missing businessId \u2014 attempting to prefill from user details or skip"),b([]),void f(!1);f(!0);try{const i=["page=".concat(e),"limit=".concat(w),"includeDispositions=true"];A&&i.push("startDate=".concat(encodeURIComponent(A))),I&&i.push("endDate=".concat(encodeURIComponent(I)));const n="/call-logs/business/".concat(l,"?").concat(i.join("&"));try{console.debug("CallDispositions -> Request",{endpoint:n,businessId:l,startDateFilter:A,endDateFilter:I,hasAuth:!!localStorage.getItem("authToken"),axiosBaseURL:t.A.defaults.baseURL,fullUrlPreview:"".concat(t.A.defaults.baseURL||"").concat(n)})}catch(s){}const d=await(0,a.H2)(n,"GET");if(d&&d.success){let e=[];const l=d.data||[];Array.isArray(l)&&l.forEach(l=>{var s,i;if(!l)return;let n=null;l.dispositions&&(Array.isArray(l.dispositions.level3)&&l.dispositions.level3.length>0?n=l.dispositions.level3[0]:Array.isArray(l.dispositions.level2)&&l.dispositions.level2.length>0?n=l.dispositions.level2[0]:Array.isArray(l.dispositions.level1)&&l.dispositions.level1.length>0&&(n=l.dispositions.level1[0])),!n&&l.dispositionSnapshot&&(n={level1:l.dispositionSnapshot.level1,level2:l.dispositionSnapshot.level2,level3:l.dispositionSnapshot.level3}),e.push({...l,...n,callLog:{callDate:l.callDate,contact:l.contact,virtualNumber:l.virtualNumber,duration:l.duration,status:l.status},agent:l.agent||n&&n.agent,code:(null===(s=n)||void 0===s?void 0:s.code)||null,note:(null===(i=n)||void 0===i?void 0:i.note)||l.notes||null,raw:l})});const i=e,n={level1:!1,level2:!1,level3:!1};i.forEach(e=>{e.level1&&(n.level1=!0),e.level2&&(n.level2=!0),e.level3&&(n.level3=!0)});const t=i;if(T(n),b(t),d.pagination&&d.pagination.page)try{C(d.pagination.page)}catch(s){}}else b([])}catch(i){console.error("Failed to fetch dispositions",i),b([])}finally{f(!1)}};(0,i.useEffect)(()=>{M(y)},[y]);const P=e=>{if(!e)return"-";try{return new Date(e).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(l){return e}},V=()=>{F(!1),U(null)};return(0,d.jsxs)(n.E$,{className:"mb-4",children:[(0,d.jsxs)(n.V0,{className:"d-flex justify-content-between align-items-center",children:[(0,d.jsx)("span",{children:"Call Dispositions"}),(0,d.jsxs)("div",{className:"d-flex align-items-center",children:[(0,d.jsx)("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:()=>M(1),disabled:N,children:"Refresh"}),(0,d.jsx)("input",{type:"date",className:"form-control form-control-sm d-inline-block me-2",style:{width:150},value:A,onChange:e=>D(e.target.value),placeholder:"Start date"}),(0,d.jsx)("input",{type:"date",className:"form-control form-control-sm d-inline-block me-2",style:{width:150},value:I,onChange:e=>_(e.target.value),placeholder:"End date"}),(0,d.jsx)("button",{className:"btn btn-sm btn-outline-success me-2",onClick:()=>M(1),disabled:N,children:"Apply"}),(0,d.jsx)("button",{className:"btn btn-sm btn-outline-secondary me-3",onClick:()=>{D(""),_(""),M(1)},disabled:N,children:"Clear"}),(0,d.jsxs)(n._l,{"aria-label":"Call dispositions pages",className:"mb-0",children:[(0,d.jsx)(n.Xp,{onClick:()=>C(e=>Math.max(1,e-1)),disabled:1===y||N,children:"Prev"}),(0,d.jsx)(n.Xp,{active:!0,children:y}),(0,d.jsx)(n.Xp,{onClick:()=>C(e=>e+1),disabled:N,children:"Next"})]})]})]}),(0,d.jsxs)(n.W6,{children:[!L&&(0,d.jsx)("div",{className:"mb-3",children:(0,d.jsxs)(n.kj,{color:"warning",children:["Missing ",(0,d.jsx)("code",{children:"businessId"})," in localStorage. Set it to view dispositions."]})}),(0,d.jsxs)(n.zS,{visible:X,onClose:V,alignment:"center",children:[(0,d.jsx)(n.E4,{children:(0,d.jsx)(n.lb,{children:"Disposition Details"})}),(0,d.jsx)(n.Tc,{children:E?(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsx)("strong",{children:"Agent:"})," ",(null===(e=E.agent)||void 0===e||null===(l=e.email)||void 0===l?void 0:l.split("@")[0])||(null===(s=E.agent)||void 0===s?void 0:s._id)||"-",(null===(o=E.agent)||void 0===o?void 0:o.email)&&(0,d.jsx)("div",{className:"text-muted small",children:E.agent.email})]}),(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("strong",{children:"Contact:"})," ",(null===(c=E.callLog)||void 0===c?void 0:c.contact)||E.contact||"-"]}),(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("strong",{children:"Virtual Number:"})," ",(null===(r=E.callLog)||void 0===r?void 0:r.virtualNumber)||E.virtualNumber||"-"]}),(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("strong",{children:"Call Date:"})," ",(e=>{if(!e)return"-";try{return new Date(e).toLocaleString()}catch(l){return e}})((null===(v=E.callLog)||void 0===v?void 0:v.callDate)||E.callDate)]}),(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("strong",{children:"Duration:"})," ",null!==(u=E.callLog)&&void 0!==u&&u.duration||E.duration?"".concat((null===(m=E.callLog)||void 0===m?void 0:m.duration)||E.duration,"s"):"-"]}),(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("strong",{children:"Call Type:"})," ",E.callType||"-"]}),(0,d.jsx)("hr",{}),(0,d.jsx)("h6",{children:"Disposition Path"}),(0,d.jsxs)("div",{className:"mb-2",children:[k.level1&&(0,d.jsxs)("div",{className:"mb-1",children:[(0,d.jsx)(n.$X,{color:"primary",className:"me-1",children:"Level 1"}),(0,d.jsx)("span",{children:E.level1||"-"})]}),k.level2&&(0,d.jsxs)("div",{className:"mb-1",children:[(0,d.jsx)(n.$X,{color:"info",className:"me-1",children:"Level 2"}),(0,d.jsx)("span",{children:E.level2||"-"})]}),k.level3&&(0,d.jsxs)("div",{className:"mb-1",children:[(0,d.jsx)(n.$X,{color:"secondary",className:"me-1",children:"Level 3"}),(0,d.jsx)("span",{children:E.level3||"-"})]})]}),(0,d.jsx)("hr",{}),(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("strong",{children:"Code:"})," ",E.code||"-"]}),(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("strong",{children:"Note:"})," ",E.note||"-"]}),(0,d.jsxs)("div",{className:"mb-2",children:[(0,d.jsx)("strong",{children:"Call Status:"})," ",(0,d.jsx)(n.$X,{color:"closed"===(null===(h=E.callLog)||void 0===h?void 0:h.status)||"closed"===E.status?"success":"completed"===(null===(x=E.callLog)||void 0===x?void 0:x.status)||"completed"===E.status?"info":"failed"===(null===(j=E.callLog)||void 0===j?void 0:j.status)||"failed"===E.status?"danger":"secondary",children:(null===(g=E.callLog)||void 0===g?void 0:g.status)||E.status||"-"})]})]}):(0,d.jsx)("div",{children:"No item selected"})}),(0,d.jsx)(n.If,{children:(0,d.jsx)(n.Q_,{color:"secondary",onClick:V,children:"Close"})})]}),N?(0,d.jsx)("div",{className:"text-center py-4",children:(0,d.jsx)(n.JT,{})}):0===p.length?(0,d.jsx)("div",{className:"text-center py-3",children:"No call logs found"}):(0,d.jsxs)(n._v,{hover:!0,responsive:!0,className:"table-sm compact-table branches-table",style:{tableLayout:"auto"},children:[(0,d.jsx)(n.wV,{children:(0,d.jsxs)(n.YI,{children:[(0,d.jsx)(n.$s,{style:{width:"15%"},children:"AGENT"}),(0,d.jsx)(n.$s,{style:{width:"12%"},children:"CONTACT"}),(0,d.jsx)(n.$s,{style:{width:"12%"},children:"VIRTUAL NUMBER"}),(0,d.jsx)(n.$s,{style:{width:"8%"},children:"DURATION"}),(0,d.jsx)(n.$s,{style:{width:"15%"},children:"CALL DATE"}),(0,d.jsx)(n.$s,{style:{width:"10%"},children:"CALL TYPE"}),(0,d.jsx)(n.$s,{className:"text-center",style:{width:"10%"},children:"STATUS"})]})}),(0,d.jsx)(n.jS,{children:p.map(e=>{var l,s,t,a,o,c,r,v,u,m,h,x,j,g,p,b,N,f,y,C,w,L,S,A,D,I,_,k,T,E,U,X,F,M,V,Y,G,O,z,B,H,J;return(0,d.jsxs)(i.Fragment,{children:[(0,d.jsxs)(n.YI,{onClick:()=>(e=>{const l=new Set($);l.has(e)?l.delete(e):l.add(e),R(l)})(e._id),style:{cursor:"pointer",backgroundColor:$.has(e._id)?"#f8f9fa":"transparent"},role:"button",tabIndex:0,children:[(0,d.jsx)(n.cC,{className:"align-middle",children:(0,d.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,d.jsx)("div",{style:{fontSize:"1.1rem",marginRight:10},children:$.has(e._id)?"\u25bc":"\u25b6"}),(0,d.jsx)("div",{className:"agent-name",title:(null===(l=e.agent)||void 0===l?void 0:l.email)||(null===(s=e.agent)||void 0===s?void 0:s._id)||"-",children:(null===(t=e.agent)||void 0===t||null===(a=t.email)||void 0===a?void 0:a.split("@")[0])||(null===(o=e.agent)||void 0===o?void 0:o._id)||"-"})]})}),(0,d.jsx)(n.cC,{className:"align-middle",children:(0,d.jsx)("div",{className:"manager-email",children:(null===(c=e.callLog)||void 0===c?void 0:c.contact)||e.contact||"-"})}),(0,d.jsx)(n.cC,{className:"align-middle",children:(0,d.jsx)("div",{className:"agent-number",children:(null===(r=e.callLog)||void 0===r?void 0:r.virtualNumber)||e.virtualNumber||"-"})}),(0,d.jsx)(n.cC,{className:"align-middle",children:(0,d.jsx)("div",{className:"agent-number",children:null!==(v=e.callLog)&&void 0!==v&&v.duration||e.duration?"".concat((null===(u=e.callLog)||void 0===u?void 0:u.duration)||e.duration,"s"):"-"})}),(0,d.jsx)(n.cC,{className:"align-middle nowrap",children:(0,d.jsx)("div",{className:"department-name",children:P((null===(m=e.callLog)||void 0===m?void 0:m.callDate)||e.callDate)})}),(0,d.jsx)(n.cC,{className:"align-middle",children:e.callType||"-"}),(0,d.jsx)(n.cC,{className:"text-center align-middle",children:(0,d.jsx)(n.$X,{color:"closed"===(null===(h=e.callLog)||void 0===h?void 0:h.status)||"closed"===e.status?"success":"completed"===(null===(x=e.callLog)||void 0===x?void 0:x.status)||"completed"===e.status?"info":"failed"===(null===(j=e.callLog)||void 0===j?void 0:j.status)||"failed"===e.status?"danger":"secondary",children:(null===(g=e.callLog)||void 0===g?void 0:g.status)||e.status||"-"})})]}),$.has(e._id)&&(0,d.jsx)(n.YI,{children:(0,d.jsx)(n.cC,{colSpan:8,style:{padding:"1rem",backgroundColor:"#f8f9fa"},children:(0,d.jsxs)("div",{className:"disposition-details",children:[(0,d.jsx)("h6",{className:"mb-3",children:"Disposition Details"}),e.level1||e.level2||e.level3||null!==(p=e.raw)&&void 0!==p&&p.dispositions&&(0!==(null===(b=e.raw.dispositions.level1)||void 0===b?void 0:b.length)||0!==(null===(N=e.raw.dispositions.level2)||void 0===N?void 0:N.length)||0!==(null===(f=e.raw.dispositions.level3)||void 0===f?void 0:f.length))?(0,d.jsxs)("div",{children:[(e.level1||(null===(y=e.raw)||void 0===y||null===(C=y.dispositions)||void 0===C?void 0:C.level1)&&e.raw.dispositions.level1.length>0)&&(0,d.jsxs)("div",{className:"mb-3",children:[(0,d.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,d.jsx)(n.$X,{color:"primary",className:"me-2",children:"Level 1"}),(0,d.jsx)("strong",{children:e.level1||(null===(w=e.raw)||void 0===w||null===(L=w.dispositions)||void 0===L||null===(S=L.level1[0])||void 0===S?void 0:S.level1)||"-"})]}),null===(A=e.raw)||void 0===A||null===(D=A.dispositions)||void 0===D||null===(I=D.level1)||void 0===I?void 0:I.map((e,l)=>{var s,i,n;return(0,d.jsxs)("div",{className:"ms-4 mb-2 p-2",style:{backgroundColor:"#fff",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Agent:"})," ",(null===(s=e.agent)||void 0===s?void 0:s.name)||(null===(i=e.agent)||void 0===i||null===(n=i.email)||void 0===n?void 0:n.split("@")[0])||"-"]}),e.code&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Code:"})," ",e.code]}),e.note&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Note:"})," ",e.note]}),(0,d.jsxs)("div",{className:"text-muted small",children:["Created: ",P(e.createdAt)]})]},l)})]}),(e.level2||(null===(_=e.raw)||void 0===_||null===(k=_.dispositions)||void 0===k?void 0:k.level2)&&e.raw.dispositions.level2.length>0)&&(0,d.jsxs)("div",{className:"mb-3 ms-3",children:[(0,d.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,d.jsx)(n.$X,{color:"info",className:"me-2",children:"Level 2"}),(0,d.jsx)("strong",{children:e.level2||(null===(T=e.raw)||void 0===T||null===(E=T.dispositions)||void 0===E||null===(U=E.level2[0])||void 0===U?void 0:U.level2)||"-"})]}),null===(X=e.raw)||void 0===X||null===(F=X.dispositions)||void 0===F||null===(M=F.level2)||void 0===M?void 0:M.map((e,l)=>{var s,i,n;return(0,d.jsxs)("div",{className:"ms-4 mb-2 p-2",style:{backgroundColor:"#fff",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Agent:"})," ",(null===(s=e.agent)||void 0===s?void 0:s.name)||(null===(i=e.agent)||void 0===i||null===(n=i.email)||void 0===n?void 0:n.split("@")[0])||"-"]}),e.code&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Code:"})," ",e.code]}),e.note&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Note:"})," ",e.note]}),(0,d.jsxs)("div",{className:"text-muted small",children:["Created: ",P(e.createdAt)]})]},l)})]}),(e.level3||(null===(V=e.raw)||void 0===V||null===(Y=V.dispositions)||void 0===Y?void 0:Y.level3)&&e.raw.dispositions.level3.length>0)&&(0,d.jsxs)("div",{className:"mb-3 ms-4",children:[(0,d.jsxs)("div",{className:"d-flex align-items-center mb-2",children:[(0,d.jsx)(n.$X,{color:"secondary",className:"me-2",children:"Level 3"}),(0,d.jsx)("strong",{children:e.level3||(null===(G=e.raw)||void 0===G||null===(O=G.dispositions)||void 0===O||null===(z=O.level3[0])||void 0===z?void 0:z.level3)||"-"})]}),null===(B=e.raw)||void 0===B||null===(H=B.dispositions)||void 0===H||null===(J=H.level3)||void 0===J?void 0:J.map((e,l)=>{var s,i,n;return(0,d.jsxs)("div",{className:"ms-4 mb-2 p-2",style:{backgroundColor:"#fff",border:"1px solid #e0e0e0",borderRadius:"4px"},children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Agent:"})," ",(null===(s=e.agent)||void 0===s?void 0:s.name)||(null===(i=e.agent)||void 0===i||null===(n=i.email)||void 0===n?void 0:n.split("@")[0])||"-"]}),e.code&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Code:"})," ",e.code]}),e.note&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Note:"})," ",e.note]}),e.meta&&(0,d.jsxs)("div",{children:[(0,d.jsx)("strong",{children:"Meta:"})," ",JSON.stringify(e.meta)]}),(0,d.jsxs)("div",{className:"text-muted small",children:["Created: ",P(e.createdAt)," | Updated: ",P(e.updatedAt)]})]},l)})]})]}):(0,d.jsx)("div",{className:"alert alert-warning mb-0",children:"No disposition set for this call"})]})})})]},e._id)})})]})]})]})}},73834:function(){}}]);