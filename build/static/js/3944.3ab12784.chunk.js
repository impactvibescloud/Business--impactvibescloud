"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[3944],{93944:function(e,n,t){t.r(n);var i=t(9950),s=t(49911),a=t(4695),l=t.n(a),r=t(26910),o=t(2720),c=t(44414);n.default=()=>{const[e,n]=(0,i.useState)(""),[t,a]=(0,i.useState)([]),[d,u]=(0,i.useState)(!1),[m,h]=(0,i.useState)(!1),[p,v]=(0,i.useState)(""),[x,j]=(0,i.useState)(""),[f,y]=(0,i.useState)(null),[g,N]=(0,i.useState)(""),[w,b]=(0,i.useState)(""),[C,S]=(0,i.useState)([]),[k,I]=(0,i.useState)({name:"",menu:{welcome:"",options:[],repeat:""},children:[]}),[A,R]=(0,i.useState)([]),[_,T]=(0,i.useState)(!1),L=(0,i.useRef)(null),O=(0,i.useRef)(null),[V,z]=(0,i.useState)(null),[U,B]=(0,i.useState)(null),D=localStorage.getItem("authToken"),[E,Q]=(0,i.useState)(!1),[G,F]=(0,i.useState)(null),[M,$]=(0,i.useState)(!1),P=(e,n)=>{if(!n||0===n.length)return e;const[t,...i]=n;return e.children&&e.children[t]?P(e.children[t],i):{name:"",menu:{welcome:"",options:[],repeat:""},children:[]}},W=(e,n,t)=>{if(!n||0===n.length)return t;const[i,...s]=n,a=(e.children||[]).map((e,n)=>n===i?W(e,s,t):e);return{...e,children:a}},H=e=>{I(n=>{var t;const i=P(n,e),s=[...(null===(t=i.menu)||void 0===t?void 0:t.options)||[],{key:"",text:"",destination:"",destinationType:"menu"}],a={...i,menu:{...i.menu,options:s}};return W(n,e,a)})},J=e=>{var n,t,i;let{path:a,nodeProp:l,onChange:r}=e;const o=l||P(k,a),d=e=>r?r(e):((e,n)=>{I(t=>W(t,e,n))})(a,e),u=(e,n)=>{if(r){var t;const i=((null===(t=v.menu)||void 0===t?void 0:t.options)||[]).map((t,i)=>i===e?n:t);d({...v,menu:{...v.menu,options:i}})}else((e,n,t)=>{I(i=>{var s;const a=P(i,e),l=((null===(s=a.menu)||void 0===s?void 0:s.options)||[]).map((e,i)=>i===n?t:e),r={...a,menu:{...a.menu,options:l}};return W(i,e,r)})})(a,e,n)},m=e=>{if(r){var n;const t=((null===(n=v.menu)||void 0===n?void 0:n.options)||[]).filter((n,t)=>t!==e);d({...v,menu:{...v.menu,options:t}})}else((e,n)=>{I(t=>{var i;const s=P(t,e),a=((null===(i=s.menu)||void 0===i?void 0:i.options)||[]).filter((e,t)=>t!==n),l={...s,menu:{...s.menu,options:a}};return W(t,e,l)})})(a,e)},h=e=>{if(r){var n;const t=(null===(n=v.menu)||void 0===n?void 0:n.options)||[],i={name:"",menu:{welcome:"",options:[],repeat:""},children:[]},s=t.map((n,t)=>t===e?{...n||{},children:[...n&&n.children||[],i]}:n);d({...v,menu:{...v.menu,options:s}})}else{var t;const n=((null===(t=v.menu)||void 0===t?void 0:t.options)||[])[e];((e,n)=>{I(t=>{var i;const s=P(t,e),a=(null===(i=s.menu)||void 0===i?void 0:i.options)||[],l=a.findIndex(e=>e.key===n),r=l>=0?l:0,o={name:n||"",menu:{welcome:"",options:[],repeat:""},children:[]},c=a.map((e,n)=>n===r?{...e||{},children:[...e&&e.children||[],o]}:e),d={...s,menu:{...s.menu,options:c}};return W(t,e,d)})})(a,n&&n.key)}},p=(e,n)=>{if(r){var t;const i=((null===(t=v.menu)||void 0===t?void 0:t.options)||[]).map((t,i)=>{if(i!==e)return t;const s=(t.children||[]).filter((e,t)=>t!==n);return{...t,children:s}});d({...v,menu:{...v.menu,options:i}})}else((e,n,t)=>{I(i=>{var s;const a=P(i,e),l=((null===(s=a.menu)||void 0===s?void 0:s.options)||[]).map((e,i)=>{if(i!==n)return e;const s=(e.children||[]).filter((e,n)=>n!==t);return{...e,children:s}}),r={...a,menu:{...a.menu,options:l}};return W(i,e,r)})})(a,e,n)},v=o,x=v.children||[];return(0,c.jsxs)("div",{className:"border rounded p-2 mb-2",children:[(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(s.A6,{children:"name"}),(0,c.jsx)(s.OG,{value:v.name||"",onChange:e=>d({...v,name:e.target.value}),placeholder:"name (e.g. menu or SalesMenu)"})]}),(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(s.A6,{children:"menu.welcome"}),(0,c.jsx)(s.OG,{value:(null===(n=v.menu)||void 0===n?void 0:n.welcome)||"",onChange:e=>d({...v,menu:{...v.menu,welcome:e.target.value}})})]}),(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(s.A6,{children:"menu.options[]"}),((null===(t=v.menu)||void 0===t?void 0:t.options)||[]).map((e,n)=>(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("div",{className:"input-group mb-1",children:[(0,c.jsx)(s.OG,{style:{maxWidth:80},value:e.key||"",placeholder:"menu.options[].key",onChange:t=>{const i={...e,key:t.target.value};u(n,i)}}),(0,c.jsx)(s.OG,{value:e.text||"",placeholder:"menu.options[].text",onChange:t=>u(n,{...e,text:t.target.value})}),(0,c.jsxs)("select",{className:"form-control",style:{maxWidth:180,marginRight:6},value:e.destinationType||"menu",onChange:t=>u(n,{...e,destinationType:t.target.value,destination:""}),children:[(0,c.jsx)("option",{value:"menu",children:"menu.options[].destination (menu)"}),(0,c.jsx)("option",{value:"did",children:"menu.options[].destination (did)"})]}),"did"===(e.destinationType||"menu")?(0,c.jsxs)("select",{className:"form-control",style:{maxWidth:220},value:e.destination||"",onChange:t=>u(n,{...e,destination:t.target.value}),children:[(0,c.jsx)("option",{value:"",children:"menu.options[].destination"}),_?(0,c.jsx)("option",{disabled:!0,children:"Loading..."}):A.map(e=>(0,c.jsx)("option",{value:e.id,children:e.number},e.id))]}):(0,c.jsx)(s.OG,{value:e.destination||"",placeholder:"menu.options[].destination",onChange:t=>u(n,{...e,destination:t.target.value})}),(0,c.jsx)("button",{type:"button",className:"btn btn-danger",onClick:()=>m(n),children:"Remove"})]}),(0,c.jsxs)("div",{children:[(e.children||[]).map((e,t)=>(0,c.jsxs)("div",{className:"ms-3 mb-2",children:[(0,c.jsx)("div",{className:"mb-1 text-end",children:(0,c.jsx)("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>p(n,t),children:"Remove Child"})}),(0,c.jsx)(J,{nodeProp:e,onChange:e=>((e,n,t,i)=>{I(s=>{var a;const l=P(s,e),r=((null===(a=l.menu)||void 0===a?void 0:a.options)||[]).map((e,s)=>{if(s!==n)return e;const a=(e.children||[]).map((e,n)=>n===t?i:e);return{...e,children:a}}),o={...l,menu:{...l.menu,options:r}};return W(s,e,o)})})(a,n,t,e)})]},t)),(0,c.jsx)("div",{className:"mt-1",children:(0,c.jsx)(s.Q_,{color:"secondary",size:"sm",onClick:()=>h(n),children:"Add Child Menu"})})]})]},n)),(0,c.jsx)("div",{className:"mt-2",children:(0,c.jsx)(s.Q_,{color:"secondary",size:"sm",onClick:()=>H(a),children:"Add Option"})})]}),(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(s.A6,{children:"menu.repeat"}),(0,c.jsx)(s.OG,{value:(null===(i=v.menu)||void 0===i?void 0:i.repeat)||"",onChange:e=>d({...v,menu:{...v.menu,repeat:e.target.value}})})]}),(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsx)(s.a5,{className:"text-muted",children:"children (unattached)"}),(x||[]).map((e,n)=>{var t;return e&&e.key&&(e.child||e.children)&&((null===(t=v.menu)||void 0===t?void 0:t.options)||[]).some(n=>n.key===e.key)?null:(0,c.jsxs)("div",{className:"ms-3",children:[(0,c.jsx)(J,{path:[...a,n]}),(0,c.jsx)("div",{className:"mb-2 text-end",children:(0,c.jsx)("button",{type:"button",className:"btn btn-sm btn-danger",onClick:()=>((e,n)=>{I(t=>{const i=P(t,e),s=(i.children||[]).filter((e,t)=>t!==n),a={...i,children:s};return W(t,e,a)})})(a,n),children:"Remove Child"})})]},n)}),(0,c.jsx)("div",{children:(0,c.jsx)(s.Q_,{color:"secondary",size:"sm",onClick:()=>(e=>{I(n=>{const t=P(n,e),i={...t,children:[...t.children||[],{name:"",menu:{welcome:"",options:[],repeat:""},children:[]}]};return W(n,e,i)})})(a),children:"Add Child Menu"})})]})]})};(0,i.useEffect)(()=>{(async()=>{try{const e=await(0,o.H2)("/v1/user/details","GET"),t=e.user||e.data||e;t&&t.businessId&&n(t.businessId)}catch(e){console.warn("Failed to fetch user details",e)}})()},[]),(0,i.useEffect)(()=>{e&&Y()},[e]),(0,i.useEffect)(()=>{if(!e)return;(async()=>{T(!0);try{const n=await(0,o.H2)("/numbers/assigned-to/".concat(e),"GET"),t=n.data||n.numbers||n||[],i=(Array.isArray(t)?t:[]).map(e=>({id:e._id||e.id,number:e.number||e}));R(i)}catch(n){console.warn("Failed to fetch DIDs",n)}finally{T(!1)}})()},[e]),(0,i.useEffect)(()=>()=>{if(V)try{window.URL.revokeObjectURL(V)}catch(e){}},[V]);const Y=async()=>{u(!0);try{const n="".concat((0,o.vo)(),"/api/ivr/tree/menu?businessId=").concat(e),t=await r.A.get(n,{headers:{Authorization:"Bearer ".concat(D)}}),i=t&&t.data?t.data:t,s=i&&(i.tree||i);a(s?Array.isArray(s)?s:[s]:[])}catch(n){console.error("Failed to fetch IVRs",n),a([])}finally{u(!1)}},K=e=>{let{node:n,level:t=0}=e;if(!n)return null;const i={marginLeft:"".concat(12*t,"px"),borderLeft:0===t?"none":"1px dashed #ccc",paddingLeft:"8px"},s=n.menu||{},a=n.children||[];return(0,c.jsxs)("div",{style:i,className:"mb-2",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("strong",{children:n.name||n.fileName||"Menu"})," ",n.fileName?(0,c.jsxs)("span",{className:"text-muted",children:["(",n.fileName,")"]}):null]}),s.welcome?(0,c.jsx)("div",{className:"text-muted",children:s.welcome}):null,s.options&&s.options.length>0&&(0,c.jsxs)("div",{className:"mt-1",children:[(0,c.jsx)("small",{className:"text-muted",children:"Options:"}),(0,c.jsx)("ul",{children:s.options.map((e,n)=>(0,c.jsxs)("li",{children:[e.key,": ",e.text," \u2192 ",e.destination]},e._id||n))})]}),s.repeat?(0,c.jsxs)("div",{className:"text-muted",children:["Repeat: ",s.repeat]}):null,s.options&&s.options.length>0&&(0,c.jsxs)("div",{className:"mt-2",children:[(0,c.jsx)("small",{className:"text-muted",children:"Option Children:"}),(0,c.jsx)("div",{children:s.options.map((e,n)=>e.children&&e.children.length>0?(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("div",{className:"text-muted",children:["On press ",(0,c.jsx)("strong",{children:e.key})," \u2192 ",e.text]}),e.children.map((e,n)=>(0,c.jsx)("div",{className:"ms-3 mb-1",children:(0,c.jsx)(K,{node:e,level:t+1})},n))]},n):null)})]}),a&&a.length>0&&(0,c.jsxs)("div",{className:"mt-2",children:[(0,c.jsx)("small",{className:"text-muted",children:"Children:"}),(0,c.jsx)("div",{children:a.map((e,n)=>e&&e.child?(0,c.jsxs)("div",{className:"mb-2",children:[(0,c.jsxs)("div",{className:"text-muted",children:["On press ",(0,c.jsx)("strong",{children:e.key})," \u2192 ",e.destination]}),(0,c.jsx)(K,{node:e.child,level:t+1})]},n):(0,c.jsx)(K,{node:e,level:t+1},n))})]})]})},q=()=>{try{if(O.current&&(O.current.pause(),O.current.currentTime=0,O.current.src=""),V)try{window.URL.revokeObjectURL(V)}catch(e){}}finally{z(null),B(null)}},X=t.filter(e=>{const n=(e.name||"").toString().toLowerCase();return"menu"===n||"main"===n||"root"===n||(!!(e.menu&&Array.isArray(e.children)&&e.children.length>0)||(!!(Array.isArray(e.children)&&e.children.length>0)||!!e.uploadedToAsterisk))}),[Z,ee]=(0,i.useState)([]),ne=e=>Z.includes(e),[te,ie]=(0,i.useState)([]),se=e=>te.includes(e),ae=function(n){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!n)return[];const a=n._id||n.name||i||Math.random().toString(36).slice(2),d=n._id||n.id||n.name||a,u={paddingLeft:"".concat(18*t,"px")},m=[];return m.push((0,c.jsxs)(s.YI,{children:[(0,c.jsx)(s.cC,{children:(0,c.jsxs)("div",{style:u,className:"d-flex align-items-center",children:[n.children&&n.children.length>0?(0,c.jsx)(s.Q_,{color:"light",size:"sm",className:"me-2",onClick:()=>{return e=a,void ee(n=>n.includes(e)?n.filter(n=>n!==e):[...n,e]);var e},children:ne(a)?"\u25be":"\u25b8"}):(0,c.jsx)("span",{style:{width:34}}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{children:(0,c.jsx)("strong",{children:n.name||n.fileName||"Menu"})}),n.menu&&n.menu.welcome?(0,c.jsx)("div",{className:"text-muted small",children:n.menu.welcome}):null]})]})}),(0,c.jsx)(s.cC,{children:n.description||"-"}),(0,c.jsx)(s.cC,{children:n.name||n.fileName?(0,c.jsx)(s.Q_,{color:"link",size:"sm",className:"p-0",onClick:()=>(async e=>{const n=e.name||e.fileName||e.file||"";if(!n)return l().fire({icon:"error",title:"No audio",text:"No audio file available for this IVR."});try{const e="".concat((0,o.vo)(),"/api/ivr/download/").concat(encodeURIComponent(n)),t=await r.A.get(e,{responseType:"arraybuffer",headers:{Authorization:"Bearer ".concat(D)}}),i=t.headers&&t.headers["content-type"]?t.headers["content-type"]:"audio/wav",s=new Blob([t.data],{type:i}),a=window.URL.createObjectURL(s);window.open(a,"_blank"),setTimeout(()=>{try{window.URL.revokeObjectURL(a)}catch(e){}},6e4)}catch(i){var t;console.error("Open failed",i),l().fire({icon:"error",title:"Open failed",text:(null===i||void 0===i||null===(t=i.response)||void 0===t?void 0:t.data)||(null===i||void 0===i?void 0:i.message)||"Could not open audio"})}})(n),children:n.name||n.fileName}):n.audio?(0,c.jsx)("a",{href:n.audio,target:"_blank",rel:"noreferrer",children:"Play"}):"-"}),(0,c.jsx)(s.cC,{style:{maxWidth:300,overflow:"hidden",textOverflow:"ellipsis"},children:n.menu&&n.menu.options&&n.menu.options.map(e=>"".concat(e.key,":").concat(e.text)).join(", ")||n.generatedText||"-"}),(0,c.jsx)(s.cC,{children:n.status||n.state||"-"}),(0,c.jsx)(s.cC,{children:n.createdAt?new Date(n.createdAt).toLocaleString():"-"}),(0,c.jsxs)(s.cC,{children:[se(d)&&(0,c.jsx)(s.JT,{size:"sm",className:"me-2"}),(()=>{const t="on"===(n.ivrStatus||n.status||n.state||"").toString().toLowerCase()||"active"===(n.ivrStatus||n.status||"").toString().toLowerCase();return(0,c.jsx)(s.Qb,{checked:t,className:"me-2",disabled:se(d),onChange:t=>(async(n,t)=>{const i=n._id||n.id||n.name;if(!i)return l().fire({icon:"error",title:"Invalid IVR"});const s=(n.ivrStatus||n.status||n.state||"").toString().toLowerCase(),a="boolean"===typeof t?t?"on":"off":"off"===s||"on"===s||"active"===s?"off":"on";try{ie(e=>[...e,i]);const t={action:a,name:n.name||n.fileName||n.file||"",businessId:e},s="".concat((0,o.vo)(),"/api/ivr/switch");await r.A.post(s,t,{headers:{Authorization:"Bearer ".concat(D),"Content-Type":"application/json"}}),l().fire({icon:"success",title:"Switched ".concat(a)}),await Y()}catch(u){var c,d;console.error("Switch failed",u);const e=(null===u||void 0===u||null===(c=u.response)||void 0===c||null===(d=c.data)||void 0===d?void 0:d.message)||(null===u||void 0===u?void 0:u.message)||"Switch failed";l().fire({icon:"error",title:"Switch failed",text:e})}finally{ie(e=>e.filter(e=>e!==i))}})(n,t.target.checked)})})(),(n.name||n.fileName||n.audio)&&(0,c.jsx)(s.Q_,{color:"info",size:"sm",className:"me-2",onClick:()=>(async e=>{const n=e._id||e.id,t=e.name||e.fileName||e.file||"";if(!t)return l().fire({icon:"error",title:"No audio",text:"No audio file available for this IVR."});if(U!==n)try{q();const e="".concat((0,o.vo)(),"/api/ivr/download/").concat(encodeURIComponent(t)),i=await r.A.get(e,{responseType:"arraybuffer",headers:{Authorization:"Bearer ".concat(D)}}),a=i.headers&&i.headers["content-type"]?i.headers["content-type"]:"audio/wav",l=new Blob([i.data],{type:a}),c=window.URL.createObjectURL(l);if(z(c),B(n),O.current){O.current.src=c;try{O.current.load()}catch(s){}try{await O.current.play()}catch(s){}}}catch(a){var i;console.error("Play failed",a);const e=(null===a||void 0===a||null===(i=a.response)||void 0===i?void 0:i.data)||(null===a||void 0===a?void 0:a.message)||"Could not play audio";l().fire({icon:"error",title:"Play failed",text:e})}else q()})(n),children:U===(n._id||n.id)?"Stop":"Play"}),(0,c.jsx)(s.Q_,{color:"secondary",size:"sm",className:"me-2",onClick:()=>(async n=>{const t=n.name||n.fileName||n.file||"";if(!t)return l().fire({icon:"error",title:"No tree",text:"No tree available for this IVR."});$(!0);try{const n="".concat((0,o.vo)(),"/api/ivr/tree/").concat(encodeURIComponent(t),"?businessId=").concat(e),i=await r.A.get(n,{headers:{Authorization:"Bearer ".concat(D)}}),s=(i.data&&(i.data.tree||i.data)&&(i.data.tree||i.data.tree||i.data),i.data&&i.data.tree?i.data.tree:i.data&&void 0===i.data.tree?i.data:null);F(s||i.data||null),Q(!0)}catch(a){var i,s;console.error("Fetch tree failed",a),l().fire({icon:"error",title:"Fetch failed",text:(null===a||void 0===a||null===(i=a.response)||void 0===i||null===(s=i.data)||void 0===s?void 0:s.message)||(null===a||void 0===a?void 0:a.message)||"Could not fetch tree"})}finally{$(!1)}})(n),children:"View Tree"}),(0,c.jsx)(s.Q_,{color:"danger",size:"sm",onClick:()=>(async n=>{const t=n._id||n.id;if(!t)return l().fire({icon:"error",title:"Invalid IVR"});if((await l().fire({title:"Delete IVR?",text:'Delete "'.concat(n.name||"IVR",'"?'),icon:"warning",showCancelButton:!0})).isConfirmed)try{const i=(n.name||"").toString().toLowerCase(),s=(n.fileName||"").toString().toLowerCase();if("menu"===i||s.includes("-menu")){const n="".concat((0,o.vo)(),"/api/ivr/nested/menu?businessId=").concat(e);await r.A.delete(n,{headers:{Authorization:"Bearer ".concat(D)}})}else await(0,o.H2)("/api/ivr/".concat(t),"DELETE");l().fire({icon:"success",title:"Deleted"}),await Y()}catch(i){console.error("Delete IVR failed",i),l().fire({icon:"error",title:"Delete failed",text:(null===i||void 0===i?void 0:i.message)||"Delete failed"})}})(n),children:"Delete"})]})]},"node-".concat(a))),ne(a)&&n.children&&n.children.length>0&&n.children.forEach((e,n)=>{e&&e.child?(m.push((0,c.jsx)(s.YI,{children:(0,c.jsx)(s.cC,{colSpan:7,children:(0,c.jsxs)("div",{style:{paddingLeft:"".concat(18*(t+1),"px")},className:"text-muted small",children:["On press ",(0,c.jsx)("strong",{children:e.key})," \u2192 ",e.destination]})})},"opt-".concat(a,"-").concat(n))),m.push(...ae(e.child,t+1,"".concat(i,"/").concat(n)))):m.push(...ae(e,t+1,"".concat(i,"/").concat(n)))}),m};return(0,c.jsx)("div",{className:"p-3",children:(0,c.jsx)(s.E$,{children:(0,c.jsxs)(s.W6,{children:[(0,c.jsxs)(s.sK,{className:"align-items-center mb-3",children:[(0,c.jsxs)(s.UF,{children:[(0,c.jsx)("h3",{children:"IVR Management"}),(0,c.jsx)("p",{className:"text-muted",children:"Create and manage IVR flows and audio prompts."})]}),(0,c.jsx)(s.UF,{className:"text-end",children:(0,c.jsx)(s.Q_,{color:"primary",onClick:()=>h(!0),children:"New IVR"})})]}),(0,c.jsxs)(s.zS,{visible:m,onClose:()=>h(!1),children:[(0,c.jsx)(s.E4,{closeButton:!0,children:(0,c.jsx)(s.lb,{children:"New IVR"})}),(0,c.jsxs)(s.Tc,{children:[(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(s.A6,{children:"name"}),(0,c.jsx)(s.OG,{value:p,onChange:e=>v(e.target.value),placeholder:"name"})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(s.A6,{children:"description"}),(0,c.jsx)(s.OG,{value:x,onChange:e=>j(e.target.value),placeholder:"description"})]}),(0,c.jsxs)("div",{className:"mb-3",children:[(0,c.jsx)(s.A6,{children:"Build Menu (visual editor)"}),(0,c.jsx)(J,{path:[]}),(0,c.jsx)(s.a5,{className:"text-muted",children:"Use the visual editor to build a nested menu tree. Top-level node name will default to the IVR name if left empty."})]})]}),(0,c.jsxs)(s.If,{children:[(0,c.jsx)(s.Q_,{color:"secondary",onClick:()=>h(!1),children:"Cancel"}),(0,c.jsx)(s.Q_,{color:"primary",onClick:async()=>{if(p&&e)try{if(k&&(k.menu&&(k.menu.welcome||k.menu.options&&k.menu.options.length>0||k.menu.repeat)||k.children&&k.children.length>0)){const n={...k};n.name||(n.name=p||"menu");const t="".concat((0,o.vo)(),"/api/ivr/create-nested");await r.A.post(t,{businessId:e,tree:n},{headers:{Authorization:"Bearer ".concat(D),"Content-Type":"application/json"}})}else if(f){const n=new FormData;n.append("name",p),n.append("description",x),n.append("businessId",e),n.append("audio",f);const t="".concat((0,o.vo)(),"/api/ivr");await r.A.post(t,n,{headers:{Authorization:"Bearer ".concat(D),"Content-Type":"multipart/form-data"}})}else{const n="".concat((0,o.vo)(),"/api/ivr");await r.A.post(n,{name:p,description:x,businessId:e},{headers:{Authorization:"Bearer ".concat(D),"Content-Type":"application/json"}})}l().fire({icon:"success",title:"IVR Created"}),h(!1),v(""),j(""),y(null),N(""),b(""),S([]),I({name:"",menu:{welcome:"",options:[],repeat:""},children:[]}),L.current&&(L.current.value=""),await Y()}catch(i){var n,t;console.error("Create IVR failed",i);const e=(null===i||void 0===i||null===(n=i.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.message)||i.message||"Create failed";l().fire({icon:"error",title:"Create failed",text:e})}else l().fire({icon:"warning",title:"Missing fields",text:"Please provide a name."})},children:"Create"})]})]}),(0,c.jsxs)("div",{className:"mt-4",children:[(0,c.jsx)("h5",{children:"IVR List"}),d?(0,c.jsx)("div",{className:"py-3 text-center",children:(0,c.jsx)(s.JT,{})}):0===X.length?(0,c.jsx)("p",{className:"text-muted",children:"No IVRs found for this business."}):(0,c.jsx)("div",{className:"table-responsive",children:(0,c.jsxs)(s._v,{children:[(0,c.jsx)(s.wV,{children:(0,c.jsxs)(s.YI,{children:[(0,c.jsx)(s.$s,{children:"Name"}),(0,c.jsx)(s.$s,{children:"Description"}),(0,c.jsx)(s.$s,{children:"File"}),(0,c.jsx)(s.$s,{children:"Generated Text"}),(0,c.jsx)(s.$s,{children:"Status"}),(0,c.jsx)(s.$s,{children:"Created"}),(0,c.jsx)(s.$s,{children:"Actions"})]})}),(0,c.jsx)(s.jS,{children:X.reduce((e,n,t)=>e.concat(ae(n,0,String(t))),[])})]})}),V&&(0,c.jsxs)("div",{className:"mt-3",children:[(0,c.jsx)("h6",{children:"Now playing"}),(0,c.jsx)("audio",{ref:O,controls:!0,style:{width:"100%"}})]}),(0,c.jsxs)(s.zS,{visible:E,onClose:()=>{Q(!1),F(null)},children:[(0,c.jsx)(s.E4,{closeButton:!0,children:(0,c.jsx)(s.lb,{children:"IVR Tree"})}),(0,c.jsx)(s.Tc,{children:M?(0,c.jsx)("div",{className:"text-center py-3",children:(0,c.jsx)(s.JT,{})}):G?(0,c.jsx)("div",{children:(0,c.jsx)(K,{node:G})}):(0,c.jsx)("div",{className:"text-muted",children:"No tree data available."})}),(0,c.jsx)(s.If,{children:(0,c.jsx)(s.Q_,{color:"secondary",onClick:()=>{Q(!1),F(null)},children:"Close"})})]})]})]})})})}}}]);